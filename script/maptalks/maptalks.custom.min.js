/*!
 * maptalks v0.27.0
 * LICENSE : BSD-3-Clause
 * (c) 2016-2017 maptalks.org
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e(t.maptalks=t.maptalks||{})}(this,function(t){"use strict";function e(t,e){for(var i=Object.getOwnPropertyNames(e),n=0;n<i.length;n++){var r=i[n],o=Object.getOwnPropertyDescriptor(e,r);o&&o.configurable&&void 0===t[r]&&Object.defineProperty(t,r,o)}return t}function i(){return Date.now()}function n(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var n in i)t[n]=i[n]}return t}function r(t){return null==t}function o(t){return"number"==typeof t&&!isNaN(t)}function s(t){return(0|t)===t}function a(t){return"object"===(void 0===t?"undefined":Gt(t))&&!!t}function h(t){return!r(t)&&("string"==typeof t||null!==t.constructor&&t.constructor===String)}function p(t){return!r(t)&&("function"==typeof t||null!==t.constructor&&t.constructor===Function)}function u(t,e){return Ht.call(t,e)}function c(t){return t.length>4&&".svg"===t.slice(-4)?1:"data:image/svg+xml"===t.slice(0,"data:image/svg+xml".length)?2:0}function l(t,e){if(Wt&&l.node)return void l.node(t,e);t.src=e[0]}function f(){return Jt++}function y(t){return t&&h(t)?JSON.parse(t):t}function d(t,e){!function i(){e()?t():Bt(i)}()}function g(t,e){for(var i=0,n=e.length;i<n;i++)t.push(e[i]);return t.length}function m(t,e,i){if(!Array.isArray(t))return i?e.call(i,t):e(t);for(var n=[],o=void 0,s=void 0,a=0,h=t.length;a<h;a++)o=t[a],r(o)?n.push(null):Array.isArray(o)?n.push(m(o,e,i)):(s=i?e.call(i,o):e(o),n.push(s));return n}function _(t,e){return void 0===t?e:t}function v(t){return t>0?.5+t<<0:t-.5<<0}function x(t){return Math.sign?Math.sign(t):(t=+t,0===t||isNaN(t)?Number(t):t>0?1:-1)}function w(t,e,i){return t*(1-i)+e*i}function P(t,e,i){var n=i-e,r=((t-e)%n+n)%n+e;return r===e?i:r}function C(t,e,i){return Math.min(i,Math.max(e,t))}function b(t){return Array.isArray(t)&&t.length>0}function M(t){if(!t)return!1;var e=t.slice(0,6);return"http:/"===e||"https:"===e||"file:/"===e}function S(t){if(!h(t))return 0;var e=t.slice(0,6);return"http:/"===e||"https:"===e?3:qt.test(t)?1:Ut.test(t)?2:0}function E(t){var e=S(t),i=void 0;return 3===e?t:1===e?(i=qt.exec(t),i[1]):2===e?(i=Ut.exec(t),i[2]):t}function L(t){if("undefined"!=typeof window&&window.btoa)return window.btoa(t);for(var e,i,n=String(t),r="",o=0,s=Qt;n.charAt(0|o)||(s="=",o%1);r+=s.charAt(63&e>>8-o%1*8)){if((i=n.charCodeAt(o+=.75))>255)throw new Error("'btoa' failed: The string to be encoded contains characters outside of the Latin1 range.");e=e<<8|i}return r}function T(t,e){var i=e.x-t.x,n=e.y-t.y;return Math.atan2(n,i)}function R(t){return new Function("f","var p = (f && f.properties || {}); return "+A(t))}function A(t){if(!t)return"true";var e=t[0];return t.length<=1?"any"===e?"false":"true":"("+("=="===e?k(t[1],t[2],"===",!1):"!="===e?k(t[1],t[2],"!==",!1):"<"===e||">"===e||"<="===e||">="===e?k(t[1],t[2],e,!0):"any"===e?j(t.slice(1),"||"):"all"===e?j(t.slice(1),"&&"):"none"===e?z(j(t.slice(1),"||")):"in"===e?O(t[1],t.slice(2)):"!in"===e?z(O(t[1],t.slice(2))):"has"===e?D(t[1]):"!has"===e?z(D([t[1]])):"true")+")"}function I(t){return"$"===t[0]?"f."+t.substring(1):"p["+JSON.stringify(t)+"]"}function k(t,e,i,n){var r=I(t),o="$type"===t?de.indexOf(e):JSON.stringify(e);return(n?"typeof "+r+"=== typeof "+o+"&&":"")+r+i+o}function j(t,e){return t.map(A).join(e)}function O(t,e){"$type"===t&&(e=e.map(function(t){return de.indexOf(t)}));var i=JSON.stringify(e.sort(G)),n=I(t);return e.length<=200?i+".indexOf("+n+") !== -1":"function(v, a, i, j) {while (i <= j) { var m = (i + j) >> 1;    if (a[m] === v) return true; if (a[m] > v) j = m - 1; else i = m + 1;}return false; }("+n+", "+i+",0,"+(e.length-1)+")"}function D(t){return JSON.stringify(t)+" in p"}function z(t){return"!("+t+")"}function G(t,e){return t<e?-1:t>e?1:0}function Z(t){var e=t._toJSON(),i=e.feature;return i.type=de.indexOf(i.geometry.type),i.subType=e.subType,i}function F(t){if(!Array.isArray(t))return F([t]);for(var e=[],i=0;i<t.length;i++)!0===t[i].filter?e.push({filter:function(){return!0},symbol:t[i].symbol}):e.push({filter:R(t[i].filter),symbol:t[i].symbol});return e}function N(t,e){var i;if(q(t)){var n,r="object"===Gt(t.stops[0][0]),o=r||void 0!==t.property,s=r||!o,a=t.type||e||"exponential";if("exponential"===a)n=B;else if("interval"===a)n=W;else{if("categorical"!==a)throw new Error('Unknown function type "'+a+'"');n=H}if(r){for(var h={},p=[],u=0;u<t.stops.length;u++){var c=t.stops[u];void 0===h[c[0].zoom]&&(h[c[0].zoom]={zoom:c[0].zoom,type:t.type,property:t.property,stops:[]}),h[c[0].zoom].stops.push([c[0].value,c[1]])}for(var l in h)p.push([h[l].zoom,N(h[l])]);i=function(e,i){return B({stops:p,base:t.base},e)(e,i)},i.isFeatureConstant=!1,i.isZoomConstant=!1}else s?(i=function(e){return n(t,e)},i.isFeatureConstant=!0,i.isZoomConstant=!1):(i=function(e,i){return n(t,i[t.property])},i.isFeatureConstant=!1,i.isZoomConstant=!0)}else i=function(){return t},i.isFeatureConstant=!0,i.isZoomConstant=!0;return i}function H(t,e){for(var i=0;i<t.stops.length;i++)if(e===t.stops[i][0])return t.stops[i][1];return t.stops[0][1]}function W(t,e){for(var i=0;i<t.stops.length&&!(e<t.stops[i][0]);i++);return t.stops[Math.max(i-1,0)][1]}function B(t,e){for(var i=void 0!==t.base?t.base:1,n=0;;){if(n>=t.stops.length)break;if(e<=t.stops[n][0])break;n++}return 0===n?t.stops[n][1]:n===t.stops.length?t.stops[n-1][1]:V(e,i,t.stops[n-1][0],t.stops[n][0],t.stops[n-1][1],t.stops[n][1])}function V(t,e,i,n,r,o){return"function"==typeof r?function(){var s=r.apply(void 0,arguments),a=o.apply(void 0,arguments);return V(t,e,i,n,s,a)}:r.length?U(t,e,i,n,r,o):J(t,e,i,n,r,o)}function J(t,e,i,n,r,o){var s,a=n-i,h=t-i;return s=1===e?h/a:(Math.pow(e,h)-1)/(Math.pow(e,a)-1),r*(1-s)+o*s}function U(t,e,i,n,r,o){for(var s=[],a=0;a<r.length;a++)s[a]=J(t,e,i,n,r[a],o[a]);return s}function q(t){return t&&"object"===(void 0===t?"undefined":Gt(t))&&t.stops}function Q(t){return N(t,"exponential")}function Y(t,e){if(!t)return null;var i=!1;if(Array.isArray(t)){for(var n,r=[],o=0;o<t.length;o++)n=Y(t[o],e),n?(r.push(n),i=!0):r.push(t[o]);return i?r:t}var s,a={__fn_types_loaded:!0},h=[];for(s in t)t.hasOwnProperty(s)&&h.push(s);for(var p=0,u=h.length;p<u;p++)s=h[p],q(t[s])?(i=!0,a["_"+s]=t[s],function(t){Object.defineProperty(a,t,{get:function(){return this["__fn_"+t]||(this["__fn_"+t]=Q(this["_"+t])),this["__fn_"+t].apply(this,e())},set:function(e){this["_"+t]=e},configurable:!0,enumerable:!0})}(s)):a[s]=t[s];return i?a:t}function X(t){if(!t||!t.stops)return[];for(var e=[],i=0,n=t.stops.length;i<n;i++)e.push(t.stops[i][1]);return e}function $(t){return t&&t.colorStops}function K(t){var e=Array.prototype.slice.call(arguments,1);if(e&&e.length||(e=[{}]),Array.isArray(t)){for(var i=void 0,o=void 0,s=[],a=0,h=t.length;a<h;a++){i=t[a],o={};for(var p=0,u=e.length;p<u;p++)Array.isArray(e[p])?r(e[p][a])?n(o,i||{}):n(o,i,e[p][a]):n(o,i,e[p]?e[p]:{});s.push(o)}return s}var c=[{},t];return c.push.apply(c,e),n.apply(this,c)}function tt(t,e,i){var n=t.width,r=t.height,o=void 0,s=void 0;return"left"===e?o=-n:"middle"===e?o=-n/2:"right"===e&&(o=0),"top"===i?s=-r:"middle"===i?s=-r/2:"bottom"===i&&(s=0),new me(o,s)}function et(t){return t.textFont?t.textFont:(t.textStyle&&"normal"!==t.textStyle?t.textStyle+" ":"")+(t.textWeight&&"normal"!==t.textWeight?t.textWeight+" ":"")+t.textSize+"px "+('"'===t.textFaceName[0]?t.textFaceName:'"'+t.textFaceName+'"')}function it(t,e){var i=document.createElement(t);return e&&lt(i,e),i}function nt(t,e,i,n){if(!(t&&t.addEventListener&&e&&i))return this;for(var r=function(e){e||(e=window.event),i.call(n||t,e)},o=e.split(" "),s=o.length-1;s>=0;s--){var a=o[s];if(a){t["Z__"+a]||(t["Z__"+a]=[]);ot(t,a,i)>=0&&rt(t,a,i),t["Z__"+a].push({callback:r,src:i}),"mousewheel"===a&&ye.gecko&&(a="DOMMouseScroll"),t.addEventListener(a,r,!1)}}return this}function rt(t,e,i){function n(e,i){"mousewheel"===e&&ye.gecko&&(e="DOMMouseScroll"),t.removeEventListener(e,i,!1)}if(!t||!t.removeEventListener||!e)return this;for(var r=e.split(" "),o=r.length-1;o>=0;o--){var s=r[o];if(s){if(!i&&t["Z__"+s]){for(var a=t["Z__"+s],h=0,p=a.length;h<p;h++)n(a[h].callback);return delete t["Z__"+s],this}var u=ot(t,s,i);if(u<0)return this;n(s,t["Z__"+s][u].callback),t["Z__"+s].splice(u,1)}}return this}function ot(t,e,i){if(!t||!t["Z__"+e]||!i)return-1;for(var n=t["Z__"+e],r=0,o=n.length;r<o;r++)if(n[r].src===i)return r;return-1}function st(t){return t.preventDefault?t.preventDefault():t.returnValue=!1,this}function at(t){return t.stopPropagation?t.stopPropagation():t.cancelBubble=!0,this}function ht(t){return t.onselectstart=function(){return!1},t.ondragstart=function(){return!1},t.setAttribute("unselectable","on"),this}function pt(t,e){return t?(ye.any3d?ft(t,e):(t.style.left=e.x+"px",t.style.top=e.y+"px"),e):null}function ut(t){var e=window.getComputedStyle(t),i=[parseInt(e["padding-left"]),parseInt(e["padding-top"])],n=t.getBoundingClientRect();return t.__position=[n.left+i[0],n.top+i[1]],t.__position}function ct(t,e){t||(t=window.event);var i=e.__position;return i||(i=ut(e)),new me(t.clientX-i[0]-e.clientLeft,t.clientY-i[1]-e.clientTop)}function lt(t,e){return r(t.className.baseVal)?t.className=e:t.className.baseVal=e,this}function ft(t,e){var i=e||new me(0,0);return t.style[we]=ye.ie3d?"translate("+i.x+"px,"+i.y+"px)":"translate3d("+i.x+"px,"+i.y+"px,0)",this}function yt(t){var e={stroke:{stroke:t.markerLineColor,"stroke-width":t.markerLineWidth,"stroke-opacity":t.markerLineOpacity,"stroke-dasharray":null,"stroke-linecap":"butt","stroke-linejoin":"round"},fill:{fill:t.markerFill,"fill-opacity":t.markerFillOpacity}};return"butt"===e.stroke["stroke-linecap"]&&ye.vml&&(e.stroke["stroke-linecap"]="flat"),0===e.stroke["stroke-width"]&&(e.stroke["stroke-opacity"]=0),e}function dt(t,e,i){if(!t.markerPath)return null;var s=1,a=yt(t);o(t.markerOpacity)&&(s=t.markerOpacity),o(t.opacity)&&(s*=t.opacity);var p={};if(a){for(var u in a.stroke)a.stroke.hasOwnProperty(u)&&(r(a.stroke[u])||(p[u]=a.stroke[u]));for(var c in a.fill)a.fill.hasOwnProperty(c)&&(r(a.fill[c])||(p[c]=a.fill[c]))}for(var l=Array.isArray(t.markerPath)?t.markerPath:[t.markerPath],f=void 0,y=[],d=0;d<l.length;d++)f=h(l[d])?{path:l[d]}:l[d],f=n({},f,p),f.d=f.path,delete f.path,y.push(f);var g=['<svg version="1.1"','xmlns="http://www.w3.org/2000/svg"'];s<1&&g.push('opacity="'+s+'"'),t.markerPathWidth&&t.markerPathHeight&&g.push('viewBox="0 0 '+t.markerPathWidth+" "+t.markerPathHeight+'"'),g.push('preserveAspectRatio="none"'),e&&g.push('width="'+e+'"'),i&&g.push('height="'+i+'"'),g.push("><defs></defs>");for(var m=0;m<y.length;m++){var _="<path ";for(var v in y[m])y[m].hasOwnProperty(v)&&(_+=" "+v+'="'+y[m][v]+'"');_+="></path>",g.push(_)}return g.push("</svg>"),"data:image/svg+xml;base64,"+L(g.join(" "))}function gt(t,e){if(!t)return[];var i=t;Array.isArray(t)||(i=[t]);for(var n=[],r=ge.resourceProperties,o=void 0,s=void 0,a=void 0,h=void 0,p=i.length-1;p>=0;p--)if(t=i[p]){e&&(t=mt(t));for(var u=0;u<r.length;u++)if(o=t[r[u]],q(o)&&(o=X(o)),o){Array.isArray(o)||(o=[o]);for(var c=0;c<o.length;c++)"url("===o[c].slice(0,4)&&(o[c]=E(o[c])),s=ge.resourceSizeProperties[u],n.push([o[c],t[s[0]],t[s[1]]])}if("path"===t.markerType&&t.markerPath)if(a=q(t.markerWidth)?200:t.markerWidth,h=q(t.markerHeight)?200:t.markerHeight,q(t.markerPath)){o=X(t.markerPath);for(var l=t.markerPath,f=0;f<o.length;f++)t.markerPath=o[f],n.push([dt(t),a,h]);t.markerPath=l}else n.push([dt(t),a,h])}return n}function mt(t){if(!t)return null;var e=t;if(Wt)return e;for(var i=ge.resourceProperties,n=void 0,r=0,o=i.length;r<o;r++)(n=e[i[r]])&&(e[i[r]]=_t(n));return e}function _t(t){if(q(t)){for(var e=t.stops,i=0;i<e.length;i++)e[i][1]=_t(e[i][1]);return t}return"url("===t.slice(0,4)&&(t=E(t)),!M(t)&&(t.length<="data:".length||"data:"!==t.substring(0,"data:".length))&&(t=vt(location.href,t)),t}function vt(t,e){var i=t.split("/"),n=e.split("/");if(0===e.slice(0,1))return i.slice(0,3).join("/")+e;i.pop();for(var r=0;r<n.length;r++)"."!==n[r]&&(".."===n[r]?i.pop():i.push(n[r]));return i.join("/")}function xt(t,e){return e={exports:{}},t(e,e.exports),e.exports}function wt(t){$e[t.measure]=t}function Pt(t,e,i){var n=e[0],r=e[1],o=e[2],s=e[3];return t[0]=i[0]*n+i[4]*r+i[8]*o+i[12]*s,t[1]=i[1]*n+i[5]*r+i[9]*o+i[13]*s,t[2]=i[2]*n+i[6]*r+i[10]*o+i[14]*s,t[3]=i[3]*n+i[7]*r+i[11]*o+i[15]*s,t}function Ct(t,e,i,n,r){var o=1/Math.tan(e/2),s=1/(n-r);return t[0]=o/i,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=o,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=(r+n)*s,t[11]=-1,t[12]=0,t[13]=0,t[14]=2*r*n*s,t[15]=0,t}function bt(t,e,i){var n,r,o,s,a,h,p,u,c,l,f,y,d=i[0],g=i[1],m=i[2];return e===t?(t[12]=e[0]*d+e[4]*g+e[8]*m+e[12],t[13]=e[1]*d+e[5]*g+e[9]*m+e[13],t[14]=e[2]*d+e[6]*g+e[10]*m+e[14],t[15]=e[3]*d+e[7]*g+e[11]*m+e[15]):(n=e[0],r=e[1],o=e[2],s=e[3],a=e[4],h=e[5],p=e[6],u=e[7],c=e[8],l=e[9],f=e[10],y=e[11],t[0]=n,t[1]=r,t[2]=o,t[3]=s,t[4]=a,t[5]=h,t[6]=p,t[7]=u,t[8]=c,t[9]=l,t[10]=f,t[11]=y,t[12]=n*d+a*g+c*m+e[12],t[13]=r*d+h*g+l*m+e[13],t[14]=o*d+p*g+f*m+e[14],t[15]=s*d+u*g+y*m+e[15]),t}function Mt(t,e,i){var n=i[0],r=i[1],o=i[2];return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*r,t[5]=e[5]*r,t[6]=e[6]*r,t[7]=e[7]*r,t[8]=e[8]*o,t[9]=e[9]*o,t[10]=e[10]*o,t[11]=e[11]*o,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function St(t,e,i){var n=Math.sin(i),r=Math.cos(i),o=e[4],s=e[5],a=e[6],h=e[7],p=e[8],u=e[9],c=e[10],l=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=o*r+p*n,t[5]=s*r+u*n,t[6]=a*r+c*n,t[7]=h*r+l*n,t[8]=p*r-o*n,t[9]=u*r-s*n,t[10]=c*r-a*n,t[11]=l*r-h*n,t}function Et(t,e,i){var n=Math.sin(i),r=Math.cos(i),o=e[0],s=e[1],a=e[2],h=e[3],p=e[4],u=e[5],c=e[6],l=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=o*r+p*n,t[1]=s*r+u*n,t[2]=a*r+c*n,t[3]=h*r+l*n,t[4]=p*r-o*n,t[5]=u*r-s*n,t[6]=c*r-a*n,t[7]=l*r-h*n,t}function Lt(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function Tt(){var t=new li(16);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Rt(t,e,i){var n=e[0],r=e[1],o=e[2],s=e[3],a=e[4],h=e[5],p=e[6],u=e[7],c=e[8],l=e[9],f=e[10],y=e[11],d=e[12],g=e[13],m=e[14],_=e[15],v=i[0],x=i[1],w=i[2],P=i[3];return t[0]=v*n+x*a+w*c+P*d,t[1]=v*r+x*h+w*l+P*g,t[2]=v*o+x*p+w*f+P*m,t[3]=v*s+x*u+w*y+P*_,v=i[4],x=i[5],w=i[6],P=i[7],t[4]=v*n+x*a+w*c+P*d,t[5]=v*r+x*h+w*l+P*g,t[6]=v*o+x*p+w*f+P*m,t[7]=v*s+x*u+w*y+P*_,v=i[8],x=i[9],w=i[10],P=i[11],t[8]=v*n+x*a+w*c+P*d,t[9]=v*r+x*h+w*l+P*g,t[10]=v*o+x*p+w*f+P*m,t[11]=v*s+x*u+w*y+P*_,v=i[12],x=i[13],w=i[14],P=i[15],t[12]=v*n+x*a+w*c+P*d,t[13]=v*r+x*h+w*l+P*g,t[14]=v*o+x*p+w*f+P*m,t[15]=v*s+x*u+w*y+P*_,t}function At(t,e){var i=e[0],n=e[1],r=e[2],o=e[3],s=e[4],a=e[5],h=e[6],p=e[7],u=e[8],c=e[9],l=e[10],f=e[11],y=e[12],d=e[13],g=e[14],m=e[15],_=i*a-n*s,v=i*h-r*s,x=i*p-o*s,w=n*h-r*a,P=n*p-o*a,C=r*p-o*h,b=u*d-c*y,M=u*g-l*y,S=u*m-f*y,E=c*g-l*d,L=c*m-f*d,T=l*m-f*g,R=_*T-v*L+x*E+w*S-P*M+C*b;return R?(R=1/R,t[0]=(a*T-h*L+p*E)*R,t[1]=(r*L-n*T-o*E)*R,t[2]=(d*C-g*P+m*w)*R,t[3]=(l*P-c*C-f*w)*R,t[4]=(h*S-s*T-p*M)*R,t[5]=(i*T-r*S+o*M)*R,t[6]=(g*x-y*C-m*v)*R,t[7]=(u*C-l*x+f*v)*R,t[8]=(s*L-a*S+p*b)*R,t[9]=(n*S-i*L-o*b)*R,t[10]=(y*P-d*x+m*_)*R,t[11]=(c*x-u*P-f*_)*R,t[12]=(a*M-s*E-h*b)*R,t[13]=(i*E-n*M+r*b)*R,t[14]=(d*v-y*w-g*_)*R,t[15]=(u*w-c*v+l*_)*R,t):null}function It(t,e,i){var n=t.x,r=t.y,o=e.x,s=e.y,a=i.x,h=i.y,p=(a-o)*(n-o)+(h-s)*(r-s);if(p<=0)return Math.sqrt((n-o)*(n-o)+(r-s)*(r-s));var u=(a-o)*(a-o)+(h-s)*(h-s);if(p>=u)return Math.sqrt((n-a)*(n-a)+(r-h)*(r-h));var c=p/u,l=o+(a-o)*c,f=s+(h-s)*c;return Math.sqrt((n-l)*(n-l)+(r-f)*(r-f))}function kt(t,e){for(var i=void 0,n=void 0,r=e.length,o=!1,s=0,a=r-1;s<r;a=s++)i=e[s],n=e[a],i.y>t.y!=n.y>t.y&&t.x<(n.x-i.x)*(t.y-i.y)/(n.y-i.y)+i.x&&(o=!o);return o}function jt(t){t.layer.options.drawImmediate&&t.render(),t.setToRedraw()}function Ot(t,e){for(var i in t)if(t[i]!==e[i])return!1;return!0}var Dt=["MultiPoint","MultiLineString","MultiPolygon","GeometryCollection"],zt=["FeatureCollection","Feature","Point","LineString","Polygon"].concat(Dt),Gt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Zt=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},Ft=function(t,i){if("function"!=typeof i&&null!==i)throw new TypeError("Super expression must either be null or a function, not "+typeof i);t.prototype=Object.create(i&&i.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),i&&(Object.setPrototypeOf?Object.setPrototypeOf(t,i):e(t,i))},Nt=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e},Ht=Object.prototype.hasOwnProperty,Wt=function(){return new Function("try { return this === global; } catch(e) { return false; }")()}(),Bt=void 0,Vt=void 0;!function(){function t(t){return setTimeout(t,r)}function e(t){return window["webkit"+t]||window["moz"+t]||window["ms"+t]}if(Wt)return Bt=function(t){return setTimeout(t,16)},void(Vt=clearTimeout);var i=void 0,n=void 0,r=1e3/30;"undefined"!=typeof window?(i=window.requestAnimationFrame||e("RequestAnimationFrame")||t,n=window.cancelAnimationFrame||e("CancelAnimationFrame")||e("CancelRequestAnimationFrame")||function(t){window.clearTimeout(t)}):(i=t,n=clearTimeout),Bt=function(t){return i(t)},Vt=function(t){t&&n(t)}}();var Jt=0,Ut=/^url\(([\'\"])(.+)\1\)$/i,qt=/^url\(([^\'\"].*[^\'\"])\)$/i,Qt="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",Yt={};if(!Wt){var Xt=navigator.userAgent.toLowerCase(),$t=document.documentElement,Kt="ActiveXObject"in window,te=-1!==Xt.indexOf("webkit"),ee=-1!==Xt.indexOf("phantom"),ie=-1!==Xt.search("android [23]"),ne=-1!==Xt.indexOf("chrome"),re=-1!==Xt.indexOf("gecko")&&!te&&!window.opera&&!Kt,oe="undefined"!=typeof orientation||-1!==Xt.indexOf("mobile"),se=!window.PointerEvent&&window.MSPointerEvent,ae=window.PointerEvent&&navigator.pointerEnabled||se,he=Kt&&"transition"in $t.style,pe="WebKitCSSMatrix"in window&&"m11"in new window.WebKitCSSMatrix&&!ie,ue="MozPerspective"in $t.style,ce="OTransition"in $t.style,le=(he||pe||ue)&&!ce&&!ee,fe=!ee&&(ae||"ontouchstart"in window||window.DocumentTouch&&document instanceof window.DocumentTouch);Yt={ie:Kt,ielt9:Kt&&!document.addEventListener,edge:"msLaunchUri"in navigator&&!("documentMode"in document),webkit:te,gecko:re,android:-1!==Xt.indexOf("android"),android23:ie,chrome:ne,safari:!ne&&-1!==Xt.indexOf("safari"),phantomjs:ee,ie3d:he,webkit3d:pe,gecko3d:ue,opera12:ce,any3d:le,mobile:oe,mobileWebkit:oe&&te,mobileWebkit3d:oe&&pe,mobileOpera:oe&&window.opera,mobileGecko:oe&&re,touch:!!fe,msPointer:!!se,pointer:!!ae,retina:(window.devicePixelRatio||window.screen.deviceXDPI/window.screen.logicalXDPI)>1,language:navigator.browserLanguage?navigator.browserLanguage:navigator.language,ie9:Kt&&9===document.documentMode,ie10:Kt&&10===document.documentMode}}var ye=Yt,de=["Unknown","Point","LineString","Polygon","MultiPoint","MultiLineString","MultiPolygon","GeometryCollection"],ge=function(){function t(){Zt(this,t)}return t.prototype.getMap=function(){return this.geometry.getMap()},t.prototype.getPainter=function(){return this.painter},t.testColor=function(e){return!(!e||!h(e))&&t.colorProperties.indexOf(e)>=0},t}();ge.resourceProperties=["markerFile","polygonPatternFile","linePatternFile","markerFillPatternFile","markerLinePatternFile"],ge.resourceSizeProperties=[["markerWidth","markerHeight"],[],[null,"lineWidth"],[],[null,"markerLineWidth"]],ge.numericalProperties={lineWidth:1,lineOpacity:1,lineDx:1,lineDy:1,polygonOpacity:1,markerWidth:1,markerHeight:1,markerDx:1,markerDy:1,markerOpacity:1,markerFillOpacity:1,markerLineWidth:1,markerLineOpacity:1,textSize:1,textOpacity:1,textHaloRadius:1,textWrapWidth:1,textLineSpacing:1,textDx:1,textDy:1},ge.colorProperties=["lineColor","polygonFill","markerFill","markerLineColor","textFill"];var me=function(){function t(e,i){if(Zt(this,t),r(e)||r(i)?r(e.x)||r(e.y)?b(e)&&(this.x=e[0],this.y=e[1]):(this.x=e.x,this.y=e.y):(this.x=e,this.y=i),this._isNaN())throw new Error("point is NaN")}return t.prototype.abs=function(){return new t(Math.abs(this.x),Math.abs(this.y))},t.prototype._abs=function(){return this.x=Math.abs(this.x),this.y=Math.abs(this.y),this},t.prototype.copy=function(){return new t(this.x,this.y)},t.prototype._round=function(){return this.x=v(this.x),this.y=v(this.y),this},t.prototype.round=function(){return new t(v(this.x),v(this.y))},t.prototype._ceil=function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},t.prototype.ceil=function(){return new t(Math.ceil(this.x),Math.ceil(this.y))},t.prototype._floor=function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},t.prototype.floor=function(){return new t(Math.floor(this.x),Math.floor(this.y))},t.prototype.equals=function(t){return this.x===t.x&&this.y===t.y},t.prototype.distanceTo=function(t){var e=t.x-this.x,i=t.y-this.y;return Math.sqrt(e*e+i*i)},t.prototype._add=function(e,i){return e instanceof t?(this.x+=e.x,this.y+=e.y):(this.x+=e,this.y+=i),this},t.prototype.add=function(e,i){var n=void 0,r=void 0;return e instanceof t?(n=this.x+e.x,r=this.y+e.y):(n=this.x+e,r=this.y+i),new t(n,r)},t.prototype._sub=function(e,i){return e instanceof t?(this.x-=e.x,this.y-=e.y):(this.x-=e,this.y-=i),this},t.prototype._substract=function(){return this._sub.apply(this,arguments)},t.prototype.sub=function(e,i){var n=void 0,r=void 0;return e instanceof t?(n=this.x-e.x,r=this.y-e.y):(n=this.x-e,r=this.y-i),new t(n,r)},t.prototype.substract=function(){return this.sub.apply(this,arguments)},t.prototype._multi=function(t){return this.x*=t,this.y*=t,this},t.prototype.multi=function(e){return new t(this.x*e,this.y*e)},t.prototype.div=function(t){return this.multi(1/t)},t.prototype._div=function(t){return this._multi(1/t)},t.prototype._isNaN=function(){return isNaN(this.x)||isNaN(this.y)},t.prototype.toArray=function(){return[this.x,this.y]},t.prototype.toJSON=function(){return{x:this.x,y:this.y}},t.prototype.mag=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},t.prototype.unit=function(){return this.copy()._unit()},t.prototype._unit=function(){return this._div(this.mag()),this},t.prototype.perp=function(){return this.copy()._perp()},t.prototype._perp=function(){var t=this.y;return this.y=this.x,this.x=-t,this},t.prototype.isZero=function(){return 0===this.x&&0===this.y},t}(),_e=function(){function t(e,i){Zt(this,t),o(e)&&o(i)?(this.width=e,this.height=i):o(e.width)?(this.width=e.width,this.height=e.height):Array.isArray(e)&&(this.width=e[0],this.height=e[1])}return t.prototype.copy=function(){return new t(this.width,this.height)},t.prototype.add=function(e){return new t(this.width+e.width,this.height+e.height)},t.prototype.equals=function(t){return this.width===t.width&&this.height===t.height},t.prototype.multi=function(e){return new t(this.width*e,this.height*e)},t.prototype._multi=function(t){return this.width*=t,this.height*=t,this},t.prototype._round=function(){return this.width=v(this.width),this.height=v(this.height),this},t.prototype.toPoint=function(){return new me(this.width,this.height)},t.prototype.toArray=function(){return[this.width,this.height]},t.prototype.toJSON=function(){return{width:this.width,height:this.height}},t}(),ve=function(t){return t[0]},xe=Wt?ve:function(t){for(var e=document.documentElement.style,i=0;i<t.length;i++)if(t[i]in e)return t[i];return!1},we=xe(["transform","WebkitTransform","OTransform","MozTransform","msTransform"]),Pe=(xe(["transformOrigin","WebkitTransformOrigin","OTransformOrigin","MozTransformOrigin","msTransformOrigin"]),xe(["transition","WebkitTransition","OTransition","MozTransition","msTransition"]),xe(["filter","WebkitFilter","OFilter","MozFilter","msFilter"]),{createCanvas:function(t,e,i){var n=void 0;return Wt?n=new i(t,e):(n=it("canvas"),n.width=t,n.height=e),n},setDefaultCanvasSetting:function(t){t.lineWidth=1,t.lineCap="butt",t.lineJoin="miter",t.strokeStyle="rgba(0,0,0,1)",t.fillStyle="rgba(255,255,255,0)",t.textAlign="start",t.textBaseline="top";t.font="11px monospace",t.shadowBlur=null,t.shadowColor=null,t.setLineDash&&t.setLineDash([]),t.globalAlpha=1},prepareCanvasFont:function(t,e){t.textBaseline="top",t.font=et(e);var i=e.textFill;i||(i="#000"),t.fillStyle=Pe.getRgba(i,e.textOpacity)},prepareCanvas:function(t,e,i){if(e){var n=e.lineWidth;r(n)||t.lineWidth===n||(t.lineWidth=n);var o=e.linePatternFile||e.lineColor||"#000";S(o)&&i?(Pe._setStrokePattern(t,o,n,i),e.lineDasharray=[]):$(o)?e.lineGradientExtent?t.strokeStyle=Pe._createGradient(t,o,e.lineGradientExtent):t.strokeStyle="rgba(0,0,0,1)":t.strokeStyle=o,e.lineJoin&&(t.lineJoin=e.lineJoin),e.lineCap&&(t.lineCap=e.lineCap),t.setLineDash&&b(e.lineDasharray)&&t.setLineDash(e.lineDasharray);var s=e.polygonPatternFile||e.polygonFill||"rgba(255,255,255,0)";if(S(s)){var a=E(s),h=i.getImage([a,null,null]);if(h||(h=i.getImage([a+"-texture",null,n])),c(a)&&h instanceof Image&&(ye.edge||ye.ie)){var p=h.width||20,u=h.height||20,l=Pe.createCanvas(p,u);Pe.image(l.getContext("2d"),h,0,0,p,u),h=l}h?t.fillStyle=t.createPattern(h,"repeat"):"undefined"!=typeof console&&console.warn("img not found for",a)}else $(s)?e.polygonGradientExtent?t.fillStyle=Pe._createGradient(t,s,e.polygonGradientExtent):t.fillStyle="rgba(255,255,255,0)":t.fillStyle=s}},_createGradient:function(t,e,i){var n=null,r=e.places,o=i.getMin(),s=i.getMax(),a=i.getWidth(),h=i.getHeight();if(e.type&&"linear"!==e.type){if("radial"===e.type){if(r){if(6!==r.length)throw new Error("A radial gradient's places should have 6 numbers.");r=[o.x+r[0]*a,o.y+r[1]*h,a*r[2],o.x+r[3]*a,o.y+r[4]*h,a*r[5]]}else{var p=i.getCenter()._round();r=[p.x,p.y,Math.abs(p.x-o.x),p.x,p.y,0]}n=t.createRadialGradient.apply(t,r)}}else{if(r){if(4!==r.length)throw new Error("A linear gradient's places should have 4 numbers.");r=[o.x+r[0]*a,o.y+r[1]*h,o.x+r[2]*a,o.y+r[3]*h]}else r=[o.x,o.y,s.x,o.y];n=t.createLinearGradient.apply(t,r)}return e.colorStops.forEach(function(t){n.addColorStop.apply(n,t)}),n},_setStrokePattern:function(t,e,i,n){var r=E(e),o=void 0;if(Wt)o=n.getImage([r,null,i]);else{var s=r+"-texture-"+i;if(!(o=n.getImage(s))){var a=n.getImage([r,null,null]);if(a){var h=void 0;h=a.width&&a.height?v(a.width*i/a.height):i;var p=Pe.createCanvas(h,i,t.canvas.constructor);Pe.image(p.getContext("2d"),a,0,0,h,i),n.addResource([s,null,i],p),o=p}}}o?t.strokeStyle=t.createPattern(o,"repeat"):"undefined"!=typeof console&&console.warn("img not found for",r)},clearRect:function(t,e,i,n,r){t.canvas._drawn=!1,t.clearRect(e,i,n,r)},fillCanvas:function(t,e,i,n){if(t.canvas._drawn=!0,0!==e){var o=Pe._isPattern(t.fillStyle);r(e)&&(e=1);var s=void 0;e<1&&(s=t.globalAlpha,t.globalAlpha*=e),o&&t.translate(i,n),t.fill(),o&&t.translate(-i,-n),e<1&&(t.globalAlpha=s)}},getRgba:function(t,e){if(r(e)&&(e=1),"#"!==t[0])return t;var i=void 0,n=void 0,o=void 0;return 7===t.length?(i=parseInt(t.substring(1,3),16),n=parseInt(t.substring(3,5),16),o=parseInt(t.substring(5,7),16)):(i=17*parseInt(t.substring(1,2),16),n=17*parseInt(t.substring(2,3),16),o=17*parseInt(t.substring(3,4),16)),"rgba("+i+","+n+","+o+","+e+")"},image:function(t,e,i,n,r,s){t.canvas._drawn=!0;try{o(r)&&o(s)?t.drawImage(e,i,n,r,s):t.drawImage(e,i,n)}catch(t){console&&(console.warn("error when drawing image on canvas:",t),console.warn(e))}},text:function(t,e,i,n,r){Pe._textOnMultiRow(t,r.rows,n,i,r.size,r.rawSize)},_textOnMultiRow:function(t,e,i,n,r,o){for(var s=tt(r,i.textHorizontalAlignment,i.textVerticalAlignment),a=o.height+i.textLineSpacing,h=n.add(0,s.y),p=void 0,u=void 0,c=0,l=e.length;c<l;c++)p=e[c].text,u=tt(e[c].size,i.textHorizontalAlignment,i.textVerticalAlignment),Pe._textOnLine(t,p,h.add(u.x,c*a),i.textHaloRadius,i.textHaloFill,i.textHaloOpacity)},_textOnLine:function(t,e,i,n,r,o){if(t.textBaseline="top",0!==o&&0!==n){var s=t.globalAlpha;o&&(t.globalAlpha*=o),n&&(t.miterLimit=2,t.lineJoin="round",t.lineCap="round",t.lineWidth=2*n-1,t.strokeStyle=r,t.strokeText(e,v(i.x),v(i.y)),t.lineWidth=1,t.miterLimit=10),o&&(t.globalAlpha=s)}Pe.fillText(t,e,i)},fillText:function(t,e,i,n){t.canvas._drawn=!0,n&&(t.fillStyle=n),t.fillText(e,v(i.x),v(i.y))},_stroke:function(t,e,i,n){t.canvas._drawn=!0;var o=Pe._isPattern(t.strokeStyle)&&!r(i)&&!r(n);r(e)&&(e=1);var s=void 0;e<1&&(s=t.globalAlpha,t.globalAlpha*=e),o&&t.translate(i,n),t.stroke(),o&&t.translate(-i,-n),e<1&&(t.globalAlpha=s)},_path:function(t,e,i,n,r){if(b(e))for(var o=b(i),s=!0!==r&&Pe._isPattern(t.strokeStyle),a=void 0,h=void 0,p=void 0,u=0,c=e.length;u<c;u++)if(a=e[u],!o||t.setLineDash)t.lineTo(a.x,a.y),s&&u>0&&(h=e[u-1],function(e,i){var r=T(e,i);t.save(),t.translate(e.x,e.y-t.lineWidth/2/Math.cos(r)),t.rotate(r),Pe._stroke(t,n),t.restore()}(h,a),t.beginPath(),t.moveTo(a.x,a.y));else if(o){if(u===c-1)break;p=e[u+1],function(e,i,n){var r=e.x,o=e.y,s=i.x,a=i.y,h=n,p=function(t,e){return t<=e},u=function(t,e){return t>=e},c=function(t,e){return Math.min(t,e)},l=function(t,e){return Math.max(t,e)},f={thereYet:u,cap:c},y={thereYet:u,cap:c};o-a>0&&(y.thereYet=p,y.cap=l),r-s>0&&(f.thereYet=p,f.cap=l),t.moveTo(r,o);for(var d=r,g=o,m=0,_=!0,v=void 0,x=void 0;!f.thereYet(d,s)||!y.thereYet(g,a);)v=Math.atan2(a-o,s-r),x=h[m],d=f.cap(s,d+Math.cos(v)*x),g=y.cap(a,g+Math.sin(v)*x),_?t.lineTo(d,g):t.moveTo(d,g),m=(m+1)%h.length,_=!_}(a,p,i)}},path:function(t,e,i,n,r){t.beginPath(),t.moveTo(e[0].x,e[0].y),Pe._path(t,e,r,i),Pe._stroke(t,i)},polygon:function(t,e,i,n,r){function o(e,i,n){Pe.fillCanvas(t,n,e[i][0].x,e[i][0].y)}var s=Pe._isPattern(t.strokeStyle),a=b(r)&&!t.setLineDash||s;b(e[0])||(e=[e]);var h=void 0,p=void 0,u=void 0;if(a){for(t.save(),p=0,u=e.length;p<u;p++)Pe._ring(t,e[p],null,0,!0),h=n,p>0&&(t.globalCompositeOperation="destination-out",h=1),o(e,p,h),p>0?t.globalCompositeOperation="source-over":t.fillStyle="#fff",Pe._stroke(t,0);t.restore()}for(p=0,u=e.length;p<u;p++)Pe._ring(t,e[p],r,i),a||(h=n,p>0&&(t.globalCompositeOperation="destination-out",h=1),o(e,p,h),p>0?t.globalCompositeOperation="source-over":t.fillStyle="#fff"),Pe._stroke(t,i)},_ring:function(t,e,i,n,r){var o=Pe._isPattern(t.strokeStyle);r||!o||e[0].equals(e[e.length-1])||(e=e.concat([e[0]])),t.beginPath(),t.moveTo(e[0].x,e[0].y),Pe._path(t,e,i,n,r),o||t.closePath()},_arcBetween:function(t,e,i,n){var r=n,o=e.distanceTo(i),s=o/2/Math.sin(r/2),a=Math.asin((i.y-e.y)/o);e.x>i.x&&(a=Math.PI-a);var h=90*Math.PI/180-r/2,p=a-h,u=Math.cos(p)*s,c=Math.sin(p)*s,l=e.x+u,f=e.y+c,y=Math.asin((i.y-f)/s);l>i.x&&(y=Math.PI-y);var d=y+r;t.beginPath(),t.arc(l,f,s,y,d)},_lineTo:function(t,e){t.lineTo(e.x,e.y)},bezierCurveAndFill:function(t,e,i,n){t.beginPath();var r=e[0];t.moveTo(r.x,r.y);var o=[t];o.push.apply(o,e.splice(1)),Pe._bezierCurveTo.apply(Pe,o),Pe.fillCanvas(t,n),Pe._stroke(t,i)},_bezierCurveTo:function(t,e,i,n){t.bezierCurveTo(e.x,e.y,i.x,i.y,n.x,n.y)},ellipse:function(t,e,i,n,r,o){i===n?(t.beginPath(),t.arc(e.x,e.y,i,0,2*Math.PI),Pe.fillCanvas(t,o,e.x-i,e.y-n),Pe._stroke(t,r,e.x-i,e.y-n)):function(s,a,h,p){var u=.5522848,c=h*u,l=p*u;t.beginPath(),t.moveTo(s-h,a),t.bezierCurveTo(s-h,a-l,s-c,a-p,s,a-p),t.bezierCurveTo(s+c,a-p,s+h,a-l,s+h,a),t.bezierCurveTo(s+h,a+l,s+c,a+p,s,a+p),t.bezierCurveTo(s-c,a+p,s-h,a+l,s-h,a),t.closePath(),Pe.fillCanvas(t,o,e.x-i,e.y-n),Pe._stroke(t,r,e.x-i,e.y-n)}(e.x,e.y,i,n)},rectangle:function(t,e,i,n,r){t.beginPath(),t.rect(e.x,e.y,i.width,i.height),Pe.fillCanvas(t,r,e.x,e.y),Pe._stroke(t,n,e.x,e.y)},sector:function(t,e,i,n,r,o){var s=n[0],a=n[1];!function(t,e,i,n,s,a){var h=Math.PI/180,p=h*-a,u=h*-s;t.beginPath(),t.moveTo(e,i),t.arc(e,i,n,p,u),t.lineTo(e,i),
Pe.fillCanvas(t,o,e-n,i-n),Pe._stroke(t,r,e-n,i-n)}(t,e.x,e.y,i,s,a)},_isPattern:function(t){return!(h(t)||"addColorStop"in t)},quadraticCurve:function(t,e){if(e&&!(e.length<=2)){var i=(e[0].x+e[1].x)/2,n=(e[0].y+e[1].y)/2;t.lineTo(i,n);for(var r=Pe._getQuadCurvePoints(e),o=0,s=r.length;o<s;o+=4)t.quadraticCurveTo(r[o],r[o+1],r[o+2],r[o+3]);t.lineTo(e[e.length-1].x,e[e.length-1].y)}},_getQuadCurvePoints:function(t){for(var e=[],i=void 0,n=void 0,r=1,o=t.length;r<o-1;r++)i=(t[r].x+t[r+1].x)/2,n=(t[r].y+t[r+1].y)/2,e.push(t[r].x,t[r].y,i,n);return e},drawCross:function(t,e,i,n){t.canvas._drawn=!0,t.strokeStyle=n,t.lineWidth=i,t.beginPath(),t.moveTo(e.x-5,e.y),t.lineTo(e.x+5,e.y),t.moveTo(e.x,e.y-5),t.lineTo(e.x,e.y+5),t.stroke()}}),Ce=function(){function t(e,i){if(Zt(this,t),r(e)||r(i)?Array.isArray(e)?(this.x=+e[0],this.y=+e[1]):r(e.x)||r(e.y)||(this.x=+e.x,this.y=+e.y):(this.x=+e,this.y=+i),this._isNaN())throw new Error("coordinate is NaN")}return t.toNumberArrays=function(t){return Array.isArray(t)?m(t,function(t){return[t.x,t.y]}):[t.x,t.y]},t.toCoordinates=function(e){if(o(e[0])&&o(e[1]))return new t(e);for(var i=[],n=0,r=e.length;n<r;n++){var s=e[n];Array.isArray(s)?o(s[0])?i.push(new t(s)):i.push(t.toCoordinates(s)):i.push(new t(s))}return i},t.prototype.copy=function(){return new t(this.x,this.y)},t.prototype._add=function(e,i){return e instanceof t?(this.x+=e.x,this.y+=e.y):(this.x+=e,this.y+=i),this},t.prototype.add=function(e,i){var n=void 0,r=void 0;return e instanceof t?(n=this.x+e.x,r=this.y+e.y):(n=this.x+e,r=this.y+i),new t(n,r)},t.prototype._sub=function(e,i){return e instanceof t?(this.x-=e.x,this.y-=e.y):(this.x-=e,this.y-=i),this},t.prototype._substract=function(){return this._sub.apply(this,arguments)},t.prototype.sub=function(e,i){var n=void 0,r=void 0;return e instanceof t?(n=this.x-e.x,r=this.y-e.y):(n=this.x-e,r=this.y-i),new t(n,r)},t.prototype.substract=function(){return this.sub.apply(this,arguments)},t.prototype.multi=function(e){return new t(this.x*e,this.y*e)},t.prototype._multi=function(t){return this.x*=t,this.y*=t,this},t.prototype.equals=function(e){return e instanceof t&&(this.x===e.x&&this.y===e.y)},t.prototype._isNaN=function(){return isNaN(this.x)||isNaN(this.y)},t.prototype.toArray=function(){return[this.x,this.y]},t.prototype.toFixed=function(e){return new t(this.x.toFixed(e),this.y.toFixed(e))},t.prototype.toJSON=function(){return{x:this.x,y:this.y}},t}(),be=function(){function t(e,i,n,r){Zt(this,t),this._clazz=Ce,this._initialize(e,i,n,r)}return t.prototype._initialize=function(t,e,i,n){if(this.xmin=null,this.xmax=null,this.ymin=null,this.ymax=null,!r(t))return o(t)&&o(e)&&o(i)&&o(n)?(this.xmin=Math.min(t,i),this.ymin=Math.min(e,n),this.xmax=Math.max(t,i),void(this.ymax=Math.max(e,n))):void(o(t.x)&&o(e.x)&&o(t.y)&&o(e.y)?(t.x>e.x?(this.xmin=e.x,this.xmax=t.x):(this.xmin=t.x,this.xmax=e.x),t.y>e.y?(this.ymin=e.y,this.ymax=t.y):(this.ymin=t.y,this.ymax=e.y)):o(t.xmin)&&o(t.xmax)&&o(t.ymin)&&o(t.ymax)&&(this.xmin=t.xmin,this.ymin=t.ymin,this.xmax=t.xmax,this.ymax=t.ymax))},t.prototype._add=function(t){return r(t.x)?r(t.xmin)?r(t[0])||(this.xmin+=t[0],this.ymin+=t[1],this.xmax+=t[0],this.ymax+=t[1]):(this.xmin+=t.xmin,this.ymin+=t.ymin,this.xmax+=t.xmax,this.ymax+=t.ymax):(this.xmin+=t.x,this.ymin+=t.y,this.xmax+=t.x,this.ymax+=t.y),this},t.prototype.add=function(){var t=new this.constructor(this.xmin,this.ymin,this.xmax,this.ymax);return t._add.apply(t,arguments)},t.prototype._sub=function(t){return r(t.x)?r(t.xmin)?r(t[0])||(this.xmin-=t[0],this.ymin-=t[1],this.xmax-=t[0],this.ymax-=t[1]):(this.xmin-=t.xmin,this.ymin-=t.ymin,this.xmax-=t.xmax,this.ymax-=t.ymax):(this.xmin-=t.x,this.ymin-=t.y,this.xmax-=t.x,this.ymax-=t.y),this},t.prototype._substract=function(){return this._sub.apply(this,arguments)},t.prototype.sub=function(){var t=new this.constructor(this.xmin,this.ymin,this.xmax,this.ymax);return t._sub.apply(t,arguments)},t.prototype.substract=function(){return this.sub.apply(this,arguments)},t.prototype.round=function(){return new this.constructor(v(this.xmin),v(this.ymin),v(this.xmax),v(this.ymax))},t.prototype._round=function(){return this.xmin=v(this.xmin),this.ymin=v(this.ymin),this.xmax=v(this.xmax),this.ymax=v(this.ymax),this},t.prototype.getMin=function(){return new this._clazz(this.xmin,this.ymin)},t.prototype.getMax=function(){return new this._clazz(this.xmax,this.ymax)},t.prototype.getCenter=function(){return new this._clazz((this.xmin+this.xmax)/2,(this.ymin+this.ymax)/2)},t.prototype.isValid=function(){return o(this.xmin)&&o(this.ymin)&&o(this.xmax)&&o(this.ymax)},t.prototype.equals=function(t){return this.xmin===t.xmin&&this.xmax===t.xmax&&this.ymin===t.ymin&&this.ymax===t.ymax},t.prototype.intersects=function(t){var e=Math.max(this.xmin,t.xmin),i=Math.max(this.ymin,t.ymin),n=Math.min(this.xmax,t.xmax),r=Math.min(this.ymax,t.ymax);return!(e>n||i>r)},t.prototype.contains=function(t){return t.x>=this.xmin&&t.x<=this.xmax&&t.y>=this.ymin&&t.y<=this.ymax},t.prototype.getWidth=function(){return this.xmax-this.xmin},t.prototype.getHeight=function(){return this.ymax-this.ymin},t.prototype.__combine=function(t){(t instanceof me||t instanceof Ce)&&(t={xmin:t.x,xmax:t.x,ymin:t.y,ymax:t.y});var e=this.xmin;o(e)?o(t.xmin)&&e>t.xmin&&(e=t.xmin):e=t.xmin;var i=this.xmax;o(i)?o(t.xmax)&&i<t.xmax&&(i=t.xmax):i=t.xmax;var n=this.ymin;o(n)?o(t.ymin)&&n>t.ymin&&(n=t.ymin):n=t.ymin;var r=this.ymax;return o(r)?o(t.ymax)&&r<t.ymax&&(r=t.ymax):r=t.ymax,[e,n,i,r]},t.prototype._combine=function(t){if(!t)return this;var e=this.__combine(t);return this.xmin=e[0],this.ymin=e[1],this.xmax=e[2],this.ymax=e[3],this},t.prototype.combine=function(t){if(!t)return this;var e=this.__combine(t);return new this.constructor(e[0],e[1],e[2],e[3])},t.prototype.intersection=function(t){return this.intersects(t)?new this.constructor(Math.max(this.xmin,t.xmin),Math.max(this.ymin,t.ymin),Math.min(this.xmax,t.xmax),Math.min(this.ymax,t.ymax)):null},t.prototype.expand=function(t){return t instanceof _e?new this.constructor(this.xmin-t.width,this.ymin-t.height,this.xmax+t.width,this.ymax+t.height):new this.constructor(this.xmin-t,this.ymin-t,this.xmax+t,this.ymax+t)},t.prototype._expand=function(t){return t instanceof _e?(this.xmin-=t.width,this.ymin-=t.height,this.xmax+=t.width,this.ymax+=t.height):(this.xmin-=t,this.ymin-=t,this.xmax+=t,this.ymax+=t),this},t.prototype.toJSON=function(){return{xmin:this.xmin,ymin:this.ymin,xmax:this.xmax,ymax:this.ymax}},t.prototype.toArray=function(){var t=this.xmin,e=this.ymin,i=this.xmax,n=this.ymax;return[new this._clazz([t,n]),new this._clazz([i,n]),new this._clazz([i,e]),new this._clazz([t,e]),new this._clazz([t,n])]},t.prototype.copy=function(){return new this.constructor(this.xmin,this.ymin,this.xmax,this.ymax)},t.prototype.convertTo=function(t){if(!this.isValid())return null;var e=new this.constructor;return this.toArray().forEach(function(i){e._combine(t(i))}),e},t}(),Me=function(t){function e(i,n,r,o){Zt(this,e);var s=Nt(this,t.call(this,i,n,r,o));return s._clazz=me,s}return Ft(e,t),e.prototype.getSize=function(){return new _e(this.getWidth(),this.getHeight())},e}(be),Se=function(t){function e(){return Zt(this,e),Nt(this,t.apply(this,arguments))}return Ft(e,t),e.prototype._prepareContext=function(t){o(this.symbol.opacity)?t.globalAlpha!==this.symbol.opacity&&(t.globalAlpha=this.symbol.opacity):1!==t.globalAlpha&&(t.globalAlpha=1)},e.prototype.remove=function(){},e.prototype.setZIndex=function(){},e.prototype.show=function(){},e.prototype.hide=function(){},e.prototype._defineStyle=function(t){var e=this;return Y(t,function(){return[e.getMap().getZoom(),e.geometry.getProperties()]})},e}(ge),Ee=function(t){function e(i,n,r){Zt(this,e);var o=Nt(this,t.call(this));return o.symbol=i,o.geometry=n,o.painter=r,"Point"===n.type?Nt(o):(o.style=o._defineStyle(o.translate()),o)}return Ft(e,t),e.test=function(t,e){if(!t)return!1;if(e&&"Point"===e.type)return!1;for(var i in t){var n=i.slice(0,4);if("line"===n||"poly"===n)return!0}return!1},e.prototype.symbolize=function(t,e){if("Point"!==this.geometry.type){var i=this.style;if(0!==i.polygonOpacity||0!==i.lineOpacity){var n=this._getPaintParams();if(n){this._prepareContext(t);var r=$(i.lineColor),o="Polygon"===this.geometry.getJSONType()||"LineString"===this.geometry.type;!r||!i.lineColor.places&&o||(i.lineGradientExtent=this.getPainter().getContainerExtent()._expand(i.lineWidth)),$(i.polygonFill)&&(i.polygonGradientExtent=this.getPainter().getContainerExtent());var s=n[0];if("Polygon"===this.geometry.getJSONType()&&s.length>1&&Array.isArray(s[0][0])||"LineString"===this.geometry.type&&s.length>1&&Array.isArray(s[0]))for(var a=0;a<s.length;a++){Pe.prepareCanvas(t,i,e),r&&o&&!i.lineColor.places&&this._createGradient(t,s[a],i.lineColor);var h=[t,s[a]];n.length>1&&h.push.apply(h,n.slice(1)),h.push(i.lineOpacity,i.polygonOpacity,i.lineDasharray),this.geometry._paintOn.apply(this.geometry,h)}else{Pe.prepareCanvas(t,i,e),r&&o&&!i.lineColor.places&&this._createGradient(t,s,i.lineColor);var p=[t];p.push.apply(p,n),p.push(i.lineOpacity,i.polygonOpacity,i.lineDasharray),this.geometry._paintOn.apply(this.geometry,p)}t.setLineDash&&Array.isArray(i.lineDasharray)&&t.setLineDash([])}}}},e.prototype.get2DExtent=function(){if("Point"===this.geometry.type)return null;var t=this.getMap(),e=this.geometry._getPrjExtent();if(!e)return null;this._extMin&&this._extMax||(this._extMin=new Ce(0,0),this._extMax=new Ce(0,0)),this._extMin.x=e.xmin,this._extMin.y=e.ymin,this._extMax.x=e.xmax,this._extMax.y=e.ymax;var i=t._prjToPoint(this._extMin),n=t._prjToPoint(this._extMax);return this._pxExtent?(i.x<n.x?(this._pxExtent.xmin=i.x,this._pxExtent.xmax=n.x):(this._pxExtent.xmax=i.x,this._pxExtent.xmin=n.x),i.y<n.y?(this._pxExtent.ymin=i.y,this._pxExtent.ymax=n.y):(this._pxExtent.ymax=i.y,this._pxExtent.ymin=n.y)):this._pxExtent=new Me(i,n),this._pxExtent._expand(this.style.lineWidth/2)},e.prototype._getPaintParams=function(){return this.getPainter().getPaintParams(this.style.lineDx,this.style.lineDy)},e.prototype.translate=function(){var t=this.symbol,e={lineColor:_(t.lineColor,"#000"),lineWidth:_(t.lineWidth,2),lineOpacity:_(t.lineOpacity,1),lineDasharray:_(t.lineDasharray,[]),lineCap:_(t.lineCap,"butt"),lineJoin:_(t.lineJoin,"miter"),linePatternFile:_(t.linePatternFile,null),lineDx:_(t.lineDx,0),lineDy:_(t.lineDy,0),polygonFill:_(t.polygonFill,null),polygonOpacity:_(t.polygonOpacity,1),polygonPatternFile:_(t.polygonPatternFile,null)};return 0===e.lineWidth&&(e.lineOpacity=0),"LineString"!==this.geometry.type||e.polygonFill||(e.polygonFill=e.lineColor),e},e.prototype._createGradient=function(t,e,i){if(Array.isArray(e)){var n=e.length,r=t.createLinearGradient(e[0].x,e[0].y,e[n-1].x,e[n-1].y);i.colorStops.forEach(function(t){r.addColorStop.apply(r,t)}),t.strokeStyle=r}},e}(Se),Le=function(t){return function(t){function e(){return Zt(this,e),Nt(this,t.apply(this,arguments))}return Ft(e,t),e.prototype.on=function(t,e,i){if(!t||!e)return this;if(!h(t))return this._switch("on",t,e);this._eventMap||(this._eventMap={});var n=t.toLowerCase().split(" "),r=void 0;i||(i=this);for(var o=void 0,s=0,a=n.length;s<a;s++){r=n[s],o=this._eventMap[r],o||(o=[],this._eventMap[r]=o);var p=o.length;if(p>0)for(var u=0;u<p;u++)if(e===o[u].handler&&o[u].context===i)return this;o.push({handler:e,context:i})}return this},e.prototype.addEventListener=function(){return this.on.apply(this,arguments)},e.prototype.once=function(t,e,i){if(!h(t)){var n={};for(var r in t)t.hasOwnProperty(r)&&(n[r]=this._wrapOnceHandler(r,t[r],i));return this._switch("on",n)}for(var o=t.split(" "),s=0,a=o.length;s<a;s++)this.on(o[s],this._wrapOnceHandler(o[s],e,i));return this},e.prototype.off=function(t,e,i){if(!t||!this._eventMap||!e)return this;if(!h(t))return this._switch("off",t,e);var n=t.split(" "),r=void 0,o=void 0;i||(i=this);for(var s=0,a=n.length;s<a;s++){if(r=n[s].toLowerCase(),!(o=this._eventMap[r]))return this;for(var p=o.length-1;p>=0;p--)e===o[p].handler&&o[p].context===i&&o.splice(p,1)}return this},e.prototype.removeEventListener=function(){return this.off.apply(this,arguments)},e.prototype.listens=function(t,e,i){if(!this._eventMap||!h(t))return 0;var n=this._eventMap[t.toLowerCase()];if(!n||!n.length)return 0;for(var o=0,s=0,a=n.length;s<a;s++)if(e){if(e===n[s].handler&&(r(i)||n[s].context===i))return 1}else o++;return o},e.prototype.copyEventListeners=function(t){var e=t._eventMap;if(!e)return this;var i=void 0;for(var n in e){i=e[n];for(var r=0,o=i.length;r<o;r++)this.on(n,i[r].handler,i[r].context)}return this},e.prototype.fire=function(){return this._eventParent?this._eventParent.fire.apply(this._eventParent,arguments):this._fire.apply(this,arguments)},e.prototype._wrapOnceHandler=function(t,e,i){var n=this,r=!1;return function o(){r||(r=!0,i?e.apply(i,arguments):e.apply(this,arguments),n.off(t,o,this))}},e.prototype._switch=function(t,e,i){for(var n in e)e.hasOwnProperty(n)&&this[t](n,e[n],i);return this},e.prototype._clearListeners=function(t){if(this._eventMap&&h(t)){this._eventMap[t.toLowerCase()]&&(this._eventMap[t]=null)}},e.prototype._clearAllListeners=function(){this._eventMap=null},e.prototype._setEventParent=function(t){return this._eventParent=t,this},e.prototype._fire=function(t,e){if(!this._eventMap)return this;var i=this._eventMap[t.toLowerCase()];if(!i)return this;e||(e={}),e.type=t,e.target=this;for(var r=i.slice(0),o=void 0,s=void 0,a=0,h=r.length;a<h;a++)r[a]&&(o=r[a].context,!0,s=n({},e),!1===(o?r[a].handler.call(o,s):r[a].handler(s))&&e.domEvent&&at(e.domEvent));return this},e}(t)},Te=function(){function t(e){Zt(this,t),this.target=e}return t.prototype.enable=function(){return this._enabled?this:(this._enabled=!0,this.addHooks(),this)},t.prototype.disable=function(){return this._enabled?(this._enabled=!1,this.removeHooks(),this):this},t.prototype.enabled=function(){return!!this._enabled},t.prototype.remove=function(){this.disable(),delete this.target,delete this.dom},t}(),Re=Le(Te),Ae=function(){function t(e){if(Zt(this,t),!this||!this.setOptions)throw new Error('Class instance is being created without "new" operator.');this.setOptions(e),this.callInitHooks()}return t.prototype.callInitHooks=function(){var t=Object.getPrototypeOf(this);return this._visitInitHooks(t),this},t.prototype.setOptions=function(t){if(this.hasOwnProperty("options")||(this.options=this.options?Object.create(this.options):{}),!t)return this;for(var e in t)this.options[e]=t[e];return this},t.prototype.config=function(t){if(!t){var e={};for(var i in this.options)this.options.hasOwnProperty(i)&&(e[i]=this.options[i]);return e}if(2===arguments.length){var n={};n[t]=arguments[1],t=n}for(var r in t)this.options[r]=t[r],this[r]&&this[r]instanceof Re&&(t[r]?this[r].enable():this[r].disable());return this.onConfig&&this.onConfig(t),this},t.prototype._visitInitHooks=function(t){if(!this._initHooksCalled){var e=Object.getPrototypeOf(t);e._visitInitHooks&&e._visitInitHooks.call(this,e),this._initHooksCalled=!0;var i=t._initHooks;if(i&&i!==e._initHooks)for(var n=0;n<i.length;n++)i[n].call(this)}},t.addInitHook=function(t){for(var e=arguments.length,i=Array(e>1?e-1:0),n=1;n<e;n++)i[n-1]=arguments[n];var r="function"==typeof t?t:function(){this[t].apply(this,i)},o=this.prototype,s=Object.getPrototypeOf(o);return o._initHooks&&o._initHooks!==s._initHooks||(o._initHooks=[]),o._initHooks.push(r),this},t.include=function(){for(var t=arguments.length,e=Array(t),i=0;i<t;i++)e[i]=arguments[i];for(var r=0;r<e.length;r++)n(this.prototype,e[r]);return this},t.mergeOptions=function(t){var e=this.prototype,i=Object.getPrototypeOf(e);return e.options&&e.options!==i.options||(e.options=e.options?Object.create(e.options):{}),n(e.options,t),this},t}(),Ie=function(t){return function(t){function e(){return Zt(this,e),Nt(this,t.apply(this,arguments))}return Ft(e,t),e.prototype.addHandler=function(t,e){if(!e)return this;if(this._handlers||(this._handlers=[]),this[t])return this[t].enable(),this;var i=this[t]=new e(this);return this._handlers.push(i),this.options[t]&&i.enable(),this},e.prototype.removeHandler=function(t){if(!t)return this;var e=this[t];if(e){var i=this._handlers.indexOf(e);i>=0&&this._handlers.splice(i,1),this[t].remove(),delete this[t]}return this},e.prototype._clearHandlers=function(){for(var t=0,e=this._handlers.length;t<e;t++)this._handlers[t].remove();this._handlers=[]},e}(t)},ke={},je=function(t){return function(t){function e(){return Zt(this,e),Nt(this,t.apply(this,arguments))}return Ft(e,t),e.registerJSONType=function(t){return t?(ke[t]=this,this):this},e.getJSONClass=function(t){return t?ke[t]:null},e.prototype.getJSONType=function(){if(void 0===this._jsonType){var t=Object.getPrototypeOf(this).constructor;for(var e in ke)if(ke[e]===t){this._jsonType=e;break}}if(!this._jsonType)throw new Error("Found an unregistered geometry class!");return this._jsonType},e}(t)},Oe=function(t){return function(t){function e(){return Zt(this,e),Nt(this,t.apply(this,arguments))}return Ft(e,t),e.registerRenderer=function(t,e){var i=this.prototype,n=Object.getPrototypeOf(i);return i._rendererClasses&&i._rendererClasses!==n._rendererClasses||(i._rendererClasses=i._rendererClasses?Object.create(i._rendererClasses):{}),i._rendererClasses[t.toLowerCase()]=e,this},e.getRendererClass=function(t){var e=this.prototype;return e._rendererClasses?e._rendererClasses[t.toLowerCase()]:null},e}(t)},De="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},ze=xt(function(t){!function(e){function i(t){if(t){var e=this;t(function(t){e.resolve(t)},function(t){e.reject(t)})}}function n(t,e){if("function"==typeof t.y)try{var i=t.y.call(s,e);t.p.resolve(i)}catch(e){t.p.reject(e)}else t.p.resolve(e)}function r(t,e){if("function"==typeof t.n)try{var i=t.n.call(s,e);t.p.resolve(i)}catch(e){t.p.reject(e)}else t.p.reject(e)}var o,s,a="fulfilled",h="undefined",p=function(){function t(){for(;i.length-n;){try{i[n]()}catch(t){e.console&&e.console.error(t)}i[n++]=s,n==r&&(i.splice(0,r),n=0)}}var i=[],n=0,r=1024,o=function(){if(("undefined"==typeof MutationObserver?"undefined":Gt(MutationObserver))!==h){var e=document.createElement("div");return new MutationObserver(t).observe(e,{attributes:!0}),function(){e.setAttribute("a",0)}}return("undefined"==typeof setImmediate?"undefined":Gt(setImmediate))!==h?function(){setImmediate(t)}:function(){setTimeout(t,0)}}();return function(t){i.push(t),i.length-n==1&&o()}}();i.prototype={resolve:function(t){if(this.state===o){if(t===this)return this.reject(new TypeError("Attempt to resolve promise with self"));var e=this;if(t&&("function"==typeof t||"object"==(void 0===t?"undefined":Gt(t))))try{var i=!0,r=t.then;if("function"==typeof r)return void r.call(t,function(t){i&&(i=!1,e.resolve(t))},function(t){i&&(i=!1,e.reject(t))})}catch(t){return void(i&&this.reject(t))}this.state=a,this.v=t,e.c&&p(function(){for(var i=0,r=e.c.length;r>i;i++)n(e.c[i],t)})}},reject:function(t){if(this.state===o){this.state="rejected",this.v=t;var n=this.c;n?p(function(){for(var e=0,i=n.length;i>e;e++)r(n[e],t)}):!i.suppressUncaughtRejectionError&&e.console&&e.console.log("You upset Zousan. Please catch rejections: ",t,t?t.stack:null)}},then:function(t,e){var s=new i,h={y:t,n:e,p:s};if(this.state===o)this.c?this.c.push(h):this.c=[h];else{var u=this.state,c=this.v;p(function(){u===a?n(h,c):r(h,c)})}return s},catch:function(t){return this.then(null,t)},finally:function(t){return this.then(t,t)},timeout:function(t,e){e=e||"Timeout";var n=this;return new i(function(i,r){setTimeout(function(){r(Error(e))},t),n.then(function(t){i(t)},function(t){r(t)})})}},i.resolve=function(t){var e=new i;return e.resolve(t),e},i.reject=function(t){var e=new i;return e.reject(t),e},i.all=function(t){for(var e=[],n=0,r=new i,o=0;o<t.length;o++)!function(o,s){o&&"function"==typeof o.then||(o=i.resolve(o)),o.then(function(i){e[s]=i,++n==t.length&&r.resolve(e)},function(t){r.reject(t)})}(t[o],o);return t.length||r.resolve(e),r},t.exports&&(t.exports=i),e.define&&e.define.amd&&e.define([],function(){return i}),e.Zousan=i,i.soon=p}(De)}),Ge=void 0;Ge="undefined"!=typeof Promise?Promise:ze;var Ze=Ge,Fe=function(t){function e(i){Zt(this,e);var n=Nt(this,t.call(this));return n.layer=i,n._drawTime=0,n.setToRedraw(),n}return Ft(e,t),e.prototype.render=function(){var t=this;if(this.prepareRender(),this.getMap()&&this.layer.isVisible())if(this.resources||(this.resources=new Ne),this.checkResources){var e=this.checkResources();e.length>0?(this._loadingResource=!0,this.loadResources(e).then(function(){t._loadingResource=!1,t.layer&&(t.layer.fire("resourceload"),t.setToRedraw())})):this._tryToDraw(this)}else this._tryToDraw(this)},e.prototype.isAnimating=function(){return!1},e.prototype.needToRedraw=function(){if(this._loadingResource)return!1;if(this._toRedraw)return!0;if(!this.drawOnInteracting)return!1;var t=this.getMap();return!!t.isInteracting()&&!(!t.getPitch()&&t.isMoving()&&!this.layer.options.forceRenderOnMoving)},e.prototype.isRenderComplete=function(){return!!this._renderComplete},e.prototype.setToRedraw=function(){return this._toRedraw=!0,this},e.prototype.setCanvasUpdated=function(){return this._canvasUpdated=!0,this},e.prototype.isCanvasUpdated=function(){return!!this._canvasUpdated},e.prototype.skipDrawOnInteracting=function(){},e.prototype.remove=function(){this.onRemove&&this.onRemove(),delete this._loadingResource,delete this._northWest,delete this.canvas,delete this.context,delete this._extent2D,delete this.resources,delete this.layer},e.prototype.getMap=function(){return this.layer?this.layer.getMap():null},e.prototype.getCanvasImage=function(){if(this._canvasUpdated=!1,this._renderZoom!==this.getMap().getZoom()||!this.canvas||!this._extent2D)return null;if(this.isBlank())return null;if(this.layer.isEmpty&&this.layer.isEmpty())return null;var t=this.getMap(),e=this._extent2D.getSize(),i=t._pointToContainerPoint(this._northWest);return{image:this.canvas,layer:this.layer,point:i,size:e}},e.prototype.clear=function(){this.clearCanvas()},e.prototype.isBlank=function(){return!this._painted},e.prototype.show=function(){this.setToRedraw()},e.prototype.hide=function(){this.clear(),this.setToRedraw()},e.prototype.setZIndex=function(){this.setToRedraw()},e.prototype.hitDetect=function(t){if(!this.context||this.layer.isEmpty&&this.layer.isEmpty()||this.isBlank()||this._errorThrown)return!1;var e=this.getMap(),i=e.getSize();if(t.x<0||t.x>i.width||t.y<0||t.y>i.height)return!1;try{if(this.context.getImageData(t.x,t.y,1,1).data[3]>0)return!0}catch(t){return this._errorThrown||(console&&console.warn("hit detect failed with tainted canvas, some geometries have external resources in another domain:\n",t),this._errorThrown=!0),!1}return!1},e.prototype.loadResources=function(t){this.resources||(this.resources=new Ne);var e=this.resources,i=[];if(b(t))for(var n={},r=t.length-1;r>=0;r--){var o=t[r];o&&o.length&&!n[o.join("-")]&&(n[o.join("-")]=1,e.isResourceLoaded(o,!0)||i.push(new Ze(this._promiseResource(o))))}return Ze.all(i)},e.prototype.prepareRender=function(){delete this._renderComplete;var t=this.getMap();this._renderZoom=t.getZoom(),this._extent2D=t._get2DExtent(),this._northWest=t._containerPointToPoint(new me(0,0))},e.prototype.createCanvas=function(){if(!this.canvas){var t=this.getMap(),e=t.getSize(),i=ye.retina?2:1;this.canvas=Pe.createCanvas(i*e.width,i*e.height,t.CanvasClass),this.context=this.canvas.getContext("2d"),this.layer.options.globalCompositeOperation&&(this.context.globalCompositeOperation=this.layer.options.globalCompositeOperation),ye.retina&&this.context.scale(i,i),Pe.setDefaultCanvasSetting(this.context),this.onCanvasCreate&&this.onCanvasCreate()}},e.prototype.resizeCanvas=function(t){if(this.canvas){var e=void 0;if(t)e=t;else{e=this.getMap().getSize()}var i=ye.retina?2:1;this.canvas.width===i*e.width&&this.canvas.height===i*e.height||(this.canvas.height=i*e.height,this.canvas.width=i*e.width,ye.retina&&this.context.scale(i,i))}},e.prototype.clearCanvas=function(){this.canvas&&Pe.clearRect(this.context,0,0,this.canvas.width,this.canvas.height)},e.prototype.prepareCanvas=function(){this._clipped&&(this.context.restore(),this._clipped=!1),this.canvas?this.clearCanvas():this.createCanvas(),delete this._maskExtent;var t=this.layer.getMask();if(!t)return this.layer.fire("renderstart",{context:this.context}),null;var e=this._maskExtent=t._getPainter().get2DExtent();return e.intersects(this._extent2D)?(this.context.save(),t._paint(),this.context.clip(),this._clipped=!0,this.layer.fire("renderstart",{context:this.context}),e):(this.layer.fire("renderstart",{context:this.context}),e)},e.prototype.getViewExtent=function(){return{extent:this._extent2D,maskExtent:this._maskExtent,zoom:this._renderZoom,northWest:this._northWest}},e.prototype.completeRender=function(){this.getMap()&&this.context&&(this._renderComplete=!0,this.layer.fire("renderend",{context:this.context}),this.setCanvasUpdated())},e.prototype.getEvents=function(){return{_zoomstart:this.onZoomStart,_zoomend:this.onZoomEnd,_resize:this.onResize,_movestart:this.onMoveStart,_moveend:this.onMoveEnd,_dragrotatestart:this.onDragRotateStart,_dragrotateend:this.onDragRotateEnd,_spatialreferencechange:this.onSpatialReferenceChange}},e.prototype.onZoomStart=function(){},e.prototype.onZoomEnd=function(){this.setToRedraw()},e.prototype.onMoveStart=function(){},e.prototype.onMoveEnd=function(){this.setToRedraw()},e.prototype.onResize=function(){delete this._extent2D,this.resizeCanvas(),this.setToRedraw()},e.prototype.onDragRotateStart=function(){},e.prototype.onDragRotateEnd=function(){this.setToRedraw()},e.prototype.onSpatialReferenceChange=function(){},e.prototype.getDrawTime=function(){return this._drawTime},e.prototype._tryToDraw=function(){if(this._toRedraw=!1,!this.canvas&&this.layer.isEmpty&&this.layer.isEmpty())return void(this._renderComplete=!0);!this._painted&&this.onAdd&&this.onAdd(),this._drawAndRecord()},e.prototype._drawAndRecord=function(){if(this.getMap()){this._painted=!0;var t=i();this.draw(),this._drawTime=i()-t}},e.prototype._promiseResource=function(t){var e=this,i=this.resources,n=this.layer.options.crossOrigin;return function(r){if(i.isResourceLoaded(t,!0))return void r(t);var o=new Image;n&&(o.crossOrigin=n),c(t[0])&&!Wt&&(t[1]&&(t[1]*=2),t[2]&&(t[2]*=2)),o.onload=function(){e._cacheResource(t,o),r(t)},o.onabort=function(e){console&&console.warn("image loading aborted: "+t[0]),e&&console&&console.warn(e),r(t)},o.onerror=function(e){e&&"undefined"!=typeof console&&console.warn(e),i.markErrorResource(t),r(t)},l(o,t)}},e.prototype._cacheResource=function(t,e){if(this.layer&&this.resources){var i=t[1],n=t[2];if(this.layer.options.cacheSvgOnCanvas&&1===c(t[0])&&(ye.edge||ye.ie)){r(i)&&(i=e.width||this.layer.options.defaultIconSize[0]),r(n)&&(n=e.height||this.layer.options.defaultIconSize[1]);var o=Pe.createCanvas(i,n);Pe.image(o.getContext("2d"),e,0,0,i,n),e=o}this.resources.addResource(t,e)}},e}(Ae),Ne=function(){function t(){Zt(this,t),this.resources={},this._errors={}}return t.prototype.addResource=function(t,e){this.resources[t[0]]={image:e,width:+t[1],height:+t[2]}},t.prototype.isResourceLoaded=function(t,e){if(!t)return!1;var i=this._getImgUrl(t);if(this._errors[i])return!0;var n=this.resources[i];return!!n&&!(e&&c(t[0])&&(+t[1]>n.width||+t[2]>n.height))},t.prototype.getImage=function(t){var e=this._getImgUrl(t);return!this.isResourceLoaded(t)||this._errors[e]?null:this.resources[e].image},t.prototype.markErrorResource=function(t){this._errors[this._getImgUrl(t)]=1},t.prototype.merge=function(t){if(!t)return this;for(var e in t.resources){var i=t.resources[e];this.addResource([e,i.width,i.height],i.image)}return this},t.prototype._getImgUrl=function(t){return Array.isArray(t)?t[0]:t},t}(),He={minZoom:null,maxZoom:null,visible:!0,opacity:1,drawImmediate:!1,globalCompositeOperation:null,renderer:"canvas",debugOutline:"#0f0"},We=function(t){function e(i,n){Zt(this,e);var r=Nt(this,t.call(this,n));return r.setId(i),r}return Ft(e,t),e.prototype.load=function(){if(!this.getMap())return this;if(this.onLoad()){this._initRenderer();var t=this.getZIndex();r(t)||(this._renderer.setZIndex(t),this.isCanvasRender()||this._renderer.render())}return this},e.prototype.getId=function(){return this._id},e.prototype.setId=function(t){var e=this._id;return r(t)||(t+=""),this._id=t,this.fire("idchange",{old:e,new:t}),this},e.prototype.addTo=function(t){return t.addLayer(this),this},e.prototype.setZIndex=function(t){return this._zIndex=t,this.map&&this.map._sortLayersByZIndex(),this._renderer&&this._renderer.setZIndex(t),this},e.prototype.getZIndex=function(){return this._zIndex},e.prototype.isCanvasRender=function(){var t=this._getRenderer();return t&&t instanceof Fe},e.prototype.getMap=function(){return this.map?this.map:null},e.prototype.bringToFront=function(){var t=this._getLayerList();if(!t.length)return this;var e=t[t.length-1];if(1===t.length||e===this)return this;var i=e.getZIndex();return this.setZIndex(i+1),this},e.prototype.bringToBack=function(){var t=this._getLayerList();if(!t.length)return this;var e=t[0];if(1===t.length||e===this)return this;var i=e.getZIndex();return this.setZIndex(i-1),this},e.prototype.show=function(){var t=this;if(!this.options.visible){this.options.visible=!0,this._getRenderer()&&this._getRenderer().show();var e=this.getMap();e?e.once("renderend",function(){t.fire("show")}):this.fire("show")}return this},e.prototype.hide=function(){var t=this;if(this.options.visible){this.options.visible=!1,this._getRenderer()&&this._getRenderer().hide();var e=this.getMap();e?e.once("renderend",function(){t.fire("hide")}):this.fire("hide")}return this},e.prototype.isVisible=function(){if(o(this.options.opacity)&&this.options.opacity<=0)return!1;var t=this.getMap();if(t){var e=t.getZoom();if(!r(this.options.maxZoom)&&this.options.maxZoom<e||!r(this.options.minZoom)&&this.options.minZoom>e)return!1}return r(this.options.visible)&&(this.options.visible=!0),this.options.visible},e.prototype.remove=function(){return this.map&&this.map.removeLayer(this),this},e.prototype.getMask=function(){return this._mask},e.prototype.setMask=function(t){if(!("Point"===t.type&&t._isVectorMarker()||"Polygon"===t.type))throw new Error("Mask for a layer must be a marker with vector marker symbol, a Polygon or a MultiPolygon.");if("Point"===t.type?t.updateSymbol({markerLineColor:"rgba(0, 0, 0, 0)",markerFillOpacity:0}):t.setSymbol({lineColor:"rgba(0, 0, 0, 0)",polygonOpacity:0}),t._bindLayer(this),this._mask=t,!this.getMap()||this.getMap().isZooming())return this;var e=this._getRenderer();return e&&e.setToRedraw&&this._getRenderer().setToRedraw(),this},e.prototype.removeMask=function(){if(delete this._mask,!this.getMap()||this.getMap().isZooming())return this;var t=this._getRenderer();return t&&t.setToRedraw&&this._getRenderer().setToRedraw(),this},e.prototype.onLoad=function(){return!0},e.prototype.isLoaded=function(){return!!this._loaded},e.prototype._bindMap=function(t,e){t&&(this.map=t,this.setZIndex(e),this._switchEvents("on",this),this.onAdd&&this.onAdd(),this.fire("add"))},e.prototype._initRenderer=function(){var t=this.options.renderer;if(this.constructor.getRendererClass){var e=this.constructor.getRendererClass(t);if(!e)throw new Error("Invalid renderer for Layer("+this.getId()+"):"+t);this._renderer=new e(this),this._renderer.layer=this,this._renderer.setZIndex(this.getZIndex()),this._switchEvents("on",this._renderer)}},e.prototype._doRemove=function(){this._loaded=!1,this.onRemove&&this.onRemove(),this._switchEvents("off",this),this._renderer&&(this._switchEvents("off",this._renderer),this._renderer.remove(),delete this._renderer),delete this._mask,delete this.map},e.prototype._switchEvents=function(t,e){e&&e.getEvents&&this.getMap()[t](e.getEvents(),e)},e.prototype._getRenderer=function(){return this._renderer},e.prototype._getLayerList=function(){return this.map?this.map._layers:[]},e}(je(Le(Oe(Ae))));We.mergeOptions(He)
;var Be=We.prototype.fire;We.prototype.fire=function(t,e){return"layerload"===t&&(this._loaded=!0),this.map&&(e||(e={}),e.type=t,e.target=this,this.map._onLayerEvent(e)),Be.apply(this,arguments)};var Ve={project:function(){},unproject:function(){},projectCoords:function(t){return t?m(t,this.project,this):[]},unprojectCoords:function(t){return t?m(t,this.unproject,this):[]}},Je={measureLength:function(t,e){if(!Array.isArray(t))return this.measureLenBetween(t,e);for(var i=0,n=0,r=t.length;n<r-1;n++)i+=this.measureLenBetween(t[n],t[n+1]);return i}},Ue=n({measure:"IDENTITY",measureLenBetween:function(t,e){if(!t||!e)return 0;try{return Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))}catch(t){return 0}},measureArea:function(t){if(!Array.isArray(t))return 0;for(var e=0,i=0,n=t.length;i<n;i++){var r=t[i],o=null;o=i===n-1?t[0]:t[i+1],e+=r.x*o.y-r.y*o.x}return Math.abs(e/2)},locate:function(t,e,i){return t?(e||(e=0),i||(i=0),e||i?new Ce(t.x+e,t.y+i):t):null}},Je),qe=function(){function t(e){Zt(this,t),this.radius=e}return t.prototype.rad=function(t){return t*Math.PI/180},t.prototype.measureLenBetween=function(t,e){if(!t||!e)return 0;var i=this.rad(t.y),n=this.rad(e.y),r=i-n,o=this.rad(t.x)-this.rad(e.x);return i=2*Math.asin(Math.sqrt(Math.pow(Math.sin(r/2),2)+Math.cos(i)*Math.cos(n)*Math.pow(Math.sin(o/2),2))),i*=this.radius,Math.round(1e5*i)/1e5},t.prototype.measureArea=function(t){var e=this.radius*Math.PI/180,i=0,n=t,r=n.length;if(r<3)return 0;var o=void 0;for(o=0;o<r-1;o++){var s=n[o],a=n[o+1];i+=s.x*e*Math.cos(s.y*Math.PI/180)*a.y*e-a.x*e*Math.cos(a.y*Math.PI/180)*s.y*e}return r=n[o],n=n[0],i+=r.x*e*Math.cos(r.y*Math.PI/180)*n.y*e-n.x*e*Math.cos(n.y*Math.PI/180)*r.y*e,.5*Math.abs(i)},t.prototype.locate=function(t,e,i){if(!t)return null;if(e||(e=0),i||(i=0),!e&&!i)return t;var n=Math.abs(e),r=Math.abs(i),o=this.rad(t.y),s=this.rad(t.x);return o+=2*Math.sin(r/(2*this.radius))*(i>0?1:-1),s+=2*Math.sqrt(Math.pow(Math.sin(n/(2*this.radius)),2)/Math.pow(Math.cos(o),2))*(e>0?1:-1),new Ce(180*s/Math.PI,180*o/Math.PI)},t}(),Qe=n({measure:"EPSG:4326",sphere:new qe(6378137),measureLenBetween:function(){return this.sphere.measureLenBetween.apply(this.sphere,arguments)},measureArea:function(){return this.sphere.measureArea.apply(this.sphere,arguments)},locate:function(){return this.sphere.locate.apply(this.sphere,arguments)}},Je),Ye=n({measure:"BAIDU",sphere:new qe(6370996.81),measureLenBetween:function(){return this.sphere.measureLenBetween.apply(this.sphere,arguments)},measureArea:function(){return this.sphere.measureArea.apply(this.sphere,arguments)},locate:function(){return this.sphere.locate.apply(this.sphere,arguments)}},Je),Xe=Qe,$e={};wt(Ue),wt(Qe),wt(Ye);var Ke={getInstance:function(t){if(!t)return Xe;for(var e in $e)if(u($e,e)){var i=$e[e].measure;if(!i)continue;if(t.toLowerCase()===i.toLowerCase())return $e[e]}return null},isSphere:function(t){return!!t&&!r(t.sphere)}},ti=n({},Ve,{code:"EPSG:3857",rad:Math.PI/180,metersPerDegree:6378137*Math.PI/180,maxLatitude:85.0511287798,project:function(t){var e=this.rad,i=this.metersPerDegree,n=this.maxLatitude,r=t.x,o=Math.max(Math.min(n,t.y),-n),s=void 0;return s=0===o?0:Math.log(Math.tan((90+o)*e/2))/e,new Ce(r*i,s*i)},unproject:function(t){var e=t.x,i=t.y,n=this.rad,r=this.metersPerDegree,o=void 0;return 0===i?o=0:(o=i/r,o=(2*Math.atan(Math.exp(o*n))-Math.PI/2)/n),new Ce(e/r,o)}},Qe),ei=n({},Ve,{code:"EPSG:4326",project:function(t){return new Ce(t)},unproject:function(t){return new Ce(t)}},Qe),ii=n({},Ve,{code:"BAIDU",project:function(t){return this.convertLL2MC(t)},unproject:function(t){return this.convertMC2LL(t)}},Ye,{EARTHRADIUS:6370996.81,MCBAND:[12890594.86,8362377.87,5591021,3481989.83,1678043.12,0],LLBAND:[75,60,45,30,15,0],MC2LL:[[1.410526172116255e-8,898305509648872e-20,-1.9939833816331,200.9824383106796,-187.2403703815547,91.6087516669843,-23.38765649603339,2.57121317296198,-.03801003308653,17337981.2],[-7.435856389565537e-9,8983055097726239e-21,-.78625201886289,96.32687599759846,-1.85204757529826,-59.36935905485877,47.40033549296737,-16.50741931063887,2.28786674699375,10260144.86],[-3.030883460898826e-8,898305509983578e-20,.30071316287616,59.74293618442277,7.357984074871,-25.38371002664745,13.45380521110908,-3.29883767235584,.32710905363475,6856817.37],[-1.981981304930552e-8,8983055099779535e-21,.03278182852591,40.31678527705744,.65659298677277,-4.44255534477492,.85341911805263,.12923347998204,-.04625736007561,4482777.06],[3.09191371068437e-9,8983055096812155e-21,6995724062e-14,23.10934304144901,-.00023663490511,-.6321817810242,-.00663494467273,.03430082397953,-.00466043876332,2555164.4],[2.890871144776878e-9,8983055095805407e-21,-3.068298e-8,7.47137025468032,-353937994e-14,-.02145144861037,-1234426596e-14,.00010322952773,-323890364e-14,826088.5]],LL2MC:[[-.0015702102444,111320.7020616939,0x60e374c3105a3,-0x24bb4115e2e164,0x5cc55543bb0ae8,-0x7ce070193f3784,0x5e7ca61ddf8150,-0x261a578d8b24d0,0x665d60f3742ca,82.5],[.0008277824516172526,111320.7020463578,647795574.6671607,-4082003173.641316,10774905663.51142,-15171875531.51559,12053065338.62167,-5124939663.577472,913311935.9512032,67.5],[.00337398766765,111320.7020202162,4481351.045890365,-23393751.19931662,79682215.47186455,-115964993.2797253,97236711.15602145,-43661946.33752821,8477230.501135234,52.5],[.00220636496208,111320.7020209128,51751.86112841131,3796837.749470245,992013.7397791013,-1221952.21711287,1340652.697009075,-620943.6990984312,144416.9293806241,37.5],[-.0003441963504368392,111320.7020576856,278.2353980772752,2485758.690035394,6070.750963243378,54821.18345352118,9540.606633304236,-2710.55326746645,1405.483844121726,22.5],[-.0003218135878613132,111320.7020701615,.00369383431289,823725.6402795718,.46104986909093,2351.343141331292,1.58060784298199,8.77738589078284,.37238884252424,7.45]],convertMC2LL:function(t){for(var e={x:Math.abs(t.x),y:Math.abs(t.y)},i=void 0,n=0,r=this.MCBAND.length;n<r;n++)if(e.y>=this.MCBAND[n]){i=this.MC2LL[n];break}var o=this.convertor(t,i);return new Ce(o.x.toFixed(6),o.y.toFixed(6))},convertLL2MC:function(t){var e=void 0,i=void 0,n=void 0;t.x=this.getLoop(t.x,-180,180),t.y=this.getRange(t.y,-74,74);var r=new Ce(t.x,t.y);for(i=0,n=this.LLBAND.length;i<n;i++)if(r.y>=this.LLBAND[i]){e=this.LL2MC[i];break}if(!e)for(i=this.LLBAND.length-1;i>=0;i--)if(r.y<=-this.LLBAND[i]){e=this.LL2MC[i];break}var o=this.convertor(t,e);return new Ce(o.x.toFixed(2),o.y.toFixed(2))},convertor:function(t,e){if(!t||!e)return null;var i=e[0]+e[1]*Math.abs(t.x),n=Math.abs(t.y)/e[9],r=e[2]+e[3]*n+e[4]*n*n+e[5]*n*n*n+e[6]*n*n*n*n+e[7]*n*n*n*n*n+e[8]*n*n*n*n*n*n;return i*=t.x<0?-1:1,r*=t.y<0?-1:1,new Ce(i,r)},toRadians:function(t){return Math.PI*t/180},toDegrees:function(t){return 180*t/Math.PI},getRange:function(t,e,i){return null!=e&&(t=Math.max(t,e)),null!=i&&(t=Math.min(t,i)),t},getLoop:function(t,e,i){for(;t>i;)t-=i-e;for(;t<e;)t+=i-e;return t}}),ni=n({},Ve,{code:"IDENTITY",project:function(t){return t.copy()},unproject:function(t){return t.copy()}},Ue),ri=ti,oi=Object.freeze({EPSG3857:ti,DEFAULT:ri,EPSG4326:ei,BAIDU:ii,IDENTITY:ni,Common:Ve}),si=function(){function t(e){Zt(this,t),this.matrix=e}return t.prototype.transform=function(t,e){return new me(this.matrix[0]*(t.x-this.matrix[2])/e,this.matrix[1]*(t.y-this.matrix[3])/e)},t.prototype.untransform=function(t,e){return new Ce(t.x*e/this.matrix[0]+this.matrix[2],t.y*e/this.matrix[1]+this.matrix[3])},t}(),ai={"EPSG:3857":{resolutions:function(){for(var t=[],e=12756274*Math.PI,i=0;i<20;i++)t[i]=e/(256*Math.pow(2,i));return t}(),fullExtent:{top:6378137*Math.PI,left:-6378137*Math.PI,bottom:-6378137*Math.PI,right:6378137*Math.PI}},"EPSG:4326":{fullExtent:{top:90,left:-180,bottom:-90,right:180},resolutions:function(){for(var t=[],e=0;e<20;e++)t[e]=180/(128*Math.pow(2,e));return t}()},BAIDU:{resolutions:function(){for(var t=Math.pow(2,18),e=[],i=0;i<20;i++)e[i]=t,t*=.5;return e[0]=null,e[1]=null,e[2]=null,e}(),fullExtent:{top:33554432,left:-33554432,bottom:-33554432,right:33554432}}},hi=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Zt(this,t),this.options=e,this._initSpatialRef()}return t.prototype._initSpatialRef=function(){var t=this.options.projection;if(t){if(h(t))for(var e in oi)if(u(oi,e)){var i=oi[e].code;if(i&&i.toLowerCase()===t.toLowerCase()){t=oi[e];break}}}else t=ri;if(!t||h(t))throw new Error("must provide a valid projection in map's spatial reference.");t=n({},Ve,t),t.measureLength||n(t,Ke.DEFAULT),this._projection=t;var o=void 0,s=this.options.resolutions;if(!s&&(t.code&&(o=ai[t.code])&&(s=o.resolutions),!s))throw new Error("must provide valid resolutions in map's spatial reference.");this._resolutions=s;var a=this.options.fullExtent;if(!a&&(t.code&&(o=ai[t.code])&&(a=o.fullExtent),!a))throw new Error("must provide a valid fullExtent in map's spatial reference.");r(a.left)?(this._fullExtent=new be(a),a.left=a.xmin,a.right=a.xmax,a.top=a.ymax,a.bottom=a.ymin):this._fullExtent=new be(new Ce(a.left,a.top),new Ce(a.right,a.bottom)),n(this._fullExtent,a);var p=a.right>=a.left?1:-1,c=a.top>=a.bottom?-1:1;this._transformation=new si([p,c,0,0])},t.prototype.getResolutions=function(){return this._resolutions||[]},t.prototype.getResolution=function(t){var e=0|t;e<0?e=0:e>this._resolutions.length-1&&(e=this._resolutions.length-1);var i=this._resolutions[e];if(!s(t)&&e!==this._resolutions.length-1){return i+(this._resolutions[e+1]-i)*(t-e)}return i},t.prototype.getProjection=function(){return this._projection},t.prototype.getFullExtent=function(){return this._fullExtent},t.prototype.getTransformation=function(){return this._transformation},t.prototype.getMinZoom=function(){for(var t=0;t<this._resolutions.length;t++)if(!r(this._resolutions[t]))return t;return 0},t.prototype.getMaxZoom=function(){for(var t=this._resolutions.length-1;t>=0;t--)if(!r(this._resolutions[t]))return t;return this._resolutions.length-1},t}(),pi={centerCross:!1,clipFullExtent:!1,zoomInCenter:!1,zoomAnimation:function(){return!Wt}(),zoomAnimationDuration:330,zoomBackground:!1,panAnimation:function(){return!Wt}(),panAnimationDuration:600,zoomable:!0,enableInfoWindow:!0,hitDetect:function(){return!ye.mobile}(),hitDetectLimit:5,fpsOnInteracting:40,layerCanvasLimitOnInteracting:-1,maxZoom:null,minZoom:null,maxExtent:null,checkSize:!0,renderer:"canvas"},ui=function(t){function e(i,r){if(Zt(this,e),!r)throw new Error("Invalid options when creating map.");if(!r.center)throw new Error("Invalid center when creating map.");var o=n({},r),s=o.zoom;delete o.zoom;var a=new Ce(o.center);delete o.center;var p=o.baseLayer;delete o.baseLayer;var u=o.layers;delete o.layers;var c=Nt(this,t.call(this,o));if(c._loaded=!1,h(i)){if(c._containerDOM=document.getElementById(i),!c._containerDOM)throw new Error("invalid container when creating map: '"+i+"'")}else c._containerDOM=i,Wt&&(c.CanvasClass=c._containerDOM.constructor);if(!Wt&&c._containerDOM.childNodes&&c._containerDOM.childNodes.length>0&&"maptalks-wrapper"===c._containerDOM.childNodes[0].className)throw new Error("Container is already loaded with another map instance, use map.remove() to clear it.");return c._panels={},c._baseLayer=null,c._layers=[],c._zoomLevel=s,c._center=a,c.setSpatialReference(o.spatialReference||o.view),p&&c.setBaseLayer(p),u&&c.addLayer(u),c._mapViewPoint=new me(0,0),c._initRenderer(),c._updateMapSize(c._getContainerDomSize()),c._Load(),c}return Ft(e,t),e.addOnLoadHook=function(t){var e=Array.prototype.slice.call(arguments,1),i="function"==typeof t?t:function(){this[t].apply(this,e)};return this.prototype._onLoadHooks=this.prototype._onLoadHooks||[],this.prototype._onLoadHooks.push(i),this},e.prototype.isLoaded=function(){return!!this._loaded},e.prototype.getSpatialReference=function(){return this._spatialReference},e.prototype.setSpatialReference=function(t){var e=this.options.spatialReference;if(e&&!t)return this;if(t=n({},t),this._center=this.getCenter(),this.options.spatialReference=t,this._spatialReference=new hi(t),this.options.spatialReference&&p(this.options.spatialReference.projection)){var i=this._spatialReference.getProjection();this.options.spatialReference.projection=i.code}return this._resetMapStatus(),this._fireEvent("spatialreferencechange",{old:e,new:n({},this.options.spatialReference)}),this},e.prototype.onConfig=function(t){var e=t.spatialReference||t.view;return r(e)||this.setSpatialReference(e),this},e.prototype.getProjection=function(){return this._spatialReference?this._spatialReference.getProjection():null},e.prototype.getFullExtent=function(){return this._spatialReference?this._spatialReference.getFullExtent():null},e.prototype.setCursor=function(t){return delete this._cursor,this._trySetCursor(t),this._cursor=t,this},e.prototype.resetCursor=function(){return this.setCursor(null)},e.prototype.getCenter=function(){return this._loaded&&this._prjCenter?this.getProjection().unproject(this._prjCenter):this._center},e.prototype.setCenter=function(t){if(!t)return this;if(t=new Ce(t),!this._verifyExtent(t))return this;if(!this._loaded)return this._center=t,this;this.onMoveStart();var e=this.getProjection(),i=e.project(t);return this._setPrjCenter(i),this.onMoveEnd(),this},e.prototype.setCoordinateAtContainerPoint=function(t,e){if(e.x===this.width/2&&e.y===this.height/2)return this;var i=this._containerPointToPoint(e)._sub(this._prjToPoint(this._getPrjCenter())),n=this._pointToPrj(this.coordinateToPoint(t).sub(i));return this._setPrjCenter(n),this},e.prototype.getSize=function(){return r(this.width)||r(this.height)?this._getContainerDomSize():new _e(this.width,this.height)},e.prototype.getContainerExtent=function(){return new Me(0,0,this.width,this.height)},e.prototype.getExtent=function(){return this._pointToExtent(this._get2DExtent())},e.prototype.getProjExtent=function(){var t=this._get2DExtent();return new be(this._pointToPrj(t.getMin()),this._pointToPrj(t.getMax()))},e.prototype.getMaxExtent=function(){return this.options.maxExtent?new be(this.options.maxExtent):null},e.prototype.setMaxExtent=function(t){if(t){var e=new be(t);this.options.maxExtent=e;var i=this.getCenter();this._verifyExtent(i)||this.panTo(e.getCenter())}else delete this.options.maxExtent;return this},e.prototype.getZoom=function(){return this._zoomLevel},e.prototype.getZoomForScale=function(t,e){var i=this.getZoom();if(r(e)&&(e=i),1===t&&e===i)return i;for(var n=this._getResolution(e),s=this._getResolutions(),a=this.getMinZoom(),h=this.getMaxZoom(),p=Number.MAX_VALUE,u=-1,c=s.length-1;c>=0;c--){var l=Math.abs(n/s[c]-t);l<p&&(p=l,u=c)}return o(a)&&u<a&&(u=a),o(h)&&u>h&&(u=h),u},e.prototype.getZoomFromRes=function(t){var e=this._getResolutions(),i=this._getResolution(this.getMinZoom()),n=this._getResolution(this.getMaxZoom());if(i<=n){if(t<=i)return this.getMinZoom();if(t>=n)return this.getMaxZoom()}else{if(t>=i)return this.getMinZoom();if(t<=n)return this.getMaxZoom()}for(var r=e.length,o=0;o<r-1;o++)if(e[o]){var s=Math.abs(e[o+1]-e[o]),a=Math.abs(t-e[o]);if(s>=a)return o+a/s}return r-1},e.prototype.setZoom=function(t){var e=this;return d(function(){e._loaded&&e.options.zoomAnimation?e._zoomAnimation(t):e._zoom(t)},function(){return!e._zooming}),this},e.prototype.getMaxZoom=function(){return r(this.options.maxZoom)?this.getMaxNativeZoom():this.options.maxZoom},e.prototype.getMaxNativeZoom=function(){var t=this.getSpatialReference();return t?t.getResolutions().length-1:null},e.prototype.setMaxZoom=function(t){var e=this._spatialReference.getMaxZoom();return t>e&&(t=e),t<this._zoomLevel&&this.setZoom(t),this.options.maxZoom=t,this},e.prototype.getMinZoom=function(){return r(this.options.minZoom)?0:this.options.minZoom},e.prototype.setMinZoom=function(t){var e=this._spatialReference.getMinZoom();return t<e&&(t=e),this.options.minZoom=t,this},e.prototype.zoomIn=function(){var t=this;return d(function(){t.setZoom(t.getZoom()+1)},function(){return!t._zooming}),this},e.prototype.zoomOut=function(){var t=this;return d(function(){t.setZoom(t.getZoom()-1)},function(){return!t._zooming}),this},e.prototype.isZooming=function(){return!!this._zooming},e.prototype.isInteracting=function(){return this.isZooming()||this.isMoving()||this.isDragRotating()},e.prototype.setCenterAndZoom=function(t,e){return this._zoomLevel!==e?(this.setCenter(t),r(e)||this.setZoom(e)):this.setCenter(t),this},e.prototype.getFitZoom=function(t){var e=this;if(!(t&&t instanceof be))return this._zoomLevel;if(t.xmin===t.xmax&&t.ymin===t.ymax)return this.getMaxZoom();var i=this.getSize(),n=t.convertTo(function(t){return e.coordinateToContainerPoint(t)}),r=n.getWidth(),o=n.getHeight(),s=i.width/r,a=i.height/o,h=this._getResolutions(),p=h[0]<h[h.length-1]?Math.max(s,a):Math.min(s,a);return this.getZoomForScale(p)},e.prototype.setView=function(t){return t?(t.center&&this.setCenter(t.center),t.zoom&&this.setZoom(t.zoom),t.pitch&&this.setPitch(t.pitch),t.bearing&&this.setBearing(t.bearing),this):this},e.prototype.getResolution=function(t){return this._getResolution(t)},e.prototype.getScale=function(t){var e=r(t)?this.getZoom():t,i=this._getResolution(this.getMaxNativeZoom());return this._getResolution(e)/i},e.prototype.fitExtent=function(t,e){if(!t)return this;t=new be(t);var i=this.getFitZoom(t)+(e||0),n=t.getCenter();return this.setCenterAndZoom(n,i)},e.prototype.getBaseLayer=function(){return this._baseLayer},e.prototype.setBaseLayer=function(t){function e(){this._fireEvent("baselayerload"),i&&(i=!1,this._fireEvent("baselayerchangeend"))}var i=!1;return this._baseLayer&&(i=!0,this._fireEvent("baselayerchangestart"),this._baseLayer.remove()),t?(this._baseLayer=t,t._bindMap(this,-1),this._baseLayer.on("layerload",e,this),this._loaded&&this._baseLayer.load(),this._fireEvent("setbaselayer"),this):(delete this._baseLayer,this._fireEvent("baselayerchangeend"),this._fireEvent("setbaselayer"),this)},e.prototype.removeBaseLayer=function(){return this._baseLayer&&(this._baseLayer.remove(),delete this._baseLayer,this._fireEvent("baselayerremove")),this},e.prototype.getLayers=function(t){return this._getLayers(function(e){return!(e===this._baseLayer||e.getId().indexOf("_maptalks__internal_layer_")>=0)&&(!t||t(e))})},e.prototype.getLayer=function(t){if(!t)return null;var e=this._layerCache?this._layerCache[t]:null;if(e)return e;var i=this.getBaseLayer();return i&&i.getId()===t?i:null},e.prototype.addLayer=function(t){if(!t)return this;if(!Array.isArray(t))return this.addLayer([t]);this._layerCache||(this._layerCache={});for(var e=0,i=t.length;e<i;e++){var n=t[e],o=n.getId();if(r(o))throw new Error("Invalid id for the layer: "+o);if(this._layerCache[o])throw new Error("Duplicate layer id in the map: "+o);this._layerCache[o]=n,n._bindMap(this,this._layers.length),this._layers.push(n),this._loaded&&n.load()}return this._fireEvent("addlayer",{layers:t}),this},e.prototype.removeLayer=function(t){if(!t)return this;if(!Array.isArray(t))return this.removeLayer([t]);for(var e=[],i=0,n=t.length;i<n;i++){var r=t[i];if(r instanceof We||(r=this.getLayer(r)),r){var o=r.getMap();if(o&&o===this){e.push(r),this._removeLayer(r,this._layers),this._loaded&&r._doRemove();var s=r.getId();this._layerCache&&delete this._layerCache[s]}}}return e.length>0&&this.once("frameend",function(){e.forEach(function(t){t.fire("remove")})}),this._fireEvent("removelayer",{layers:t}),this},e.prototype.sortLayers=function(t){if(!t||!Array.isArray(t))return this;for(var e=[],i=Number.MAX_VALUE,n=0,r=t.length;n<r;n++){var o=t[n];if(h(t[n])&&(o=this.getLayer(o)),!(o instanceof We&&o.getMap()&&o.getMap()===this))throw new Error("It must be a layer added to this map to order.");o.getZIndex()<i&&(i=o.getZIndex()),e.push(o)}for(var s=0,a=e.length;s<a;s++)e[s].setZIndex(i+s);return this},e.prototype.toDataURL=function(t){t||(t={});var e=t.mimeType;e||(e="image/png");var i=t.save,n=this._getRenderer();if(n&&n.toDataURL){var r=t.filename;r||(r="export");var o=n.toDataURL(e);if(i&&o){var s=o,a=document.createElement("a");a.download=r,a.href=s,a.dataset.downloadurl=[e,a.download,a.href].join(":"),document.body.appendChild(a),a.click(),document.body.removeChild(a)}return o}return null},e.prototype.coordinateToPoint=function(t,e){var i=this.getProjection().project(t);return this._prjToPoint(i,e)},e.prototype.pointToCoordinate=function(t,e){var i=this._pointToPrj(t,e);return this.getProjection().unproject(i)},e.prototype.coordinateToViewPoint=function(t){return this._prjToViewPoint(this.getProjection().project(t))},e.prototype.viewPointToCoordinate=function(t){return this.getProjection().unproject(this._viewPointToPrj(t))},e.prototype.coordinateToContainerPoint=function(t){var e=this.getProjection().project(t);return this._prjToContainerPoint(e)},e.prototype.containerPointToCoordinate=function(t){var e=this._containerPointToPrj(t);return this.getProjection().unproject(e)},e.prototype.containerPointToViewPoint=function(t){return t.sub(this.getViewPoint())},e.prototype.viewPointToContainerPoint=function(t){return t.add(this.getViewPoint())},e.prototype.containerToExtent=function(t){var e=new Me(this._containerPointToPoint(t.getMin()),this._containerPointToPoint(t.getMax()));return this._pointToExtent(e)},e.prototype.checkSize=function(){var t=i()-this._initTime<1500&&0===this.width||0===this.height,e=this._getContainerDomSize(),n=this.height,r=this.width;if(e.width===r&&e.height===n)return this;var o=this.getCenter();this._updateMapSize(e);var s=new me((r-e.width)/2,(n-e.height)/2);this._offsetCenterByPixel(s),this._mapViewCoord=this._getPrjCenter();var a=0===e.width||0===e.height||0===r||0===n;return(t||a)&&(this._eventSuppressed=!0,this.setCenter(o),this._eventSuppressed=!1),this._fireEvent("resize"),this},e.prototype.distanceToPixel=function(t,e,i){var n=this.getProjection();if(!n)return null;var r=this.getScale()/this.getScale(i),o=this.getCenter(),s=n.locate(o,t,e),a=this.coordinateToContainerPoint(o),h=this.coordinateToContainerPoint(s);return h._sub(a)._multi(r)._abs(),new _e(h.x,h.y)},e.prototype.pixelToDistance=function(t,e){var i=this.getProjection();if(!i)return null;var n=this.getFullExtent(),r=n.top>n.bottom?-1:1,o=new me(this.width/2+t,this.height/2+r*e),s=this.containerPointToCoordinate(o);return i.measureLength(this.getCenter(),s)},e.prototype.locate=function(t,e,i){return this.getProjection().locate(new Ce(t),e,i)},e.prototype.locateByPoint=function(t,e,i){var n=this.coordinateToContainerPoint(t);return this.containerPointToCoordinate(n._add(e,i))},e.prototype.getMainPanel=function(){return this._getRenderer().getMainPanel()},e.prototype.getPanels=function(){return this._panels},e.prototype.remove=function(){if(this.isRemoved())return this;this._removeDomEvents(),this._clearHandlers(),this.removeBaseLayer();for(var t=this.getLayers(),e=0;e<t.length;e++)t[e].remove();return this._getRenderer()&&this._getRenderer().remove(),this._clearAllListeners(),this._containerDOM.innerHTML&&(this._containerDOM.innerHTML=""),delete this._panels,delete this._containerDOM,this},e.prototype.isRemoved=function(){return!this._containerDOM},e.prototype.isMoving=function(){return!!this._moving},e.prototype.onMoveStart=function(t){this._originCenter=this.getCenter(),this._moving=!0,this._trySetCursor("move"),this._fireEvent("movestart",this._parseEvent(t?t.domEvent:null,"movestart"))},e.prototype.onMoving=function(t){this._fireEvent("moving",this._parseEvent(t?t.domEvent:null,"moving"))},e.prototype.onMoveEnd=function(t){if(this._moving=!1,this._trySetCursor("default"),this._fireEvent("moveend",this._parseEvent(t?t.domEvent:null,"moveend")),!this._verifyExtent(this.getCenter())){var e=this._originCenter;this._verifyExtent(e)||(e=this.getMaxExtent().getCenter()),this.panTo(e)}},e.prototype.onDragRotateStart=function(t){this._dragRotating=!0,this._fireEvent("dragrotatestart",this._parseEvent(t?t.domEvent:null,"dragrotatestart"))},e.prototype.onDragRotating=function(t){this._fireEvent("dragrotating",this._parseEvent(t?t.domEvent:null,"dragrotating"))},e.prototype.onDragRotateEnd=function(t){this._dragRotating=!1,this._fireEvent("dragrotateend",this._parseEvent(t?t.domEvent:null,"dragrotateend"))},e.prototype.isDragRotating=function(){return!!this._dragRotating},e.prototype._trySetCursor=function(t){return this._cursor||this._priorityCursor||(t||(t="default"),this._setCursorToPanel(t)),this},e.prototype._setPriorityCursor=function(t){if(t)this._priorityCursor=t,this._setCursorToPanel(t);else{var e=!1;this._priorityCursor&&(e=!0),delete this._priorityCursor,e&&this.setCursor(this._cursor)}return this},e.prototype._setCursorToPanel=function(t){var e=this.getMainPanel();e&&e.style&&e.style.cursor!==t&&(e.style.cursor=t)},e.prototype._get2DExtent=function(t){var e=this._containerPointToPoint(new me(0,0),t),i=this._containerPointToPoint(new me(this.width,0),t),n=this._containerPointToPoint(new me(this.width,this.height),t),r=this._containerPointToPoint(new me(0,this.height),t),o=Math.min(e.x,i.x,n.x,r.x),s=Math.max(e.x,i.x,n.x,r.x),a=Math.min(e.y,i.y,n.y,r.y),h=Math.max(e.y,i.y,n.y,r.y);return new Me(o,a,s,h)},e.prototype._pointToExtent=function(t){return new be(this.pointToCoordinate(t.getMin()),this.pointToCoordinate(t.getMax()))},e.prototype._removeLayer=function(t,e){if(t&&e){var i=e.indexOf(t);if(i>-1){e.splice(i,1);for(var n=0,r=e.length;n<r;n++)e[n].setZIndex&&e[n].setZIndex(n)}}},e.prototype._sortLayersByZIndex=function(){this._layers&&this._layers.sort(function(t,e){return t.getZIndex()-e.getZIndex()})},e.prototype._fireEvent=function(t,e){this._eventSuppressed||(this.fire("_"+t,e),this.fire(t,e))},e.prototype._Load=function(){this._resetMapStatus(),this._registerDomEvents(),this.options.pitch&&(this.setPitch(this.options.pitch),delete this.options.pitch),this.options.bearing&&(this.setBearing(this.options.bearing),delete this.options.bearing),this._loadAllLayers(),this._getRenderer().onLoad(),this._loaded=!0,this._callOnLoadHooks(),this._initTime=i()},e.prototype._initRenderer=function(){var t=this.options.renderer,i=e.getRendererClass(t);this._renderer=new i(this),this._renderer.load()},e.prototype._getRenderer=function(){return this._renderer},e.prototype._loadAllLayers=function(){function t(t){t&&t.load()}this._baseLayer&&this._baseLayer.load(),this._eachLayer(t,this.getLayers())},e.prototype._getLayers=function(t){for(var e=this._baseLayer?[this._baseLayer].concat(this._layers):this._layers,i=[],n=0;n<e.length;n++)t&&!t.call(this,e[n])||i.push(e[n]);return i},e.prototype._eachLayer=function(t){if(!(arguments.length<2)){var e=Array.prototype.slice.call(arguments,1);e&&!Array.isArray(e)&&(e=[e]);for(var i=[],n=0,r=e.length;n<r;n++)i=i.concat(e[n]);for(var o=0,s=i.length;o<s;o++)t.call(t,i[o])}},e.prototype._onLayerEvent=function(t){t&&"idchange"===t.type&&(delete this._layerCache[t.old],this._layerCache[t.new]=t.target)},e.prototype._resetMapStatus=function(){var t=this.getMaxZoom(),e=this.getMinZoom(),i=this._spatialReference.getMaxZoom(),n=this._spatialReference.getMinZoom();(r(t)||-1===t||t>i)&&this.setMaxZoom(i),(r(e)||-1===e||e<n)&&this.setMinZoom(n),t=this.getMaxZoom(),e=this.getMinZoom(),t<e&&this.setMaxZoom(e),(r(this._zoomLevel)||this._zoomLevel>t)&&(this._zoomLevel=t),this._zoomLevel<e&&(this._zoomLevel=e),delete this._prjCenter;var o=this.getProjection();this._prjCenter=o.project(this._center);var s=this._getRenderer();s&&s.resetContainer()},e.prototype._getContainerDomSize=function(){if(!this._containerDOM)return null;var t=this._containerDOM,e=void 0,i=void 0;if(r(t.width)||r(t.height)){if(r(t.clientWidth)||r(t.clientHeight))throw new Error("can not get size of container");e=parseInt(t.clientWidth,0),i=parseInt(t.clientHeight,0)}else e=t.width,i=t.height,ye.retina&&t.layer&&(e/=2,i/=2);return new _e(e,i)},e.prototype._updateMapSize=function(t){return this.width=t.width,this.height=t.height,this._getRenderer().updateMapSize(t),this._calcMatrices(),this},e.prototype._getPrjCenter=function(){return this._prjCenter},e.prototype._setPrjCenter=function(t){this._prjCenter=t,this.isInteracting()&&!this.isMoving()&&(this._mapViewCoord=t),this._calcMatrices()},e.prototype._verifyExtent=function(t){if(!t)return!1;var e=this.getMaxExtent();return!e||e.contains(t)},e.prototype._offsetCenterByPixel=function(t){var e=new me(this.width/2-t.x,this.height/2-t.y),i=this._containerPointToPrj(e);return this._setPrjCenter(i),i},e.prototype.offsetPlatform=function(t){return t?(this._getRenderer().offsetPlatform(t),this._mapViewCoord=this._getPrjCenter(),this._mapViewPoint=this._mapViewPoint.add(t),this):this._mapViewPoint},e.prototype.getViewPoint=function(){var t=this._getViewPointOffset(),e=this.offsetPlatform();return t&&(e=e.add(t)),e},e.prototype._getViewPointOffset=function(){var t=this._getPrjCenter();return this._mapViewCoord&&!this._mapViewCoord.equals(t)?this._prjToContainerPoint(this._mapViewCoord).sub(this._prjToContainerPoint(t)):null},e.prototype._resetMapViewPoint=function(){this._mapViewPoint=new me(0,0),this._mapViewCoord=this._getPrjCenter()},e.prototype._getResolution=function(t){return r(t)&&(t=this.getZoom()),this._spatialReference.getResolution(t)},e.prototype._getResolutions=function(){return this._spatialReference.getResolutions()},e.prototype._prjToPoint=function(t,e){return e=r(e)?this.getZoom():e,this._spatialReference.getTransformation().transform(t,this._getResolution(e))},e.prototype._pointToPrj=function(t,e){return e=r(e)?this.getZoom():e,this._spatialReference.getTransformation().untransform(t,this._getResolution(e))},e.prototype._pointToPoint=function(t,e){return r(e)?t.copy():t.multi(this._getResolution(e)/this._getResolution())},e.prototype._pointToPointAtZoom=function(t,e){return r(e)?t.copy():t.multi(this._getResolution()/this._getResolution(e))},e.prototype._containerPointToPrj=function(t){return this._pointToPrj(this._containerPointToPoint(t))},e.prototype._viewPointToPrj=function(t){return this._containerPointToPrj(this.viewPointToContainerPoint(t))},e.prototype._prjToContainerPoint=function(t){return this._pointToContainerPoint(this._prjToPoint(t))},e.prototype._prjToViewPoint=function(t){var e=this._prjToContainerPoint(t);return this._containerPointToViewPoint(e)},e.prototype._containerPointToViewPoint=function(t){return t?t._sub(this.getViewPoint()):null},e.prototype._viewPointToPoint=function(t,e){return this._containerPointToPoint(this.viewPointToContainerPoint(t),e)},e.prototype._pointToViewPoint=function(t,e){return this._prjToViewPoint(this._pointToPrj(t,e))},e.prototype._callOnLoadHooks=function(){var t=e.prototype;if(t._onLoadHooks)for(var i=0,n=t._onLoadHooks.length;i<n;i++)t._onLoadHooks[i].call(this)},e}(Ie(Le(Oe(Ae))));ui.mergeOptions(pi);var ci="mousedown mouseup mouseover mouseout mousemove click dblclick contextmenu keypress touchstart touchmove touchend ";ui.include({_registerDomEvents:function(){nt(this._panels.mapWrapper||this._containerDOM,ci,this._handleDOMEvent,this)},_removeDomEvents:function(){rt(this._panels.mapWrapper||this._containerDOM,ci,this._handleDOMEvent)},_handleDOMEvent:function(t){var e=t.type;if(!this._ignoreEvent(t)){"contextmenu"===e&&st(t);var n=null;if("mousedown"===e||"touchstart"===e&&1===t.touches.length)this._mouseDownTime=i();else if(("click"===e||"touchend"===e||"contextmenu"===e)&&this._mouseDownTime){var r=this._mouseDownTime;delete this._mouseDownTime;var o=i();if(o-r>300){if("click"===e||"contextmenu"===e)return}else"touchend"===e&&(n="click")}if("click"===e){2===t.button&&(e="contextmenu")}this._fireDOMEvent(this,t,e),n&&this._fireDOMEvent(this,t,n)}},_ignoreEvent:function(t){if(!t||!this._panels.control)return!1;var e=t.srcElement||t.target;if(e)for(;e&&e!==this._containerDOM;){if(e.className&&e.className.indexOf&&(e.className.indexOf("maptalks-control")>=0||e.className.indexOf("maptalks-ui")>=0))return!0;e=e.parentNode}return!1},_parseEvent:function(t,e){if(!t)return null;var i={domEvent:t};if("keypress"!==e){var n=t.touches&&t.touches.length>0?t.touches[0]:t.changedTouches&&t.changedTouches.length>0?t.changedTouches[0]:t;if(n){var r=ct(n,this._containerDOM)
;i.coordinate=this.containerPointToCoordinate(r),i.containerPoint=r,i.viewPoint=this.containerPointToViewPoint(r),i.point2d=this._containerPointToPoint(r)}}return i},_fireDOMEvent:function(t,e,i){if(!this.isRemoved()){var n=this._parseEvent(e,i);this._fireEvent(i,n)}}});var li="undefined"!=typeof Float32Array?Float32Array:Array,fi=Math.PI/180;ui.include({getFov:function(){return this._fov||(this._fov=.6435011087932844),this._fov/fi},setFov:function(t){if(this.isZooming())return this;if(t=Math.max(.01,Math.min(60,t)),this._fov===t)return this;var e=this.getFov();return this._fov=t*fi,this._calcMatrices(),this._renderLayers(),this._fireEvent("fovchange",{from:e,to:this.getFov()}),this},getBearing:function(){return this._angle?-this._angle/fi:0},setBearing:function(t){if(ye.ie9)throw new Error("map can't rotate in IE9.");if(this.isZooming())return this;var e=-P(t,-180,180)*fi;if(this._angle===e)return this;var i=this.getBearing();return this._angle=e,this._calcMatrices(),this._renderLayers(),this._fireEvent("rotate",{from:i,to:e}),this},getPitch:function(){return this._pitch?this._pitch/Math.PI*180:0},setPitch:function(t){if(ye.ie9)throw new Error("map can't tilt in IE9.");if(this.isZooming())return this;var e=C(t,0,60)*fi;if(this._pitch===e)return this;var i=this.getPitch();return this._pitch=e,this._calcMatrices(),this._renderLayers(),this._fireEvent("pitch",{from:i,to:e}),this},isTransforming:function(){return!(!this._pitch&&!this._angle)},_pointToContainerPoint:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if(t=this._pointToPoint(t,e),this.isTransforming()||i){var n=[t.x,t.y,i,1];return Pt(n,n,this.pixelMatrix),new me(n[0]/n[3],n[1]/n[3])}var r=this._prjToPoint(this._getPrjCenter());return t._sub(r)._add(this.width/2,this.height/2)},_containerPointToPoint:function(t,e){if(this.isTransforming()){var i=[t.x,t.y,0,1],n=[t.x,t.y,1,1];Pt(i,i,this.pixelMatrixInverse),Pt(n,n,this.pixelMatrixInverse);var r=i[3],o=n[3],s=i[0]/r,a=n[0]/o,h=i[1]/r,p=n[1]/o,u=i[2]/r,c=n[2]/o,l=u===c?0:(0-u)/(c-u),f=new me(w(s,a,l),w(h,p,l));return void 0===e||this.getZoom()===e?f:this._pointToPointAtZoom(f,e)}var y=this._prjToPoint(this._getPrjCenter(),e),d=void 0!==e?this._getResolution()/this._getResolution(e):1,g=d*(t.x-this.width/2),m=d*(t.y-this.height/2);return y._add(g,m)},_calcMatrices:function(){if(this.height&&"undefined"!=typeof Float64Array){this._fov||(this._fov=.6435011087932844),this._pitch||(this._pitch=0),this._angle||(this._angle=0);var t=this._prjToPoint(this._prjCenter),e=t.x,i=t.y;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height;var n=this._fov/2,r=Math.PI/2+this._pitch,o=Math.sin(n)*this.cameraToCenterDistance/Math.sin(Math.PI-r-n),s=Math.cos(Math.PI/2-this._pitch)*o+this.cameraToCenterDistance,a=1.01*s,h=new Float64Array(16);Ct(h,this._fov,this.width/this.height,1,a),Mt(h,h,[1,-1,1]),bt(h,h,[0,0,-this.cameraToCenterDistance]),St(h,h,this._pitch),Et(h,h,this._angle);var p=Lt(new Float64Array(16),h);if(bt(h,h,[-e,-i,0]),this.projMatrix=h,h=Tt(),Mt(h,h,[this.width/2,-this.height/2,1]),bt(h,h,[1,-1,0]),this.pixelMatrix=Rt(new Float64Array(16),h,this.projMatrix),!(h=At(new Float64Array(16),this.pixelMatrix)))throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=h,!this._pitch&&!this._angle)return void this._clearMatrices();h=Tt(),Mt(h,h,[this.width/2,-this.height/2,1]),this.domCssMatrix=Rt(h,h,p)}},_clearMatrices:function(){delete this.domCssMatrix},_renderLayers:function(){if(!this.isInteracting()){this._getLayers().forEach(function(t){if(t){var e=t._getRenderer();e&&e.setToRedraw&&e.setToRedraw()}})}}});var yi=[Ee],di=function(t){function e(i){Zt(this,e);var n=Nt(this,t.call(this));return n.geometry=i,n.symbolizers=n._createSymbolizers(),n.height=n._getGeometryHeight(),n}return Ft(e,t),e.prototype.getMap=function(){return this.geometry.getMap()},e.prototype.getLayer=function(){return this.geometry.getLayer()},e.prototype._createSymbolizers=function(){var t=this.getSymbol(),e=[],i=yi,n=t;Array.isArray(t)||(n=[t]);for(var r=n.length-1;r>=0;r--)for(var o=n[r],s=i.length-1;s>=0;s--)if(i[s].test(o,this.geometry)){var a=new i[s](o,this.geometry,this);e.push(a)}if(!e.length&&console){var h=this.geometry.getId();console.warn("invalid symbol for geometry("+(this.geometry?this.geometry.getType()+(h?":"+h:""):"")+") to draw : "+JSON.stringify(t))}return this._hasShadow=this.geometry.options.shadowBlur>0,e},e.prototype.hasPoint=function(){return!!this._hasPoint},e.prototype.getRenderPoints=function(t){return this._renderPoints||(this._renderPoints={}),t||(t="point"),this._renderPoints[t]||(this._renderPoints[t]=this.geometry._getRenderPoints(t)),this._renderPoints[t]},e.prototype.getPaintParams=function(t,e){var i=this.getMap(),n=i.getZoom(),r=0!==i.getPitch(),s=0!==i.getBearing(),a=this._paintParams;if((!a||void 0!==a._zoom&&a._zoom!==n||this._pitched!==r&&this.geometry._redrawWhenPitch()||this._rotated!==s&&this.geometry._redrawWhenRotate())&&(a=this.geometry._getPaintParams(),this.geometry._simplified&&(a._zoom=n),this._paintParams=a),!a)return null;this._pitched=r,this._rotated=s;var h=i.getMaxNativeZoom(),p=i.getScale(),u=this.getHeight(),c=this.getLayer()._getRenderer()._northWest,l=i._pointToContainerPoint(c),f=this._paintParams,y=[],d=f[0],g=void 0;Array.isArray(d)?g=m(d,function(n){var r=i._pointToContainerPoint(n,h,u)._sub(l);return(t||e)&&r._add(t,e),r}):d instanceof me&&(g=i._pointToContainerPoint(d,h,u)._sub(l),(t||e)&&g._add(t,e)),y.push(g);for(var _=1,v=f.length;_<v;_++)o(f[_])||f[_]instanceof _e?o(f[_])?y.push(f[_]/p):y.push(f[_].multi(1/p)):y.push(f[_]);return y},e.prototype.getSymbol=function(){return this.geometry._getInternalSymbol()},e.prototype.paint=function(t){if(this.symbolizers){var e=this.getLayer()._getRenderer();if(e&&e.context&&(!t||t.intersects(this.get2DExtent(e.resources)))){var i=[e.context,e.resources];this._prepareShadow(e.context);for(var n=this.symbolizers.length-1;n>=0;n--)this.symbolizers[n].symbolize.apply(this.symbolizers[n],i);this._painted=!0}}},e.prototype.getSprite=function(t,e){if("Point"!==this.geometry.type)return null;if(this._genSprite=!0,!this._sprite&&this.symbolizers.length>0){var i=new Me;this.symbolizers.forEach(function(e){var n=e.getMarkerExtent(t);i._combine(n)});var n=i.getMin().multi(-1),r=e||(this.getMap()?this.getMap().CanvasClass:null),o=Pe.createCanvas(i.getWidth(),i.getHeight(),r),s=void 0;this._renderPoints&&(s=this._renderPoints);var a=[o.getContext("2d"),t];this._prepareShadow(o.getContext("2d"));for(var h=this.symbolizers.length-1;h>=0;h--){var p=this.symbolizers[h].getDxDy();this._renderPoints={point:[[n.add(p)]]},this.symbolizers[h].symbolize.apply(this.symbolizers[h],a)}s&&(this._renderPoints=s),this._sprite={canvas:o,offset:i.getCenter()}}return this._genSprite=!1,this._sprite},e.prototype.isSpriting=function(){return this._genSprite},e.prototype._prepareShadow=function(t){this._hasShadow?(t.shadowBlur=this.geometry.options.shadowBlur,t.shadowColor=this.geometry.options.shadowColor):t.shadowBlur&&(t.shadowBlur=null,t.shadowColor=null)},e.prototype._eachSymbolizer=function(t,e){if(this.symbolizers){e||(e=this);for(var i=this.symbolizers.length-1;i>=0;i--)t.apply(e,[this.symbolizers[i]])}},e.prototype.get2DExtent=function(t){this._verifyProjection();var e=this.getMap();t=t||this.getLayer()._getRenderer().resources;var i=e.getZoom();if((!this._extent2D||this._extent2D._zoom!==i)&&(delete this._extent2D,delete this._markerExtent,this.symbolizers)){for(var n=this._extent2D=new Me,r=this._markerExtent=new Me,o=this.symbolizers.length-1;o>=0;o--){var s=this.symbolizers[o];n._combine(s.get2DExtent()),s.getMarkerExtent&&r._combine(s.getMarkerExtent(t))}n._zoom=i}return this._extent2D.add(this._markerExtent)},e.prototype.getContainerExtent=function(){var t=this;this._verifyProjection();var e=this.getMap(),i=e.getZoom();this._extent2D&&this._extent2D._zoom===i||this.get2DExtent();var n=this._extent2D.convertTo(function(n){return e._pointToContainerPoint(n,i,t.height)});return n&&n._add(this._markerExtent),n},e.prototype.setZIndex=function(t){this._eachSymbolizer(function(e){e.setZIndex(t)})},e.prototype.show=function(){if(this._painted)this.removeCache(),this._eachSymbolizer(function(t){t.show()});else{this.getLayer().isCanvasRender()||this.paint()}},e.prototype.hide=function(){this._eachSymbolizer(function(t){t.hide()})},e.prototype.repaint=function(){this.removeCache()},e.prototype.refreshSymbol=function(){this.removeCache(),this._removeSymbolizers(),this.symbolizers=this._createSymbolizers()},e.prototype.remove=function(){this.removeCache(),this._removeSymbolizers()},e.prototype._removeSymbolizers=function(){this._eachSymbolizer(function(t){delete t.painter,t.remove()}),delete this.symbolizers},e.prototype.removeCache=function(){delete this._renderPoints,delete this._paintParams,delete this._sprite,delete this._extent2D,delete this._markerExtent},e.prototype.getHeight=function(){if(this._getHeightProperty()!==this._propHeight&&(this.height=this._getGeometryHeight()),!this.height)return 0;var t=this.getMap().getScale();return this.height/t},e.prototype._getGeometryHeight=function(){var t=this.getMap();if(!t)return 0;var e=this._getHeightProperty();if(this._propHeight=e,!e)return 0;var i=this.geometry,n=t.getMaxNativeZoom(),r=i.getCenter(),o=t.locate(r,e,0),s=t.coordinateToPoint(r,n),a=t.coordinateToPoint(o,n);return Math.abs(a.x-s.x)*x(e)},e.prototype._getHeightProperty=function(){var t=this.geometry,e=t.getLayer().options,i=t.getProperties();return e.enableHeight&&i?i[e.heightProperty]:0},e.prototype._verifyProjection=function(){var t=this.geometry._getProjection();this._projCode&&this._projCode!==t.code&&this.removeCache(),this._projCode=t.code},e}(Ae),gi=function(t){function e(i){Zt(this,e);var n=Nt(this,t.call(this));return n.geometry=i,n}return Ft(e,t),e.prototype._eachPainter=function(t){for(var e=this.geometry.getGeometries(),i=void 0,n=0,r=e.length;n<r&&(!(i=e[n]._getPainter())||!i||!1!==t.call(this,i));n++);},e.prototype.paint=function(t){this.geometry&&this._eachPainter(function(e){e.paint(t)})},e.prototype.get2DExtent=function(t){var e=new Me;return this._eachPainter(function(i){e=e.combine(i.get2DExtent(t))}),e},e.prototype.getContainerExtent=function(){var t=new Me;return this._eachPainter(function(e){t=t.combine(e.getContainerExtent())}),t},e.prototype.remove=function(){var t=arguments;this._eachPainter(function(e){e.remove.apply(e,t)})},e.prototype.setZIndex=function(){var t=arguments;this._eachPainter(function(e){e.setZIndex.apply(e,t)})},e.prototype.show=function(){var t=arguments;this._eachPainter(function(e){e.show.apply(e,t)})},e.prototype.hide=function(){var t=arguments;this._eachPainter(function(e){e.hide.apply(e,t)})},e.prototype.repaint=function(){var t=arguments;this._eachPainter(function(e){e.repaint.apply(e,t)})},e.prototype.refreshSymbol=function(){var t=arguments;this._eachPainter(function(e){e.refreshSymbol.apply(e,t)})},e.prototype.hasPoint=function(){var t=!1;return this._eachPainter(function(e){return!e.hasPoint()||(t=!0,!1)}),t},e}(Ae),mi={id:null,visible:!0,editable:!0,cursor:null,shadowBlur:0,shadowColor:"black",measure:"EPSG:4326"},_i=function(t){function e(i){Zt(this,e);var o=n({},i),s=o.symbol,a=o.properties,h=o.id;delete o.symbol,delete o.id,delete o.properties;var p=Nt(this,t.call(this,o));return s&&p.setSymbol(s),a&&p.setProperties(a),r(h)||p.setId(h),p}return Ft(e,t),e.prototype.getFirstCoordinate=function(){if("GeometryCollection"===this.type){var t=this.getGeometries();return t.length?t[0].getFirstCoordinate():null}var e=this.getCoordinates();if(!Array.isArray(e))return e;do{e=e[0]}while(Array.isArray(e)&&e.length>0);return e},e.prototype.getLastCoordinate=function(){if("GeometryCollection"===this.type){var t=this.getGeometries();return t.length?t[t.length-1].getLastCoordinate():null}var e=this.getCoordinates();if(!Array.isArray(e))return e;do{e=e[e.length-1]}while(Array.isArray(e)&&e.length>0);return e},e.prototype.addTo=function(t,e){return t.addGeometry(this,e),this},e.prototype.getLayer=function(){return this._layer?this._layer:null},e.prototype.getMap=function(){return this._layer?this._layer.getMap():null},e.prototype.getId=function(){return this._id},e.prototype.setId=function(t){var e=this.getId();return this._id=t,this._fireEvent("idchange",{old:e,new:t}),this},e.prototype.getProperties=function(){return this.properties?this.properties:this._getParent()?this._getParent().getProperties():null},e.prototype.setProperties=function(t){var e=this.properties;return this.properties=a(t)?n({},t):t,this._fireEvent("propertieschange",{old:e,new:t}),this},e.prototype.getType=function(){return this.type},e.prototype.getSymbol=function(){var t=this._symbol;return t?Array.isArray(t)?K(t):n({},t):null},e.prototype.setSymbol=function(t){return this._symbol=this._prepareSymbol(t),this.onSymbolChanged(),this},e.prototype.updateSymbol=function(t){if(!t)return this;var e=this._getSymbol();return e=e?K(e,t):K(this._getInternalSymbol(),t),this.setSymbol(e)},e.prototype.getCenter=function(){return this._computeCenter(this._getMeasurer())},e.prototype.getExtent=function(){var t=this._getPrjExtent();if(t){var e=this._getProjection();return new be(e.unproject(new Ce(t.xmin,t.ymin)),e.unproject(new Ce(t.xmax,t.ymax)))}return this._computeExtent(this._getMeasurer())},e.prototype.getSize=function(){return this.getMap()?this._getPainter().getContainerExtent().getSize():null},e.prototype.containsPoint=function(t,e){if(!this.getMap())throw new Error('The geometry is required to be added on a map to perform "containsPoint".');return t instanceof Ce&&(t=this.getMap().coordinateToContainerPoint(t)),this._containsPoint(this.getMap()._containerPointToPoint(new me(t)),e)},e.prototype.show=function(){if(this.options.visible=!0,this.getMap()){var t=this._getPainter();t&&t.show(),this._fireEvent("show")}return this},e.prototype.hide=function(){if(this.options.visible=!1,this.getMap()){this.onHide();var t=this._getPainter();t&&t.hide(),this._fireEvent("hide")}return this},e.prototype.isVisible=function(){if(!this.options.visible)return!1;var t=this._getInternalSymbol();if(!t)return!0;if(Array.isArray(t)){if(!t.length)return!0;for(var e=0,i=t.length;e<i;e++)if(r(t[e].opacity)||t[e].opacity>0)return!0;return!1}return r(t.opacity)||o(t.opacity)&&t.opacity>0},e.prototype.getZIndex=function(){return this.options.zIndex||0},e.prototype.setZIndex=function(t){var e=this.options.zIndex;return this.options.zIndex=t,this._fireEvent("zindexchange",{old:e,new:t}),this},e.prototype.setZIndexSilently=function(t){return this.options.zIndex=t,this},e.prototype.bringToFront=function(){var t=this.getLayer();if(!t||!t.getLastGeometry)return this;var e=t.getLastGeometry().getZIndex();return this.setZIndex(e+1),this},e.prototype.bringToBack=function(){var t=this.getLayer();if(!t||!t.getFirstGeometry)return this;var e=t.getFirstGeometry().getZIndex();return this.setZIndex(e-1),this},e.prototype.translate=function(t,e){if(r(t))return this;var i=new Ce(t,e);if(0===i.x&&0===i.y)return this;var n=this.getCoordinates();if(n)if(Array.isArray(n)){var o=m(n,function(t){return t.add(i)});this.setCoordinates(o)}else this.setCoordinates(n.add(i));return this},e.prototype.flash=function(t,e,i,n){function r(){if(0===e)return o.show(),void(i&&(n?i.call(n):i()));e%2==0?o.hide():o.show(),e--,o._flashTimeout=setTimeout(r,t)}t||(t=100),e||(e=4);var o=this;return e*=2,this._flashTimeout&&clearTimeout(this._flashTimeout),this._flashTimeout=setTimeout(r,t),this},e.prototype.copy=function(){var t=this.toJSON(),i=e.fromJSON(t);return i.options.visible=!0,i},e.prototype.remove=function(){return this.getLayer()?(this._fireEvent("removestart"),this._unbind(),this._fireEvent("removeend"),this._fireEvent("remove"),this):this},e.prototype.toGeoJSONGeometry=function(){return this._exportGeoJSONGeometry()},e.prototype.toGeoJSON=function(t){t||(t={});var e={type:"Feature",geometry:null};if(r(t.geometry)||t.geometry){var i=this._exportGeoJSONGeometry();e.geometry=i}var n=this.getId();r(n)||(e.id=n);var o=void 0;return(r(t.properties)||t.properties)&&(o=this._exportProperties()),e.properties=o,e},e.prototype.toJSON=function(t){t||(t={});var e=this._toJSON(t);return n(e,this._exportGraphicOptions(t)),e},e.prototype.getLength=function(){return this._computeGeodesicLength(this._getMeasurer())},e.prototype.getArea=function(){return this._computeGeodesicArea(this._getMeasurer())},e.prototype._getConnectPoints=function(){return[this.getCenter()]},e.prototype._initOptions=function(t){var e=n({},t),i=e.symbol,o=e.properties,s=e.id;delete e.symbol,delete e.id,delete e.properties,this.setOptions(e),i&&this.setSymbol(i),o&&this.setProperties(o),r(s)||this.setId(s)},e.prototype._bindLayer=function(t){if(this.getLayer())throw new Error("Geometry cannot be added to two or more layers at the same time.");this._layer=t,this._clearCache(),this._clearProjection()},e.prototype._prepareSymbol=function(t){if(Array.isArray(t)){for(var e=[],i=0;i<t.length;i++)e.push(mt(this._checkAndCopySymbol(t[i])));return e}return t?(t=this._checkAndCopySymbol(t),mt(t)):null},e.prototype._checkAndCopySymbol=function(t){var e={},i=ge.numericalProperties;for(var n in t)i[n]&&h(t[n])?e[n]=+t[n]:e[n]=t[n];return e},e.prototype._getSymbol=function(){return this._symbol},e.prototype._setExternSymbol=function(t){return this._externSymbol=this._prepareSymbol(t),this.onSymbolChanged(),this},e.prototype._getInternalSymbol=function(){return this._symbol?this._symbol:this._externSymbol?this._externSymbol:this.options.symbol?this.options.symbol:null},e.prototype._getPrjExtent=function(){var t=this._getProjection();if(this._verifyProjection(),!this._extent&&t){var e=this._computeExtent(t);if(e){var i=!!Ke.isSphere(t)&&this.options.antiMeridian;if(i&&"default"!==i){var n=this.getFirstCoordinate();if("continuous"===i&&e.xmax-e.xmin>180&&(n.x>0?e.xmin+=360:e.xmax-=360),e.xmax<e.xmin){var r=e.xmax;e.xmax=e.xmin,e.xmin=r}}this._extent=new be(t.project(new Ce(e.xmin,e.ymin)),t.project(new Ce(e.xmax,e.ymax)))}}return this._extent},e.prototype._unbind=function(){var t=this.getLayer();t&&(this._animPlayer&&this._animPlayer.finish(),this._unbindMenu(),this._unbindInfoWindow(),this.isEditing()&&this.endEdit(),this._removePainter(),this.onRemove&&this.onRemove(),t.onRemoveGeometry&&t.onRemoveGeometry(this),delete this._layer,delete this._internalId,delete this._extent)},e.prototype._getInternalId=function(){return this._internalId},e.prototype._setInternalId=function(t){this._internalId=t},e.prototype._getMeasurer=function(){return this._getProjection()?this._getProjection():Ke.getInstance(this.options.measure)},e.prototype._getProjection=function(){var t=this.getMap();return t?t.getProjection():null},e.prototype._verifyProjection=function(){var t=this._getProjection();!this._projCode||t&&this._projCode===t.code||this._clearProjection(),this._projCode=t?t.code:null},e.prototype._getExternalResources=function(){return gt(this._getInternalSymbol())},e.prototype._getPainter=function(){return!this._painter&&this.getMap()&&(-1!==Dt.indexOf(this.type)?this._painter=new gi(this):this._painter=new di(this)),this._painter},e.prototype._removePainter=function(){this._painter&&this._painter.remove(),delete this._painter},e.prototype._paint=function(t){this._painter&&this._painter.paint(t)},e.prototype._clearCache=function(){delete this._extent},e.prototype._clearProjection=function(){delete this._extent},e.prototype._repaint=function(){this._painter&&this._painter.repaint()},e.prototype.onHide=function(){this.closeMenu(),this.closeInfoWindow()},e.prototype.onShapeChanged=function(){this._clearCache(),this._repaint(),this._fireEvent("shapechange")},e.prototype.onPositionChanged=function(){this._clearCache(),this._repaint(),this._fireEvent("positionchange")},e.prototype.onSymbolChanged=function(){this._painter&&this._painter.refreshSymbol(),this._fireEvent("symbolchange")},e.prototype.onConfig=function(t){var e=!1;for(var i in t)if(t.hasOwnProperty(i)){var n=i.slice(0,5);if("arrow"===n||"shado"===n){e=!0;break}}e&&this._repaint()},e.prototype._setParent=function(t){t&&(this._parent=t)},e.prototype._getParent=function(){return this._parent},e.prototype._fireEvent=function(t,e){this.getLayer()&&this.getLayer()._onGeometryEvent&&(e||(e={}),e.type=t,e.target=this,this.getLayer()._onGeometryEvent(e)),this.fire(t,e)},e.prototype._toJSON=function(t){return{feature:this.toGeoJSON(t)}},e.prototype._exportGraphicOptions=function(t){var e={};return(r(t.options)||t.options)&&(e.options=this.config()),(r(t.symbol)||t.symbol)&&(e.symbol=this.getSymbol()),(r(t.infoWindow)||t.infoWindow)&&this._infoWinOptions&&(e.infoWindow=this._infoWinOptions),e},e.prototype._exportGeoJSONGeometry=function(){var t=this.getCoordinates(),e=Ce.toNumberArrays(t);return{type:this.getType(),coordinates:e}},e.prototype._exportProperties=function(){var t=null,e=this.getProperties();return r(e)||(t=a(e)?n({},e):e),t},e}(je(Le(Ie(Ae))));_i.mergeOptions(mi);var vi={in:function(t){return Math.pow(t,2)},out:function(t){return 1-vi.in(1-t)},inAndOut:function(t){return 3*t*t-2*t*t*t},linear:function(t){return t},upAndDown:function(t){return t<.5?vi.inAndOut(2*t):1-vi.inAndOut(2*(t-.5))}},xi=function t(e,i){Zt(this,t),this.state=e,this.styles=i},wi=function t(e,i,n){Zt(this,t),this._animation=e,this._options=i,this._onFrame=n,this.playState="idle",this.ready=!0,this.finished=!1},Pi={speed:{slow:2e3,normal:1e3,fast:500},_resolveStyles:function(t){if(!t)return null;var e={},i={},n={};for(var r in t)if(t.hasOwnProperty(r)){var s=t[r],a=void 0;a=function(t){return!Array.isArray(t)&&t.constructor===Object||!(!Array.isArray(t)||t[0].constructor!==Object)}(s)?function(t){if(!Array.isArray(t))return Pi._resolveStyles(t);for(var e=[],i=[],n=[],r=0;r<t.length;r++){var o=Pi._resolveStyles(t[r]);o&&(e.push(o[0]),i.push(o[1]),n.push(o[2]))}return e.length?[e,i,n]:null}(s):function(t){var e=t,i=void 0;Array.isArray(t)||(o(t)?e=[0,t]:t instanceof me||t instanceof Ce?(i=t.constructor,e=[new i(0,0),t]):e=[t,t]);var n=e[0],r=e[1];return o(n)&&o(r)?n===r?null:[n,r-n,r]:Array.isArray(n)||n instanceof Ce||n instanceof me?(Array.isArray(n)?(n=new Ce(n),r=new Ce(r)):(i=n.constructor,n=new i(n),r=new i(r)),n.equals(r)?null:[n,r.sub(n),r]):[n,0,r]}(s),a&&(i[r]=a[0],e[r]=a[1],n[r]=a[2])}return[i,e,n]},framing:function(t,e){e||(e={});var i=e.easing?vi[e.easing]:vi.linear;i||(i=vi.linear);var n=void 0,r=void 0,s=void 0;(t=Pi._resolveStyles(t))&&(r=t[0],n=t[1],s=t[2]);var a=function t(e,i,n){if(!i||!n)return null;var r={};for(var a in n)if(n.hasOwnProperty(a)){if(i[a]===s[a]){r[a]=i[a];continue}var h=i[a],p=n[a];if(o(p))r[a]=h+e*p;else if(Array.isArray(p)){for(var u=[],c=0;c<p.length;c++)u.push(t(e,h[c],p[c]));r[a]=u}else{var l=p.constructor;l===Object?r[a]=t(e,h,p):(h instanceof me||h instanceof Ce)&&(r[a]=h.add(p.multi(e)))}}return r};return function(t,e){var o=void 0,h=void 0;if(t<0)o={playState:"idle",delta:0},h=r;else if(t<e){var p=i(t/e);o={playState:"running",delta:p},h=a(p,r,n)}else o={playState:"finished",delta:1},h=s;return o.startStyles=r,o.destStyles=s,o.progress=t,o.remainingMs=e-t,new xi(o,h)}},_requestAnimFrame:function(t){this._frameQueue||(this._frameQueue=[]),this._frameQueue.push(t),this._a()},_a:function(){this._animationFrameId||(this._animationFrameId=Bt(Pi._frameFn))},_run:function(){if(this._frameQueue.length){var t=this._frameQueue;this._frameQueue=[];for(var e=0,i=t.length;e<i;e++)t[e]();this._frameQueue.length?this._animationFrameId=Bt(Pi._frameFn):delete this._animationFrameId}},animate:function(t,e,i){e||(e={});var n=Pi.framing(t,e);return new wi(n,e,i)}};Pi._frameFn=Pi._run.bind(Pi),n(wi.prototype,{_prepare:function(){var t=this._options,e=t.speed||t.duration;h(e)&&((e=Pi.speed[e])||(e=+e)),e||(e=Pi.speed.normal),this.duration=e,this._framer=t.framer||Pi._requestAnimFrame.bind(Pi)},play:function(){if("idle"!==this.playState&&"paused"!==this.playState)return this;"idle"===this.playState&&(this.currentTime=0,this._prepare());var t=Date.now();if(!this.startTime){var e=this._options;this.startTime=e.startTime?e.startTime:t}return this._playStartTime=Math.max(t,this.startTime),"paused"===this.playState&&(this._playStartTime-=this.currentTime),this.playState="running",this._run(),this},pause:function(){return this.playState="paused",this},cancel:function(){return this.playState="idle",this.finished=!1,this},finish:function(){return this.playState="finished",this.finished=!0,this},reverse:function(){},_run:function(){var t=this,e=this._onFrame,i=Date.now(),n=i-this._playStartTime;if(this._options.repeat&&n>=this.duration&&(this._playStartTime=i,n=0),"finished"!==this.playState&&"paused"!==this.playState&&"idle"!==this.playState){var r=this._animation(n,this.duration);this.playState=r.state.playState,"idle"===this.playState?this.startTime>i&&setTimeout(this._run.bind(this),this.startTime-i):"running"===this.playState?this._framer(function(){if("running"!==t.playState)return void t._run();t.currentTime=n,e&&e(r),t._run()}):"finished"===this.playState&&(this.finished=!0,e&&e(r))}else if(e){"finished"===this.playState?n=this.duration:"idle"===this.playState&&(n=0);var o=this._animation(n,this.duration);o.state.playState=this.playState,e(o)}}});var Ci=xt(function(t){!function(){function e(t,e){var i=t.x-e.x,n=t.y-e.y;return i*i+n*n}function i(t,e,i){var n=e.x,r=e.y,o=i.x-n,s=i.y-r;if(0!==o||0!==s){var a=((t.x-n)*o+(t.y-r)*s)/(o*o+s*s);a>1?(n=i.x,r=i.y):a>0&&(n+=o*a,r+=s*a)}return o=t.x-n,s=t.y-r,o*o+s*s}function n(t,i){for(var n,r=t[0],o=[r],s=1,a=t.length;s<a;s++)n=t[s],e(n,r)>i&&(o.push(n),r=n);return r!==n&&o.push(n),o}function r(t,e){var n,r,o,s,a=t.length,h="undefined"!=typeof Uint8Array?Uint8Array:Array,p=new h(a),u=0,c=a-1,l=[],f=[];for(p[u]=p[c]=1;c;){for(r=0,n=u+1;n<c;n++)(o=i(t[n],t[u],t[c]))>r&&(s=n,r=o);r>e&&(p[s]=1,l.push(u,s,s,c)),c=l.pop(),u=l.pop()}for(n=0;n<a;n++)p[n]&&f.push(t[n]);return f}function o(t,e,i){var o=void 0!==e?e*e:1;return t=i?t:n(t,o),t=r(t,o)}t.exports=o}()}),bi={antiMeridian:"continuous",symbol:{lineColor:"#000",lineWidth:2,lineOpacity:1,polygonFill:"#fff",polygonOpacity:1,opacity:1}},Mi=function(t){function e(){return Zt(this,e),Nt(this,t.apply(this,arguments))}return Ft(e,t),e.prototype._getPath2DPoints=function(t,e,i){var n=[];if(!b(t))return n;var o=this.getMap(),s=o.getFullExtent(),a=this._getProjection(),h=!!Ke.isSphere(a)&&this.options.antiMeridian,p=o.options.clipFullExtent,u=!e&&this.getLayer()&&this.getLayer().options.enableSimplify,c=2*o._getResolution(),l=Array.isArray(t[0]);if(delete this._simplified,u&&!l){var f=t.length;t=Ci(t,c,!1),this._simplified=t.length<f}r(i)&&(i=o.getZoom());for(var y=void 0,d=void 0,g=void 0,m=void 0,_=void 0,v=void 0,x=[],w=[],P=x,C=0,M=t.length;C<M;C++)y=t[C],l?P.push(this._getPath2DPoints(y,e,i)):r(y)||p&&!s.contains(y)||(C>0&&("continuous"===h||"split"===h)&&(g=a.unproject(y),"split"!==h&&d||(d=a.unproject(t[C-1])),d&&g&&(m=g.x-d.x,_=g.y-d.y,Math.abs(m)>180&&("continuous"===h?(g=this._anti(g,m),d=g,y=a.project(g)):"split"===h&&(m>0?(v=d.y+_*(d.x- -180)/(360-m)*(d.y>g.y?-1:1),P=P===x?w:x,P.push(o.coordinateToPoint(new Ce(180,v),i))):(v=d.y+_*(180-d.x)/(360+m)*(d.y>g.y?1:-1),P.push(o.coordinateToPoint(new Ce(180,v),i)),P=P===x?w:x,P.push(o.coordinateToPoint(new Ce(-180,v),i))))))),P.push(o._prjToPoint(y,i)));return n=w.length>0?[x,w]:P},e.prototype._anti=function(t,e){return e>0?t.sub(360,0):t.add(360,0)},e.prototype._setPrjCoordinates=function(t){this._prjCoords=t,this.onShapeChanged()},e.prototype._getPrjCoordinates=function(){return this._getProjection()?(this._verifyProjection(),this._prjCoords||(this._prjCoords=this._projectCoords(this._coordinates)),this._prjCoords):null},e.prototype._updateCache=function(){this._clearCache(),this._getProjection()&&this._prjCoords&&(this._coordinates=this._unprojectCoords(this._getPrjCoordinates()))},e.prototype._clearProjection=function(){this._prjCoords=null,t.prototype._clearProjection.call(this)},e.prototype._projectCoords=function(t){var e=this._getProjection();return e?e.projectCoords(t):[]},e.prototype._unprojectCoords=function(t){var e=this._getProjection();return e?e.unprojectCoords(t):[]},e.prototype._computeCenter=function(){var t=this._coordinates;if(!b(t))return null;for(var e=0,i=0,n=0,r=t.length,s=0;s<r;s++)t[s]&&o(t[s].x)&&o(t[s].y)&&(e+=t[s].x,i+=t[s].y,n++);return new Ce(e/n,i/n)},e.prototype._computeExtent=function(){var t=this._coordinates;if(!b(t))return null;var e=[t];return this.hasHoles&&this.hasHoles()&&e.push.apply(e,this.getHoles()),this._computeCoordsExtent(e)},e.prototype._computeCoordsExtent=function(t){for(var e=this._getProjection(),i=this.options.antiMeridian&&Ke.isSphere(e),n=null,r=void 0,o=void 0,s=void 0,a=void 0,h=0,p=t.length;h<p;h++)for(var u=0,c=t[h].length;u<c;u++)o=t[h][u],u>0&&i&&(a||(a=t[h][u-1]),s=o.x-a.x,Math.abs(s)>180&&(o=this._anti(o,s),a=o)),r=new be(o,o),n=r.combine(n);return n},e.prototype._get2DLength=function(){for(var t=this._getPath2DPoints(this._getPrjCoordinates(),!0),e=0,i=1,n=t.length;i<n;i++)e+=t[i].distanceTo(t[i-1]);return e},e.prototype._hitTestTolerance=function(){var t=this._getInternalSymbol(),e=void 0;if(Array.isArray(t)){e=0;for(var i=0;i<t.length;i++)o(t[i].lineWidth)&&t[i].lineWidth>e&&(e=t[i].lineWidth)}else e=t.lineWidth;return e?e/2:1.5},e}(_i);Mi.mergeOptions(bi);var Si={arrowStyle:null,arrowPlacement:"vertex-last"},Ei=function(t){function e(i,n){Zt(this,e);var r=Nt(this,t.call(this,n));return r.type="LineString",i&&r.setCoordinates(i),r}return Ft(e,t),e.prototype.setCoordinates=function(t){return t?(this._coordinates=Ce.toCoordinates(t),this.getMap()?this._setPrjCoordinates(this._projectCoords(this._coordinates)):this.onShapeChanged(),this):(this._coordinates=null,this._setPrjCoordinates(null),this)},e.prototype.getCoordinates=function(){return this._coordinates||[]},e.prototype.animateShow=function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=arguments[1];p(e)&&(e={},i=e);var n=this.getCoordinates(),r=e.duration||1e3,o=this.getLength(),s=e.easing||"out";this.setCoordinates([]);var a=Pi.animate({t:r},{duration:r,easing:s},function(e){if(!t.getMap())return a.finish(),t.setCoordinates(n),void(i&&i(e));t._drawAnimFrame(e.styles.t,r,o,n),i&&i(e)});return a.play(),a},e.prototype._drawAnimFrame=function(t,e,i,n){if(0===t)return void this.setCoordinates([]);var r=this.getMap(),o=t/e*i;this._animIdx||(this._animIdx=0,this._animLenSoFar=0,this.show());var s=0,a=void 0,h=void 0;for(a=this._animIdx,h=n.length;a<h-1&&(s=r.computeLength(n[a],n[a+1]),!(this._animLenSoFar+s>o));a++)this._animLenSoFar+=s;if(this._animIdx=a,this._animIdx>=h-1)return void this.setCoordinates(n);var p=this._animIdx,u=n[p],c=n[p+1],l=o-this._animLenSoFar,f=l/s,y=u.x+(c.x-u.x)*f,d=u.y+(c.y-u.y)*f,g=new Ce(y,d),m=n.slice(0,this._animIdx+1);m.push(g),this.setCoordinates(m)},e.prototype._computeGeodesicLength=function(t){return t.measureLength(this.getCoordinates())},e.prototype._computeGeodesicArea=function(){return 0},e.prototype._containsPoint=function(t,e){function i(e){for(var i=void 0,r=void 0,o=0,s=e.length;o<s-1;o++)if(i=e[o],r=e[o+1],It(t,i,r)<=n)return!0;return!1}var n=r(e)?this._hitTestTolerance():e;n<2&&(n=2);var o=this._getArrowStyle(),s=this._getInternalSymbol().lineWidth,a=this.getMap(),h=this._getPrjExtent(),p=new Ce(h.xmin,h.ymax),u=new Ce(h.xmax,h.ymin),c=a._prjToPoint(p),l=a._prjToPoint(u),f=new Me(c.x-n,c.y-n,l.x+n,l.y+n);if(o&&f._expand(Math.max(o[0]*s,o[1]*s)),!f.contains(t))return!1;var y=void 0;if(this._getArrowStyle()){y=this._getPath2DPoints(this._getPrjCoordinates(),!0);for(var d=this._getArrows(y,s,(e||2)+s/2),g=d.length-1;g>=0;g--)if(kt(t,d[g]))return!0}if(y=y||this._getPath2DPoints(this._getPrjCoordinates()),y.length>0&&Array.isArray(y[0])){for(var m=0,_=y.length;m<_;m++)if(i(y[m]))return!0;return!1}return i(y)},e}(Mi);Ei.mergeOptions(Si),Ei.registerJSONType("LineString");var Li=function(t){function e(i,n){Zt(this,e)
;var r=Nt(this,t.call(this,n));return r.type="Polygon",i&&r.setCoordinates(i),r}return Ft(e,t),e.prototype.setCoordinates=function(t){if(!t)return this._coordinates=null,this._holes=null,this._projectRings(),this;var e=Ce.toCoordinates(t),i=e.length;if(Array.isArray(e[0])){if(this._coordinates=this._trimRing(e[0]),i>1){for(var n=[],r=1;r<i;r++)e[r]&&n.push(this._trimRing(e[r]));this._holes=n}}else this._coordinates=this._trimRing(e);return this._projectRings(),this},e.prototype.getCoordinates=function(){if(!this._coordinates)return[];for(var t=this.getHoles(),e=[this._copyAndCloseRing(this._coordinates)],i=0,n=t.length;i<n;i++)e.push(this._copyAndCloseRing(t[i]));return e},e.prototype.getShell=function(){return this._coordinates||[]},e.prototype.getHoles=function(){return this._holes||[]},e.prototype.hasHoles=function(){return this.getHoles().length>0},e.prototype._projectRings=function(){if(!this.getMap())return void this.onShapeChanged();this._prjCoords=this._projectCoords(this._coordinates),this._prjHoles=this._projectCoords(this._holes),this.onShapeChanged()},e.prototype._cleanRing=function(t){for(var e=t.length-1;e>=0;e--)t[e]||t.splice(e,1)},e.prototype._checkRing=function(t){if(this._cleanRing(t),!t||!b(t))return!1;var e=t[t.length-1],i=!0;return t[0].x===e.x&&t[0].y===e.y||(i=!1),i},e.prototype._trimRing=function(t){var e=this._checkRing(t);return b(t)&&e&&t.splice(t.length-1,1),t},e.prototype._copyAndCloseRing=function(t){t=t.slice(0);var e=this._checkRing(t);return b(t)&&!e?(t.push(t[0].copy()),t):t},e.prototype._getPrjShell=function(){return"Polygon"===this.getJSONType()?this._getPrjCoordinates():this._getProjection()?(this._verifyProjection(),this._prjShell||(this._prjShell=this._projectCoords(this.getShell())),this._prjShell):null},e.prototype._getPrjHoles=function(){return this._getProjection()?(this._verifyProjection(),this._prjHoles||(this._prjHoles=this._projectCoords(this.getHoles())),this._prjHoles):null},e.prototype._computeGeodesicLength=function(t){var e=this.getCoordinates();if(!b(e))return 0;for(var i=0,n=0,r=e.length;n<r;n++)i+=t.measureLength(e[n]);return i},e.prototype._computeGeodesicArea=function(t){var e=this.getCoordinates();if(!b(e))return 0;for(var i=t.measureArea(e[0]),n=1,r=e.length;n<r;n++)i-=t.measureArea(e[n]);return i},e.prototype._containsPoint=function(t,e){function i(e){var i=kt(t,e);if(i)return i;var r=void 0,o=void 0,s=void 0,a=void 0,h=e.length;for(r=0,o=h-1;r<h;o=r++)if(s=e[r],a=e[o],It(t,s,a)<=n)return!0;return!1}var n=r(e)?this._hitTestTolerance():e;if(!this._getPainter().get2DExtent().expand(n).contains(t))return!1;var o=this.getMap().getProjection(),s=this.getShell().map(function(t){return o.project(t)}),a=this._getPath2DPoints(s);if(Array.isArray(a[0])){for(var h=0;h<a.length;h++)if(i(a[h]))return!0;return!1}return i(a)},e.prototype._updateCache=function(){t.prototype._updateCache.call(this),this._prjHoles&&(this._holes=this._unprojectCoords(this._getPrjHoles()))},e.prototype._clearCache=function(){return delete this._prjShell,t.prototype._clearCache.call(this)},e.prototype._clearProjection=function(){this._prjHoles&&(this._prjHoles=null),this._prjShell&&(this._prjShell=null),t.prototype._clearProjection.call(this)},e}(Mi);Li.registerJSONType("Polygon");var Ti=function(t){function e(i,n){Zt(this,e);var r=Nt(this,t.call(this,n));return r.type="GeometryCollection",r.setGeometries(i),r}return Ft(e,t),e.prototype.setGeometries=function(t){for(var e=this._checkGeometries(t||[]),i=this._getSymbol(),n=this.config(),r=e.length-1;r>=0;r--)e[r]._initOptions(n),e[r]._setParent(this),e[r]._setEventParent(this),i&&e[r].setSymbol(i);return this._geometries=e,this.getLayer()&&(this._bindGeometriesToLayer(),this.onShapeChanged()),this},e.prototype.getGeometries=function(){return this._geometries||[]},e.prototype.forEach=function(t,e){for(var i=this.getGeometries(),n=0,r=i.length;n<r;n++)i[n]&&(e?t.call(e,i[n],n):t(i[n],n));return this},e.prototype.filter=function(t,i){if(!t)return new e;var n=[],r=p(t),o=r?t:R(t);return this.forEach(function(t){var e=r?t:Z(t);(i?o.call(i,e):o(e))&&n.push(t)},this),new e(n)},e.prototype.translate=function(t){if(!t)return this;if(this.isEmpty())return this;var e=arguments;return this.forEach(function(t){t&&t.translate&&t.translate.apply(t,e)}),this},e.prototype.isEmpty=function(){return!b(this.getGeometries())},e.prototype.remove=function(){return this.forEach(function(t){t._unbind()}),_i.prototype.remove.apply(this,arguments)},e.prototype.show=function(){return this.options.visible=!0,this.forEach(function(t){t.show()}),this},e.prototype.hide=function(){return this.options.visible=!1,this.forEach(function(t){t.hide()}),this},e.prototype.onConfig=function(t){this.forEach(function(e){e.config(t)})},e.prototype.getSymbol=function(){var e=t.prototype.getSymbol.call(this);if(!e){var i=[],n=!1;this.forEach(function(t){t.getSymbol()&&!n&&(n=!0),i.push(t.getSymbol())}),n&&(e={children:i})}return e},e.prototype.setSymbol=function(t){if(t&&t.children)this._symbol=null,this.forEach(function(e,i){e.setSymbol(t.children[i])});else{var e=this._prepareSymbol(t);this._symbol=e,this.forEach(function(t){t.setSymbol(e)})}return this.onSymbolChanged(),this},e.prototype._setExternSymbol=function(t){return t=this._prepareSymbol(t),this._externSymbol=t,this.forEach(function(e){e._setExternSymbol(t)}),this.onSymbolChanged(),this},e.prototype._bindLayer=function(){t.prototype._bindLayer.apply(this,arguments),this._bindGeometriesToLayer()},e.prototype._bindGeometriesToLayer=function(){var t=this.getLayer();this.forEach(function(e){e._bindLayer(t)})},e.prototype._checkGeometries=function(t){if(t&&!Array.isArray(t)){if(t instanceof _i)return[t];throw new Error("The geometry added to collection is invalid.")}for(var e=0,i=t.length;e<i;e++)if(!this._checkGeo(t[e]))throw new Error("The geometry added to collection is invalid. Index: "+e);return t},e.prototype._checkGeo=function(t){return t instanceof _i},e.prototype._updateCache=function(){this._clearCache(),this.isEmpty()||this.forEach(function(t){t&&t._updateCache&&t._updateCache()})},e.prototype._removePainter=function(){this._painter&&this._painter.remove(),delete this._painter,this.forEach(function(t){t._removePainter()})},e.prototype._computeCenter=function(t){if(!t||this.isEmpty())return null;for(var e=0,i=0,n=0,r=this.getGeometries(),o=0,s=r.length;o<s;o++)if(r[o]){var a=r[o]._computeCenter(t);a&&(e+=a.x,i+=a.y,n++)}return 0===n?null:new Ce(e/n,i/n)},e.prototype._containsPoint=function(t,e){if(this.isEmpty())return!1;for(var i=this.getGeometries(),n=0,r=i.length;n<r;n++)if(i[n]._containsPoint(t,e))return!0;return!1},e.prototype._computeExtent=function(t){if(this.isEmpty())return null;for(var e=this.getGeometries(),i=null,n=0,r=e.length;n<r;n++)if(e[n]){var o=e[n]._computeExtent(t);o&&(i=o.combine(i))}return i},e.prototype._computeGeodesicLength=function(t){if(!t||this.isEmpty())return 0;for(var e=this.getGeometries(),i=0,n=0,r=e.length;n<r;n++)e[n]&&(i+=e[n]._computeGeodesicLength(t));return i},e.prototype._computeGeodesicArea=function(t){if(!t||this.isEmpty())return 0;for(var e=this.getGeometries(),i=0,n=0,r=e.length;n<r;n++)e[n]&&(i+=e[n]._computeGeodesicArea(t));return i},e.prototype._exportGeoJSONGeometry=function(){var t=[];if(!this.isEmpty())for(var e=this.getGeometries(),i=0,n=e.length;i<n;i++)e[i]&&t.push(e[i]._exportGeoJSONGeometry());return{type:"GeometryCollection",geometries:t}},e.prototype._clearProjection=function(){if(!this.isEmpty())for(var t=this.getGeometries(),e=0,i=t.length;e<i;e++)t[e]&&t[e]._clearProjection()},e.prototype._getConnectPoints=function(){var t=this.getExtent();return[new Ce(t.xmin,t.ymax),new Ce(t.xmax,t.ymin),new Ce(t.xmin,t.ymin),new Ce(t.xmax,t.ymax)]},e.prototype._getExternalResources=function(){if(this.isEmpty())return[];for(var t=this.getGeometries(),e=[],i={},n=void 0,r=void 0,o=void 0,s=0,a=t.length;s<a;s++)if(t[s]){n=t[s]._getInternalSymbol(),r=gt(n);for(var h=0,p=r.length;h<p;h++)o=r[h].join(),i[o]||(e.push(r[h]),i[o]=1)}return e},e.prototype.startEdit=function(t){var e=this;if(this.isEmpty())return this;t||(t={}),t.symbol&&(this._originalSymbol=this.getSymbol(),this.setSymbol(t.symbol)),this._draggbleBeforeEdit=this.options.draggable,this.config("draggable",!1);for(var i=this.getGeometries(),n=0,r=i.length;n<r;n++)i[n].startEdit(t);return this._editing=!0,this.hide(),setTimeout(function(){e.fire("editstart")},1),this},e.prototype.endEdit=function(){if(this.isEmpty())return this;for(var t=this.getGeometries(),e=0,i=t.length;e<i;e++)t[e].endEdit();return this._originalSymbol&&(this.setSymbol(this._originalSymbol),delete this._originalSymbol),this._editing=!1,this.show(),this.config("draggable",this._draggbleBeforeEdit),this.fire("editend"),this},e.prototype.isEditing=function(){return!!this._editing},e}(_i);Ti.registerJSONType("GeometryCollection");var Ri=function(t){function e(i,n,r,o){Zt(this,e);var s=Nt(this,t.call(this,null,o));return s.GeometryType=i,s.type=n,s._initData(r),s}return Ft(e,t),e.prototype.getCoordinates=function(){for(var t=[],e=this.getGeometries(),i=0,n=e.length;i<n;i++)t.push(e[i].getCoordinates());return t},e.prototype.setCoordinates=function(t){t=t||[];for(var e=[],i=0,n=t.length;i<n;i++){var r=new this.GeometryType(t[i],this.config());e.push(r)}return this.setGeometries(e),this},e.prototype._initData=function(t){t=t||[],t.length&&(t[0]instanceof this.GeometryType?this.setGeometries(t):this.setCoordinates(t))},e.prototype._checkGeo=function(t){return t instanceof this.GeometryType},e.prototype._exportGeoJSONGeometry=function(){var t=this.getCoordinates(),e=Ce.toNumberArrays(t);return{type:this.getType(),coordinates:e}},e}(Ti),Ai=function(t){function e(i,n){return Zt(this,e),Nt(this,t.call(this,Ei,"MultiLineString",i,n))}return Ft(e,t),e}(Ri);Ai.registerJSONType("MultiLineString");var Ii=function(t){function e(i,n){return Zt(this,e),Nt(this,t.call(this,Li,"MultiPolygon",i,n))}return Ft(e,t),e}(Ri);Ii.registerJSONType("MultiPolygon");var ki={LineString:Ei,Polygon:Li,MultiLineString:Ai,MultiPolygon:Ii},ji={toGeometry:function(t){if(h(t)&&(t=y(t)),Array.isArray(t)){for(var e=[],i=0,n=t.length;i<n;i++){var r=this._convert(t[i]);Array.isArray(r)?g(e,r):e.push(r)}return e}return this._convert(t)},_convert:function(t){if(!t||r(t.type))return null;var e=t.type;if("Feature"===e){var i=t.geometry,n=this._convert(i);return n?(n.setId(t.id),n.setProperties(t.properties),n):null}if("FeatureCollection"===e){var o=t.features;if(!o)return null;return this.toGeometry(o)}if(["Point","LineString","Polygon","MultiPoint","MultiLineString","MultiPolygon"].indexOf(e)>=0){return new ki["Point"===e?"Marker":e](t.coordinates)}if("GeometryCollection"===e){var s=t.geometries;if(!b(s))return new Ti;for(var a=[],h=s.length,p=0;p<h;p++)a.push(this._convert(s[p]));return new Ti(a)}return null}},Oi=function(t){function e(i,n,r){Zt(this,e),n&&!(n instanceof _i)&&!Array.isArray(n)&&zt.indexOf(n.type)<0&&(r=n,n=null);var o=Nt(this,t.call(this,i,r));return o._initCache(),n&&o.addGeometry(n),o}return Ft(e,t),e.prototype.getGeometryById=function(t){return r(t)||""===t?null:this._geoMap[t]?this._geoMap[t]:null},e.prototype.getGeometries=function(t,e){if(!t)return this._geoList.slice(0);for(var i=[],n=void 0,r=0,o=this._geoList.length;r<o;r++)n=this._geoList[r],(e?t.call(e,n):t(n))&&i.push(n);return i},e.prototype.getFirstGeometry=function(){return this._geoList.length?this._geoList[0]:null},e.prototype.getLastGeometry=function(){var t=this._geoList.length;return 0===t?null:this._geoList[t-1]},e.prototype.getCount=function(){return this._geoList.length},e.prototype.getExtent=function(){if(0===this.getCount())return null;var t=new be;return this.forEach(function(e){t._combine(e.getExtent())}),t},e.prototype.forEach=function(t,e){for(var i=this._geoList.slice(0),n=0,r=i.length;n<r;n++)e?t.call(e,i[n],n):t(i[n],n);return this},e.prototype.filter=function(){return Ti.prototype.filter.apply(this,arguments)},e.prototype.isEmpty=function(){return!this._geoList.length},e.prototype.addGeometry=function(t,e){var i=this;if(!t)return this;if("FeatureCollection"===t.type)return this.addGeometry(ji.toGeometry(t),e);if(!Array.isArray(t)){var n=arguments.length,o=arguments[n-1];return t=Array.prototype.slice.call(arguments,0,n-1),e=o,a(o)&&(t.push(o),e=!1),this.addGeometry(t,e)}if(0===t.length)return this;this._initCache();var s=void 0;!0===e&&(s=new be);for(var h=0,p=t.length;h<p;h++)!function(e,n){var r=t[e];if(!r)throw new Error("Invalid geometry to add to layer("+i.getId()+") at index:"+e);r instanceof _i||(r=_i.fromJSON(r),Array.isArray(r)&&r.forEach(function(t){return i._add(t,s,e)})),Array.isArray(r)||i._add(r,s,e)}(h);this._sortGeometries();var u=this.getMap();if(u&&(this._getRenderer().onGeometryAdd(t),!0===e&&!r(s.xmin))){var c=u.getFitZoom(s);u.setCenterAndZoom(s.getCenter(),c)}return this.fire("addgeo",{geometries:t}),this},e.prototype._add=function(t,e,i){var n=t.getId();if(!r(n)){if(!r(this._geoMap[n]))throw new Error("Duplicate geometry id in layer("+this.getId()+"):"+n+", at index:"+i);this._geoMap[n]=t}var o=f();t._setInternalId(o),this._geoList.push(t),this.onAddGeometry&&this.onAddGeometry(t),t._bindLayer(this),t.onAdd&&t.onAdd(),e&&e._combine(t.getExtent()),t._fireEvent("add",{layer:this})},e.prototype.removeGeometry=function(t){if(!Array.isArray(t))return this.removeGeometry([t]);for(var e=t.length-1;e>=0;e--)t[e]instanceof _i||(t[e]=this.getGeometryById(t[e])),t[e]&&this===t[e].getLayer()&&t[e].remove();return this.fire("removegeo",{geometries:t}),this},e.prototype.clear=function(){this._clearing=!0,this.forEach(function(t){t.remove()}),this._geoMap={};var t=this._geoList;return this._geoList=[],this._getRenderer()&&this._getRenderer().onGeometryRemove(t),this._clearing=!1,this.fire("clear"),this},e.prototype.onRemoveGeometry=function(t){if(t&&!this._clearing&&this===t.getLayer()){if(!r(t._getInternalId())){var e=t.getId();r(e)||delete this._geoMap[e];var i=this._findInList(t);i>=0&&this._geoList.splice(i,1),this._getRenderer()&&this._getRenderer().onGeometryRemove([t])}}},e.prototype.hide=function(){for(var t=0,e=this._geoList.length;t<e;t++)this._geoList[t].onHide();return We.prototype.hide.call(this)},e.prototype.identify=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this._hitGeos(this._geoList,t,e)},e.prototype._hitGeos=function(t,e){for(var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=i.filter,r=[],o=this.getMap(),s=o.coordinateToPoint(e),a=o._pointToContainerPoint(s),h=t.length-1;h>=0;h--){var p=t[h];if(p&&p.isVisible()&&p._getPainter()){if(!(p instanceof Ei&&p._getArrowStyle())){var u=p._getPainter().getContainerExtent();if(!u||!u.contains(a))continue}if(p._containsPoint(s)&&(!n||n(p))&&(r.push(p),i.count&&r.length>=i.count))break}}return r},e.prototype._initCache=function(){this._geoList||(this._geoList=[],this._geoMap={})},e.prototype._sortGeometries=function(){var t=this;this._geoList.sort(function(e,i){return t._compare(e,i)})},e.prototype._compare=function(t,e){return t.getZIndex()===e.getZIndex()?t._getInternalId()-e._getInternalId():t.getZIndex()-e.getZIndex()},e.prototype._findInList=function(t){var e=this._geoList.length;if(0===e)return-1;for(var i=0,n=e-1,r=void 0;i<=n;){if(r=Math.floor((i+n)/2),this._geoList[r]===t)return r;this._compare(this._geoList[r],t)>0?n=r-1:i=r+1}return-1},e.prototype._onGeometryEvent=function(t){if(t&&t.target){var e=t.type;"idchange"===e?this._onGeometryIdChange(t):"zindexchange"===e?this._onGeometryZIndexChange(t):"positionchange"===e?this._onGeometryPositionChange(t):"shapechange"===e?this._onGeometryShapeChange(t):"symbolchange"===e?this._onGeometrySymbolChange(t):"show"===e?this._onGeometryShow(t):"hide"===e?this._onGeometryHide(t):"propertieschange"===e&&this._onGeometryPropertiesChange(t)}},e.prototype._onGeometryIdChange=function(t){if(t.new!==t.old||!this._geoMap[t.old]||this._geoMap[t.old]!==t.target){if(!r(t.new)){if(this._geoMap[t.new])throw new Error("Duplicate geometry id in layer("+this.getId()+"):"+t.new);this._geoMap[t.new]=t.target}r(t.old)||t.new===t.old||delete this._geoMap[t.old]}},e.prototype._onGeometryZIndexChange=function(t){t.old!==t.new&&(this._sortGeometries(),this._getRenderer()&&this._getRenderer().onGeometryZIndexChange(t))},e.prototype._onGeometryPositionChange=function(t){this._getRenderer()&&this._getRenderer().onGeometryPositionChange(t)},e.prototype._onGeometryShapeChange=function(t){this._getRenderer()&&this._getRenderer().onGeometryShapeChange(t)},e.prototype._onGeometrySymbolChange=function(t){this._getRenderer()&&this._getRenderer().onGeometrySymbolChange(t)},e.prototype._onGeometryShow=function(t){this._getRenderer()&&this._getRenderer().onGeometryShow(t)},e.prototype._onGeometryHide=function(t){this._getRenderer()&&this._getRenderer().onGeometryHide(t)},e.prototype._onGeometryPropertiesChange=function(t){this._getRenderer()&&this._getRenderer().onGeometryPropertiesChange(t)},e}(We),Di={debug:!1,enableSimplify:!0,geometryEvents:!0,defaultIconSize:[20,20],cacheVectorOnCanvas:!0,cacheSvgOnCanvas:!1,enableHeight:!1,heightProperty:"height"},zi=function(t){function e(i,n,r){Zt(this,e);var o=Nt(this,t.call(this,i,n,r)),s=o.options.style;return delete o.options.style,s&&o.setStyle(s),o}return Ft(e,t),e.prototype.getStyle=function(){return this._style?this._style:null},e.prototype.setStyle=function(t){return this._style=t,this._cookedStyles=F(t),this.forEach(function(t){this._styleGeometry(t)},this),this.fire("setstyle",{style:t}),this},e.prototype.removeStyle=function(){return this._style?(delete this._style,delete this._cookedStyles,this.forEach(function(t){t._setExternSymbol(null)},this),this.fire("removestyle"),this):this},e.prototype.onAddGeometry=function(t){this.getStyle()&&this._styleGeometry(t)},e.prototype._styleGeometry=function(t){if(!this._cookedStyles)return!1;for(var e=Z(t),i=0,n=this._cookedStyles.length;i<n;i++)if(!0===this._cookedStyles[i].filter(e))return t._setExternSymbol(this._cookedStyles[i].symbol),!0;return!1},e.prototype.identify=function(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=this._getRenderer();return i.onlyVisible&&n?n.identify(e,i):t.prototype.identify.call(this,e,i)},e.prototype.toJSON=function(t){t||(t={});var e={type:this.getJSONType(),id:this.getId(),options:this.config()};if((r(t.style)||t.style)&&this.getStyle()&&(e.style=this.getStyle()),r(t.geometries)||t.geometries){var i=void 0;t.clipExtent&&(i=new be(t.clipExtent));for(var o=[],s=this.getGeometries(),a=void 0,h=void 0,p=0,u=s.length;p<u;p++)!(a=s[p].getExtent())||i&&!i.intersects(a)||(h=s[p].toJSON(t.geometries),h.symbol&&this.getStyle()&&(h.symbol=s[p]._symbolBeforeStyle?n({},s[p]._symbolBeforeStyle):null),o.push(h));e.geometries=o}return e},e.fromJSON=function(t){if(!t||"VectorLayer"!==t.type)return null;for(var i=new e(t.id,t.options),n=t.geometries,r=[],o=0;o<n.length;o++){var s=_i.fromJSON(n[o]);s&&r.push(s)}return i.addGeometry(r),t.style&&i.setStyle(t.style),i},e}(Oi);zi.mergeOptions(Di),zi.registerJSONType("VectorLayer");var Gi=function(t){function e(){return Zt(this,e),Nt(this,t.apply(this,arguments))}return Ft(e,t),e.prototype.checkResources=function(){var t=this._geosToCheck;if(this._resourceChecked||t||(t=this.layer._geoList),!b(t))return[];for(var e=[],i={},n=t.length-1;n>=0;n--){var r=t[n],o=r._getExternalResources();if(o.length)if(this.resources)for(var s=0;s<o.length;s++){var a=o[s][0];this.resources.isResourceLoaded(o[s])||i[a]||(e.push(o[s]),i[a]=1)}else e.push.apply(e,o)}return this._resourceChecked=!0,delete this._geosToCheck,e},e.prototype._addGeoToCheckRes=function(t){t&&(Array.isArray(t)||(t=[t]),this._geosToCheck||(this._geosToCheck=[]),g(this._geosToCheck,t))},e.prototype.onGeometryAdd=function(t){this._addGeoToCheckRes(t),jt(this)},e.prototype.onGeometryRemove=function(){jt(this)},e.prototype.onGeometrySymbolChange=function(t){this._addGeoToCheckRes(t.target),jt(this)},e.prototype.onGeometryShapeChange=function(){jt(this)},e.prototype.onGeometryPositionChange=function(){jt(this)},e.prototype.onGeometryZIndexChange=function(){jt(this)},e.prototype.onGeometryShow=function(){jt(this)},e.prototype.onGeometryHide=function(){jt(this)},e.prototype.onGeometryPropertiesChange=function(){jt(this)},e}(Fe),Zi=function(t){function e(){return Zt(this,e),Nt(this,t.apply(this,arguments))}return Ft(e,t),e.prototype.checkResources=function(){var e=this,i=t.prototype.checkResources.apply(this,arguments),n=this.layer.getStyle();return n&&(Array.isArray(n)||(n=[n]),n.forEach(function(t){for(var n=gt(t.symbol,!0),r=0,o=n.length;r<o;r++)e.resources.isResourceLoaded(n[r])||i.push(n[r])})),i},e.prototype.needToRedraw=function(){var e=this.getMap();return!(!e.isInteracting()||!this.layer.options.enableHeight)||!(e.isZooming()&&!e.getPitch()&&!this._hasPoint&&this.layer.constructor===zi)&&t.prototype.needToRedraw.call(this)},e.prototype.draw=function(){if(this.getMap()){if(!this.layer.isVisible()||this.layer.isEmpty())return this.clearCanvas(),void this.completeRender();this.prepareCanvas(),this.drawGeos(),this.completeRender()}},e.prototype.isBlank=function(){return!!this.context&&!this.context.canvas._drawn},e.prototype.drawOnInteracting=function(){if(this._geosToDraw){this._getDisplayExtent();for(var t=0,e=this._geosToDraw.length;t<e;t++)this._geosToDraw[t]._paint(this._displayExtent)}},e.prototype.show=function(){this.layer.forEach(function(t){t._repaint()}),t.prototype.show.apply(this,arguments)},e.prototype.forEachGeo=function(t,e){this.layer.forEach(t,e)},e.prototype.drawGeos=function(){this._getDisplayExtent(),this.prepareToDraw(),this.forEachGeo(this.checkGeo,this);for(var t=0,e=this._geosToDraw.length;t<e;t++)this._geosToDraw[t]._paint(this._displayExtent)},e.prototype.prepareToDraw=function(){this._hasPoint=!1,this._geosToDraw=[]},e.prototype.checkGeo=function(t){if(t&&t.isVisible()&&t.getMap()&&t.getLayer()&&t.getLayer().isCanvasRender()){var e=t._getPainter(),i=e.get2DExtent(this.resources);i&&i.intersects(this._displayExtent)&&(e.hasPoint()&&(this._hasPoint=!0),this._geosToDraw.push(t))}},e.prototype.onZoomEnd=function(){delete this._extent2D,t.prototype.onZoomEnd.apply(this,arguments)},e.prototype.onRemove=function(){this.forEachGeo(function(t){t.onHide()}),delete this._geosToDraw},e.prototype.onGeometryPropertiesChange=function(e){e&&this.layer._styleGeometry(e.target),t.prototype.onGeometryPropertiesChange.call(this,e)},e.prototype._getDisplayExtent=function(){var t=this._extent2D;if(this._maskExtent){if(!this._maskExtent.intersects(t))return void this.completeRender();t=t.intersection(this._maskExtent)}this._displayExtent=t},e.prototype.identify=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=this._geosToDraw;return i?this.layer._hitGeos(i,t,e):[]},e}(Gi);zi.registerRenderer("canvas",Zi);var Fi=function(t){function e(i){Zt(this,e);var n=Nt(this,t.call(this));return n.map=i,n._handlerQueue={},n}return Ft(e,t),e.prototype.callInNextFrame=function(t){this._handlerQueue.push(t)},e.prototype.executeFrameCallbacks=function(){var t=this._handlerQueue;this._handlerQueue=[];for(var e=0,i=t.length;e<i;e++)t[e]()},e.prototype.panAnimation=function(t,e,i){if(!this._panPlayer||"running"!==this._panPlayer.playState){var n=this.map,r=n._getPrjCenter().copy(),o=n.getProjection().project(t),s=o.sub(r);if(n.options.panAnimation){var a=void 0;a=e||n.options.panAnimationDuration;var h=n._getRenderer(),p=function(t){h.callInNextFrame(t)},u=this._panPlayer=Pi.animate({distance:s},{easing:"out",duration:a,framer:p},function(t){if(n.isRemoved())return void u.finish();if("running"===u.playState&&(n.isZooming()||n.isDragRotating()))return void u.finish();if("running"===u.playState&&t.styles.distance){var e=t.styles.distance;n._setPrjCenter(r.add(e)),n.onMoving()}else"finished"===u.playState&&(u._interupted||n._setPrjCenter(o),i&&i(),n.onMoveEnd())});u.play(),n.isMoving()||n.onMoveStart()}else n.onMoveEnd()}},e.prototype.stopPanAnimation=function(){this._panPlayer&&(this._panPlayer._interupted=!0,this._panPlayer.finish()),delete this._panPlayer},e.prototype.offsetPlatform=function(t){if(!this.map._panels.front)return this;if(0===t.x&&0===t.y)return this;var e=this.map.offsetPlatform().add(t)._round(),i=this.map._panels;return i.backLayer.firstChild&&pt(i.back,e),(i.frontLayer.firstChild||i.ui.firstChild)&&pt(this.map._panels.front,e),this},e.prototype.resetContainer=function(){if(this.map&&(this.map._resetMapViewPoint(),this.map._panels.front)){var t=new me(0,0);pt(this.map._panels.back,t),pt(this.map._panels.front,t)}},e.prototype.onZoomEnd=function(){this.resetContainer()},e.prototype.onLoad=function(){this._frameLoop()},e}(Ae),Ni=function(t){function e(i){Zt(this,e);var n=Nt(this,t.call(this,i));return n._containerIsCanvas=!!i._containerDOM.getContext,n._registerEvents(),n._loopTime=0,n}return Ft(e,t),e.prototype.load=function(){this.initContainer()},e.prototype.renderFrame=function(){if(!this.map)return!1;this.map._fireEvent("framestart"),this.updateMapDOM();var t=this._getAllLayerToRender();return this.drawLayers(t),this.drawLayerCanvas(t),this.map._fireEvent("frameend"),this._state=this._getMapState(),delete this._spatialRefChanged,this._fireLayerLoadEvents(),this.executeFrameCallbacks(),this._needRedraw=!1,!0},e.prototype.updateMapDOM=function(){var t=this.map;if(!t.isInteracting()||t.isMoving()){var e=t._getViewPointOffset();e&&t.offsetPlatform(e)}},e.prototype.drawLayers=function(t){for(var e=this.map,i=e.isInteracting(),n=[],r=[],o=e.options.fpsOnInteracting||0,s=0===o?0:1e3/o,a=this.map.options.layerCanvasLimitOnInteracting,h=t.length,p=0,u=h-1;u>=0;u--){var c=t[u];if(c.isVisible()){var l=c.isCanvasRender();l&&n.push(c.getId());var f=c._getRenderer();if(f){var y=this._checkLayerRedraw(c);if(l&&f.isCanvasUpdated()&&(y||r.push(c.getId()),this.setToRedraw()),delete f.__shouldZoomTransform,y){if(i&&l){if(a>0&&h-1-u>a){c._getRenderer().clearCanvas();continue}p+=this._drawCanvasLayerOnInteracting(c,p,s)}else i&&f.drawOnInteracting?(f.prepareRender&&f.prepareRender(),f.drawOnInteracting(this._eventParam)):f.render();l&&(r.push(c.getId()),this.setToRedraw())}else l&&i&&(e.isZooming()&&!e.getPitch()?(f.prepareRender(),f.__shouldZoomTransform=!0):(e.getPitch()||e.isDragRotating())&&f.clearCanvas())}}}var d=this._canvasIds||[],g=this._updatedIds||[];if(this._canvasIds=n,this._updatedIds=r,!this._needToRedraw()){d.join("---")===n.join("---")&&g.join("---")===r.join("---")||this.setToRedraw()}},e.prototype._checkLayerRedraw=function(t){if(this.isSpatialReferenceChanged())return!0;var e=this.map,i=t._getRenderer();return t.isCanvasRender()?i.isAnimating&&i.isAnimating()||i.needToRedraw():!(!i.needToRedraw||!i.needToRedraw())||(e.isInteracting()||this.isStateChanged())},e.prototype._drawCanvasLayerOnInteracting=function(t,e,i){var n=this.map,r=t._getRenderer(),o=r.getDrawTime(),s=0===i||i>0&&e+o<=i;return r.drawOnInteracting&&(s||n.isZooming()&&t.options.forceRenderOnZooming||n.isMoving()&&t.options.forceRenderOnMoving||n.isDragRotating()&&t.options.forceRenderOnDragRotating)?(r.prepareRender(),r.prepareCanvas(),r.drawOnInteracting(this._eventParam),o):(n.isZooming()&&!n.getPitch()?(r.prepareRender(),r.__shouldZoomTransform=!0):(n.getPitch()||n.isDragRotating())&&r.clearCanvas(),r.drawOnInteracting&&!s&&r.skipDrawOnInteracting(this._eventParam),0)},e.prototype._fireLayerLoadEvents=function(){if(this._updatedIds&&this._updatedIds.length>0){var t=this.map;this._updatedIds.reverse().forEach(function(e){var i=t.getLayer(e);if(i){var n=i._getRenderer();n&&n.isRenderComplete()&&i.fire("layerload")}})}},e.prototype._needToRedraw=function(){return this._needRedraw},e.prototype.setToRedraw=function(){this._needRedraw=!0},e.prototype.drawLayerCanvas=function(t){if(this.map&&(this._needToRedraw()||this.isStateChanged())){this.canvas||this.createCanvas(),this.map._fireEvent("renderstart",{context:this.context}),this._updateCanvasSize()||this.clearCanvas();for(var e=this.map.isInteracting(),i=this.map.options.layerCanvasLimitOnInteracting,n=t.length,r=[],o=0;o<n;o++)if(t[o].isVisible()&&t[o].isCanvasRender()){var s=t[o]._getRenderer();if(!(!s||e&&s.__isEmpty)){var a=this._getLayerImage(t[o]);a&&a.image&&r.push([t[o],a])}}n=r.length;for(var h=e&&i>=0&&n>i?n-i:0,p=h;p<n;p++)this._drawLayerCanvasImage.apply(this,r[p]);this._drawCenterCross(),this.map._fireEvent("renderend",{context:this.context})}},e.prototype.updateMapSize=function(t){if(t&&!this._containerIsCanvas){var e=t.width+"px",i=t.height+"px",n=this.map._panels;n.mapWrapper.style.width=e,n.mapWrapper.style.height=i,this._updateCanvasSize()}},e.prototype.getMainPanel=function(){return this.map?this._containerIsCanvas?this.map._containerDOM:this.map._panels?this.map._panels.mapWrapper:null:null},e.prototype.toDataURL=function(t){return this.canvas?this.canvas.toDataURL(t):null},e.prototype.remove=function(){this._resizeInterval&&clearInterval(this._resizeInterval),delete this.context,delete this.canvas,delete this.map,delete this._spatialRefChanged,this._cancelFrameLoop()},e.prototype.hitDetect=function(t){var e=this.map;if(e&&e.options.hitDetect&&!e.isInteracting()){for(var i=e._getLayers(),n="default",r=e.options.hitDetectLimit||0,o=0,s=i.length-1;s>=0;s--){var a=i[s];if(!a.isEmpty||!a.isEmpty()){var h=a._getRenderer();if(h&&h.hitDetect&&(!h.isBlank||!h.isBlank())){if("default"!==a.options.cursor&&h.hitDetect(t)){n=a.options.cursor||"pointer";break}if(o++,r>0&&o>r)break}}}e._trySetCursor(n)}},e.prototype._getLayerImage=function(t){return t&&t._getRenderer()&&t._getRenderer().getCanvasImage?t._getRenderer().getCanvasImage():null},e.prototype.initContainer=function(){function t(t,i,n,r){var o=it("div",i);return n&&(o.style.cssText=n),e[t]=o,r||ht(o),o}var e=this.map._panels,i=this.map._containerDOM;if(!this._containerIsCanvas){i.innerHTML="";var n="position:absolute;top:0px;left:0px;",r=t("mapWrapper","maptalks-wrapper","position:absolute;overflow:hidden;",!0),o=t("allLayers","maptalks-all-layers",n+"padding:0px;margin:0px;z-index:0",!0),s=t("backStatic","maptalks-back-static",n+"z-index:0;",!0),a=t("back","maptalks-back",n+"will-change:transform;z-index:1;"),h=t("backLayer","maptalks-back-layer",n),p=t("canvasContainer","maptalks-canvas-layer",n+"border:none;z-index:2;"),u=t("frontStatic","maptalks-front-static",n+"z-index:3;",!0),c=t("front","maptalks-front",n+"z-index:4;",!0),l=t("frontLayer","maptalks-front-layer",n+"z-index:0;"),f=t("ui","maptalks-ui",n+"border:none;z-index:1;",!0),y=t("control","maptalks-control","z-index:1",!0);i.appendChild(r),o.appendChild(s),a.appendChild(h),o.appendChild(a),o.appendChild(p),c.appendChild(l),o.appendChild(u),o.appendChild(c),c.appendChild(f),r.appendChild(o),r.appendChild(y),this.createCanvas(),this.resetContainer();var d=this.map._getContainerDomSize();this.updateMapSize(d)}},e.prototype.isStateChanged=function(){var t=this._state,e=this._getMapState();return!t||!Ot(t,e)},e.prototype.isSpatialReferenceChanged=function(){return this._spatialRefChanged},e.prototype._getMapState=function(){var t=this.map,e=t._getPrjCenter();return{x:e.x,y:e.y,zoom:t.getZoom(),pitch:t.getPitch(),bearing:t.getBearing(),width:t.width,height:t.height}},e.prototype._frameLoop=function(){var t=this;if(!this.map)return void this._cancelFrameLoop();this.renderFrame(),this._animationFrame=Bt(function(){t._frameLoop()})},e.prototype._cancelFrameLoop=function(){this._animationFrame&&Vt(this._animationFrame)},e.prototype._drawLayerCanvasImage=function(t,e){var i=this.context,n=e.point.multi(ye.retina?2:1),r=e.image;if(!(n.x+r.width<=0||n.y+r.height<=0)){var s=t.options.opacity;if(o(s)||(s=1),!(s<=0)){var a=e.opacity;if(o(a)||(a=1),!(a<=0)){var h=i.globalAlpha;s<1&&(i.globalAlpha*=s),a<1&&(i.globalAlpha*=a),t.options.cssFilter&&(i.filter=t.options.cssFilter);var p=this._zoomMatrix,u=!!t._getRenderer().__shouldZoomTransform;p&&u&&(i.save(),i.setTransform.apply(i,p)),i.drawImage(r,n.x,n.y),p&&u&&i.restore(),
"none"!==i.filter&&(i.filter="none"),i.globalAlpha=h}}}},e.prototype._drawCenterCross=function(){var t=this.map.options.centerCross;if(t){var e=this.context,i=new me(this.canvas.width/2,this.canvas.height/2);p(t)?t(e,i):Pe.drawCross(this.context,i,2,"#f00")}},e.prototype._getAllLayerToRender=function(){return this.map._getLayers()},e.prototype.clearCanvas=function(){this.canvas&&Pe.clearRect(this.context,0,0,this.canvas.width,this.canvas.height)},e.prototype._updateCanvasSize=function(){if(!this.canvas||this._containerIsCanvas)return!1;var t=this.map,e=t.getSize(),i=this.canvas,n=ye.retina?2:1;return(e.width*n!==i.width||e.height*n!==i.height)&&(i.height=n*e.height,i.width=n*e.width,i.style&&(i.style.width=e.width+"px",i.style.height=e.height+"px"),!0)},e.prototype.createCanvas=function(){this._containerIsCanvas?this.canvas=this.map._containerDOM:(this.canvas=it("canvas"),this._updateCanvasSize(),this.map._panels.canvasContainer.appendChild(this.canvas)),this.context=this.canvas.getContext("2d")},e.prototype._checkSize=function(){this.map&&!this.map.isInteracting()&&(ut(this.map._containerDOM),this.map.checkSize())},e.prototype._setCheckSizeInterval=function(t){var e=this;clearInterval(this._resizeInterval),this._checkSizeInterval=t,this._resizeInterval=setInterval(function(){!e.map||e.map.isRemoved()?clearInterval(e._resizeInterval):e._checkSize()},this._checkSizeInterval)},e.prototype._registerEvents=function(){var t=this,e=this.map;e.options.checkSize&&!Wt&&"undefined"!=typeof window&&this._setCheckSizeInterval(1e3),ye.mobile||e.on("_mousemove",this._onMapMouseMove,this),e.on("_dragrotatestart _dragrotating _dragrotateend _movestart _moving _moveend _zoomstart",function(e){t._eventParam=e}),e.on("_zooming",function(i){e.getPitch()||(t._zoomMatrix=i.matrix.container),t._eventParam=i}),e.on("_zoomend",function(e){t._eventParam=e,delete t._zoomMatrix}),e.on("_spatialreferencechange",function(){t._spatialRefChanged=!0})},e.prototype._onMapMouseMove=function(t){var e=this,i=this.map;!i.isInteracting()&&i.options.hitDetect&&(this._hitDetectFrame&&Vt(this._hitDetectFrame),this._hitDetectFrame=Bt(function(){e.hitDetect(t.containerPoint)}))},e.prototype._getCanvasLayers=function(){return this.map._getLayers(function(t){return t.isCanvasRender()})},e}(Fi);ui.registerRenderer("canvas",Ni);var Hi=Object.freeze({MapRenderer:Fi,MapCanvasRenderer:Ni,Renderable:Oe,OverlayLayerCanvasRenderer:Gi,VectorLayerCanvasRenderer:Zi});_i.include({_redrawWhenPitch:function(){return!1},_redrawWhenRotate:function(){return!1}}),Ei.include({arrowStyles:{classic:[3,4]},_getArrowPoints:function(t,e,i,n,r){r||(r=0);var o=i*n[0],s=i*n[1]+r,a=o/2+r,h=e.sub(t)._unit(),p=e.sub(h.multi(s));h._perp();var u=p.add(h.multi(a));return h._multi(-1),[u,e,p.add(h.multi(a)),u]},_getPaintParams:function(){var t=this._getPrjCoordinates();return[this._getPath2DPoints(t,!1,this.getMap().getMaxNativeZoom())]},_paintOn:function(t,e,i,n,r){Pe.path(t,e,i,null,r),this._paintArrow(t,e,i)},_getArrowPlacement:function(){return this.options.arrowPlacement},_getArrowStyle:function(){var t=this.options.arrowStyle;return t?Array.isArray(t)?t:this.arrowStyles[t]:null},_getArrows:function(t,e,i){var n=this._getArrowStyle();if(!n||t.length<2)return[];for(var r=t.length>0&&Array.isArray(t[0]),o=r?t:[t],s=this._getArrowPlacement(),a=[],h=o.length-1;h>=0;h--)if("vertex-first"!==s&&"vertex-firstlast"!==s||a.push(this._getArrowPoints(o[h][1],o[h][0],e,n,i)),"vertex-last"===s||"vertex-firstlast"===s)a.push(this._getArrowPoints(o[h][o[h].length-2],o[h][o[h].length-1],e,n,i));else if("point"===s)for(var p=0,u=o[h].length-1;p<u;p++)a.push(this._getArrowPoints(o[h][p],o[h][p+1],e,n,i));return a},_paintArrow:function(t,e,i){var n=this._getInternalSymbol().lineWidth;(!n||n<3)&&(n=3);var r=this._getArrows(e,n);if(r.length){t.setLineDash&&t.setLineDash([]);for(var o=r.length-1;o>=0;o--)t.fillStyle=t.strokeStyle,Pe.polygon(t,r[o],i,i)}}}),Li.include({_getPaintParams:function(t){var e=this.getMap().getMaxNativeZoom(),i=this._getPrjShell(),n=this._getPath2DPoints(i,t,e),r=n.length>0&&Array.isArray(n[0]);r&&(n=[[n[0]],[n[1]]]);var o=this._getPrjHoles(),s=[];if(o&&o.length>0)for(var a=0;a<o.length;a++){var h=this._getPath2DPoints(o[a],t,e);Array.isArray(h)&&r?Array.isArray(h[0])?(n[0].push(h[0]),n[1].push(h[1])):n[0].push(h):s.push(h)}return r||(n=[n],g(n,s)),[n]},_paintOn:Pe.polygon}),t.renderer=Hi,t.Map=ui,t.Layer=We,t.OverlayLayer=Oi,t.VectorLayer=zi,t.GeoJSON=ji,t.Geometry=_i,t.GeometryCollection=Ti,t.LineString=Ei,t.MultiLineString=Ai,t.MultiPolygon=Ii,t.Polygon=Li,Object.defineProperty(t,"__esModule",{value:!0}),"undefined"!=typeof console&&console.log("maptalks v0.27.0")});